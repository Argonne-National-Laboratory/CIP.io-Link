[
    {
        "id": "9ca80d42115ee3c3",
        "type": "tab",
        "label": "CL_CSMS_Logic",
        "disabled": false,
        "locked": true,
        "info": "",
        "env": []
    },
    {
        "id": "217382551c48905d",
        "type": "tab",
        "label": "CL_EVSEs",
        "disabled": false,
        "locked": true,
        "info": "",
        "env": []
    },
    {
        "id": "68c0944e7f4deca9",
        "type": "tab",
        "label": "CL_GetSetConfig",
        "disabled": false,
        "locked": true,
        "info": "",
        "env": []
    },
    {
        "id": "92d055a5ecbac90c",
        "type": "tab",
        "label": "CL_Home",
        "disabled": false,
        "locked": true,
        "info": "",
        "env": []
    },
    {
        "id": "c40c5bcee8c850c1",
        "type": "tab",
        "label": "CL_Info",
        "disabled": false,
        "locked": true,
        "info": "",
        "env": []
    },
    {
        "id": "bc469b88bbf8641e",
        "type": "tab",
        "label": "CL_Meters",
        "disabled": false,
        "locked": true,
        "info": "",
        "env": []
    },
    {
        "id": "294f3520d49a4f00",
        "type": "tab",
        "label": "CL_OCPPLog",
        "disabled": false,
        "locked": true,
        "info": "",
        "env": []
    },
    {
        "id": "c4f677cd277b409d",
        "type": "tab",
        "label": "CL_Settings",
        "disabled": false,
        "locked": true,
        "info": "",
        "env": []
    },
    {
        "id": "55e67bd3e4f94c9a",
        "type": "tab",
        "label": "CL_TagInfo",
        "disabled": false,
        "locked": true,
        "info": "",
        "env": []
    },
    {
        "id": "daf7a59ca2ce18df",
        "type": "tab",
        "label": "CL_Transactions",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "be6953c0e3c70845",
        "type": "tab",
        "label": "Flow 1",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "1bbb83617feb5d61",
        "type": "subflow",
        "name": "CSMS 1.6",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 40,
                "wires": [
                    {
                        "id": "70bfca444e38cb32"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 980,
                "y": 100,
                "wires": [
                    {
                        "id": "0508b4312099eed7",
                        "port": 0
                    }
                ]
            },
            {
                "x": 980,
                "y": 160,
                "wires": [
                    {
                        "id": "f5e6a6b98ad89c35",
                        "port": 0
                    }
                ]
            },
            {
                "x": 990,
                "y": 220,
                "wires": [
                    {
                        "id": "8bd502e33fe2ee01",
                        "port": 0
                    },
                    {
                        "id": "36d20d6f10701b5e",
                        "port": 0
                    },
                    {
                        "id": "ba2cbe8ea7210112",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "CSMS_PORT",
                "type": "num",
                "value": "8863"
            },
            {
                "name": "CSMS_PATH",
                "type": "str",
                "value": "/ocpp"
            }
        ],
        "meta": {},
        "color": "#3FADB5",
        "outputLabels": [
            "OCPP Msg",
            "OCPP Logging",
            "SubFlow Debug"
        ],
        "icon": "font-awesome/fa-bolt"
    },
    {
        "id": "f6f7b333be6e5917",
        "type": "group",
        "z": "9ca80d42115ee3c3",
        "name": "Example OCPP CMD Overrides",
        "style": {
            "fill": "#d1d1d1",
            "label": true,
            "label-position": "n",
            "color": "#000000"
        },
        "nodes": [
            "1e88d1e2d4dcc7d3",
            "2b16b2bbbd57fabc",
            "7283d4e60852fabc",
            "9298f921e122faa5",
            "fa1a321403a73088",
            "056c40eb67d6fe4c",
            "23d227486f4a19f5",
            "c20c8766fa664d2e",
            "4f4c8a9f1f8d9bb4"
        ],
        "x": 58,
        "y": 699,
        "w": 864,
        "h": 448,
        "info": "**This is just an example** of an override\r\nYou can unlock this tab and click on the nodes to see\r\nhow they work. Do not edit this page or \r\nthese examples. Copy them to an editable\r\nflow of your own if you wish to utilize your\r\nown overrides.\r\n\r\n**Remember** to lock the flow again when you are done\r\nsince CL_ flows get overwritten with new\r\nupdates."
    },
    {
        "id": "a0169f65e4967ec2",
        "type": "group",
        "z": "9ca80d42115ee3c3",
        "name": "Update Last Comm Timestamp",
        "style": {
            "fill": "#ffff7f",
            "label": true
        },
        "nodes": [
            "868ca4fd5276022e",
            "e07f99fdfc73cd44",
            "124fa94892413c81",
            "b952178113645c64",
            "34b27b38f2e7609a",
            "7bc0d39e117db98a",
            "d2d365e869ae5aa3",
            "d836b12b64275a9d",
            "a1f721f1a03c965a"
        ],
        "x": 104,
        "y": 439,
        "w": 1212,
        "h": 82
    },
    {
        "id": "fac4518c226fbf0c",
        "type": "group",
        "z": "1bbb83617feb5d61",
        "name": "Modify StartTx with TxId",
        "style": {
            "fill": "#b797cf",
            "label": true,
            "stroke": "#ffff00",
            "color": "#001f60"
        },
        "nodes": [
            "e930a4053f3ebf38",
            "d5ea45e6cb0d7090",
            "20e60ae443b8c057",
            "7085c4e9b54ca5e5",
            "81b335ea88991f47",
            "05dc69bf9c191b85",
            "bc558f4221526ddb",
            "1a959d6556da3c19",
            "2b61a29bf378cb19",
            "0cf0b97d82a84f68",
            "36d20d6f10701b5e",
            "aa717d0237b2f9f2",
            "ba2cbe8ea7210112",
            "8dd31db647e97e9a"
        ],
        "x": 644,
        "y": 579,
        "w": 1162,
        "h": 162
    },
    {
        "id": "f6e1783b4f8d6029",
        "type": "group",
        "z": "1bbb83617feb5d61",
        "name": "",
        "style": {
            "fill": "#c8e7a7",
            "label": true
        },
        "nodes": [
            "dcc4d675cbe95527",
            "b348b5858bbb69e9",
            "e892b41d16a803e6",
            "3d9889d0e7face61",
            "565b9e3d1ccde32e"
        ],
        "x": 654,
        "y": 439,
        "w": 592,
        "h": 122
    },
    {
        "id": "adad8cfed89e9a2e",
        "type": "group",
        "z": "1bbb83617feb5d61",
        "name": "Calculate Charging Profile",
        "style": {
            "stroke": "#ff3f3f",
            "fill": "#ffcf3f",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "31cbb896896da083",
            "74558ab2bc828dd9",
            "277e1a6705982260",
            "317d216b8fa4f66a"
        ],
        "x": 644,
        "y": 739,
        "w": 462,
        "h": 122
    },
    {
        "id": "ceb6cf36b4dceec8",
        "type": "group",
        "z": "be6953c0e3c70845",
        "name": "Modify StartTx with TxId",
        "style": {
            "fill": "#b797cf",
            "label": true,
            "stroke": "#ffff00",
            "color": "#001f60"
        },
        "nodes": [
            "d87d1230d7f4c458",
            "cc759bb71f06debd",
            "6aa282ae0b36247d",
            "23ade09a61f9015c",
            "cb1919cea557885d",
            "12b8bd9cfdff38db",
            "fa6e94f405122a1c",
            "42125ce42a18f3dc",
            "d293d37b2e3f30f5",
            "7010f322a6ca6ae5",
            "38b195bac085b028",
            "939509d1bcb662e4",
            "c8f1b5fdb61f41a7",
            "0bb0a06fe83260c3"
        ],
        "x": 484,
        "y": 819,
        "w": 1162,
        "h": 162
    },
    {
        "id": "c20c8766fa664d2e",
        "type": "group",
        "z": "9ca80d42115ee3c3",
        "g": "f6f7b333be6e5917",
        "name": "Modify StartTx with TxId",
        "style": {
            "fill": "#b797cf",
            "label": true,
            "stroke": "#ffff00",
            "color": "#001f60"
        },
        "nodes": [
            "c71183f6d99d46ef",
            "5bb26352bd2d7e5a",
            "e2a9a4f6ea0938e9",
            "1b09a234a1e45737",
            "08c6daf9b344995d",
            "378785534c46db9b",
            "3890b31b33998ff0",
            "9553dfbcb3b284b3",
            "02e68d94d30084bf"
        ],
        "x": 84,
        "y": 819,
        "w": 812,
        "h": 182
    },
    {
        "id": "23d227486f4a19f5",
        "type": "group",
        "z": "9ca80d42115ee3c3",
        "g": "f6f7b333be6e5917",
        "name": "Calculate Charging Profile",
        "style": {
            "stroke": "#ff3f3f",
            "fill": "#ffcf3f",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "25afca3af5d04a0d",
            "668279fcb445ce5d",
            "1186737eeaebd401"
        ],
        "x": 84,
        "y": 1039,
        "w": 452,
        "h": 82
    },
    {
        "id": "f740792ad0c8f5fd",
        "type": "junction",
        "z": "217382551c48905d",
        "x": 1360,
        "y": 180,
        "wires": [
            [
                "9061953296c99fc7"
            ]
        ]
    },
    {
        "id": "ba42612f57a44fd4",
        "type": "junction",
        "z": "294f3520d49a4f00",
        "x": 420,
        "y": 160,
        "wires": [
            [
                "f3e1c99425a9c103",
                "a032c7f04398d7d4",
                "687284eeeefc6094",
                "e7de0b7ea1e77e8e"
            ]
        ]
    },
    {
        "id": "7738416e1b659cd6",
        "type": "junction",
        "z": "c4f677cd277b409d",
        "x": 100,
        "y": 300,
        "wires": [
            [
                "a7fd3a800d49469d",
                "754e5e01d72b3fbd",
                "9a553400c62662a4",
                "6bdcde6369d7a4b4",
                "039d0809d7c54de3",
                "75b51ecec0628924",
                "fb0a4e143e0f32de",
                "dfe32902741b4462",
                "18e6c9e77140a8fc",
                "c10702a72a0cb5b0"
            ]
        ]
    },
    {
        "id": "b790fef9f4f7de2c",
        "type": "junction",
        "z": "daf7a59ca2ce18df",
        "x": 1340,
        "y": 240,
        "wires": [
            [
                "bc6bb2f523b00fa9",
                "a39145869b71df51",
                "2ef7f596c72004a1",
                "11ee4d2550f2e6b1",
                "bae6fc11c3f77385"
            ]
        ]
    },
    {
        "id": "4cc7f71877e27f96",
        "type": "junction",
        "z": "daf7a59ca2ce18df",
        "x": 740,
        "y": 920,
        "wires": [
            [
                "2a2eb5a77e70df62",
                "b2ad490ff03c2c97",
                "9214f5879d50fbe0",
                "e5e3bc3824864970",
                "4a191fd359629475",
                "a6948cd72ae1a796"
            ]
        ]
    },
    {
        "id": "0430675ed6c7cd83",
        "type": "redis-config",
        "name": "cipio redis",
        "options": "CIPIO_VALKEY_OPTIONS",
        "cluster": false,
        "optionsType": "env"
    },
    {
        "id": "46fa89673b9bfc15",
        "type": "ui_base",
        "theme": {
            "name": "theme-light",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#0094CE",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
            },
            "themeState": {
                "base-color": {
                    "default": "#0094CE",
                    "value": "#0094CE",
                    "edited": false
                },
                "page-titlebar-backgroundColor": {
                    "value": "#0094CE",
                    "edited": false
                },
                "page-backgroundColor": {
                    "value": "#fafafa",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#1bbfff",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#111111",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#0094ce",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey",
                "palette": "light"
            }
        },
        "site": {
            "name": "Node-RED Dashboard",
            "hideToolbar": "false",
            "allowSwipe": "false",
            "lockMenu": "false",
            "allowTempTheme": "true",
            "dateFormat": "DD/MM/YYYY",
            "sizes": {
                "sx": 48,
                "sy": 48,
                "gx": 6,
                "gy": 6,
                "cx": 6,
                "cy": 6,
                "px": 0,
                "py": 0
            }
        }
    },
    {
        "id": "8cdc313c9611f13f",
        "type": "ui-base",
        "name": "My Dashboard",
        "path": "/dashboard",
        "appIcon": "",
        "includeClientData": true,
        "acceptsClientConfig": [
            "ui-notification",
            "ui-control"
        ],
        "showPathInSidebar": false,
        "headerContent": "page",
        "navigationStyle": "icon",
        "titleBarStyle": "default",
        "showReconnectNotification": false,
        "notificationDisplayTime": "5",
        "showDisconnectNotification": false
    },
    {
        "id": "0d92c765bfad87e6",
        "type": "ui-theme",
        "name": "Basic Blue Theme",
        "colors": {
            "surface": "#4d58ff",
            "primary": "#0094ce",
            "bgPage": "#eeeeee",
            "groupBg": "#ffffff",
            "groupOutline": "#cccccc"
        },
        "sizes": {
            "pagePadding": "12px",
            "groupGap": "12px",
            "groupBorderRadius": "4px",
            "widgetGap": "12px",
            "density": "default"
        }
    },
    {
        "id": "0a8c3bb3babc19a4",
        "type": "ui-page",
        "name": "Drivers / TagID",
        "ui": "8cdc313c9611f13f",
        "path": "/drivers",
        "icon": "mdi-card-account-details-outline",
        "layout": "notebook",
        "theme": "0d92c765bfad87e6",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 3,
        "className": "",
        "visible": "true",
        "disabled": "false"
    },
    {
        "id": "447b58f3ddb86ab6",
        "type": "ui-group",
        "name": "Drivers List",
        "page": "0a8c3bb3babc19a4",
        "width": "6",
        "height": "1",
        "order": 1,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "7b05d2e15e8fc23c",
        "type": "ui-page",
        "name": "OCPP Log",
        "ui": "8cdc313c9611f13f",
        "path": "/ocpplogs",
        "icon": "mdi-book-open-variant",
        "layout": "notebook",
        "theme": "0d92c765bfad87e6",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 5,
        "className": "",
        "visible": true,
        "disabled": false
    },
    {
        "id": "7cb40fcee206391e",
        "type": "influxdb",
        "hostname": "influx2",
        "port": "8086",
        "protocol": "http",
        "database": "database",
        "name": "cipio.link",
        "usetls": false,
        "tls": "",
        "influxdbVersion": "2.0",
        "url": "http://influx2:8086",
        "timeout": "10",
        "rejectUnauthorized": true
    },
    {
        "id": "c187df53e1cacaad",
        "type": "ui-group",
        "name": "OCPP Log",
        "page": "7b05d2e15e8fc23c",
        "width": "6",
        "height": "1",
        "order": 1,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "e4ddc95d1509efab",
        "type": "ui-page",
        "name": "Transactions",
        "ui": "8cdc313c9611f13f",
        "path": "/sessions",
        "icon": "mdi-bullseye",
        "layout": "notebook",
        "theme": "0d92c765bfad87e6",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 4,
        "className": "",
        "visible": true,
        "disabled": "false"
    },
    {
        "id": "17fb40c0e949759b",
        "type": "ui-group",
        "name": "Transactions",
        "page": "e4ddc95d1509efab",
        "width": "6",
        "height": "1",
        "order": 1,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "a7002ddddf5f5b3b",
        "type": "ui-page",
        "name": "Home",
        "ui": "8cdc313c9611f13f",
        "path": "/home",
        "icon": "home",
        "layout": "notebook",
        "theme": "0d92c765bfad87e6",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 1,
        "className": "",
        "visible": true,
        "disabled": false
    },
    {
        "id": "01bc43f19d1edf0a",
        "type": "ui-page",
        "name": "EVSE Config",
        "ui": "8cdc313c9611f13f",
        "path": "/ocppconfig",
        "icon": "mdi-cog-transfer",
        "layout": "notebook",
        "theme": "0d92c765bfad87e6",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 6,
        "className": "",
        "visible": true,
        "disabled": false
    },
    {
        "id": "c04aff20955da79f",
        "type": "ui-group",
        "name": "EVSE Configuration",
        "page": "01bc43f19d1edf0a",
        "width": "6",
        "height": "1",
        "order": 1,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "213076b7a395d1a9",
        "type": "mqtt-broker",
        "name": "CIPio MQTT Broker",
        "broker": "mqtt",
        "port": "1883",
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "autoUnsubscribe": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthRetain": "false",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closeRetain": "false",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willRetain": "false",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "71a048bb2b0ae0b6",
        "type": "ui-page",
        "name": "Meters",
        "ui": "8cdc313c9611f13f",
        "path": "/meters",
        "icon": "mdi-speedometer",
        "layout": "grid",
        "theme": "0d92c765bfad87e6",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 7,
        "className": "",
        "visible": true,
        "disabled": false
    },
    {
        "id": "6e1897c297826e17",
        "type": "ui-group",
        "name": "Guages",
        "page": "71a048bb2b0ae0b6",
        "width": "6",
        "height": "1",
        "order": 1,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "0e43d0c136633834",
        "type": "ui-page",
        "name": "Settings",
        "ui": "8cdc313c9611f13f",
        "path": "/page8",
        "icon": "mdi-cogs",
        "layout": "notebook",
        "theme": "0d92c765bfad87e6",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 8,
        "className": "",
        "visible": "true",
        "disabled": "false"
    },
    {
        "id": "ace44af4012c4fc1",
        "type": "ui-group",
        "name": "EVSE",
        "page": "0e43d0c136633834",
        "width": "6",
        "height": "1",
        "order": 2,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "c48e064d37e64bbf",
        "type": "ui-group",
        "name": "Site",
        "page": "0e43d0c136633834",
        "width": "6",
        "height": "1",
        "order": 1,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "530fe8d240942ac0",
        "type": "ui-group",
        "name": "Summary",
        "page": "a7002ddddf5f5b3b",
        "width": "6",
        "height": "1",
        "order": 2,
        "showTitle": false,
        "className": "",
        "visible": true,
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "750f030497b122aa",
        "type": "ui-group",
        "name": "Meter Values",
        "page": "e4ddc95d1509efab",
        "width": "6",
        "height": "1",
        "order": 2,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "09addd16699c78ac",
        "type": "ui-page",
        "name": "EVSEs",
        "ui": "8cdc313c9611f13f",
        "path": "/evses",
        "icon": "mdi-ev-station",
        "layout": "notebook",
        "theme": "0d92c765bfad87e6",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 2,
        "className": "",
        "visible": true,
        "disabled": false
    },
    {
        "id": "1723c74d3f81385c",
        "type": "ui-group",
        "name": "EVSE List",
        "page": "09addd16699c78ac",
        "width": "6",
        "height": "1",
        "order": 1,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "276c45fccf8e6765",
        "type": "ui-group",
        "name": "Hidden",
        "page": "09addd16699c78ac",
        "width": "1",
        "height": "1",
        "order": 2,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "195e75b71683482a",
        "type": "ui-group",
        "name": "Map",
        "page": "a7002ddddf5f5b3b",
        "width": 6,
        "height": 1,
        "order": 5,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "1e933af2c31d3e40",
        "type": "ui-group",
        "name": "Banner",
        "page": "a7002ddddf5f5b3b",
        "width": 6,
        "height": 1,
        "order": 1,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "e254737171de6271",
        "type": "ocpp-remotej-cp",
        "z": "1bbb83617feb5d61",
        "name": "",
        "cbId": "evsesim1",
        "ocppver": "1.6j"
    },
    {
        "id": "39c5beabd3f595d6",
        "type": "ui-page",
        "name": "Info",
        "ui": "8cdc313c9611f13f",
        "path": "/info",
        "icon": "information-outline",
        "layout": "notebook",
        "theme": "0d92c765bfad87e6",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 9,
        "className": "",
        "visible": "true",
        "disabled": "false"
    },
    {
        "id": "ac3370e3a654aa16",
        "type": "ui-group",
        "name": "CSMS URL",
        "page": "39c5beabd3f595d6",
        "width": 6,
        "height": 1,
        "order": 3,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "605f98a93d6b516d",
        "type": "ui-group",
        "name": "Version",
        "page": "39c5beabd3f595d6",
        "width": 6,
        "height": 1,
        "order": 2,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "2ce6757429420e3d",
        "type": "ui-group",
        "name": "About",
        "page": "39c5beabd3f595d6",
        "width": 6,
        "height": 1,
        "order": 1,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "b10ea7d6e2aa85b8",
        "type": "modbustcp-server",
        "name": "",
        "host": "127.0.0.1",
        "port": 502,
        "unit_id": 1,
        "reconnecttimeout": ""
    },
    {
        "id": "dbf0d787ce369418",
        "type": "ui-group",
        "name": "Current Graph",
        "page": "a7002ddddf5f5b3b",
        "width": 6,
        "height": 1,
        "order": 3,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "588463f4dbc60e20",
        "type": "ui-group",
        "name": "Power Graph",
        "page": "a7002ddddf5f5b3b",
        "width": 6,
        "height": 1,
        "order": 4,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "565b9e3d1ccde32e",
        "type": "link in",
        "z": "1bbb83617feb5d61",
        "g": "f6e1783b4f8d6029",
        "name": "CL_SetTxDefaultProfile",
        "links": [
            "dec2c34e2f47883d"
        ],
        "x": 695,
        "y": 500,
        "wires": [
            [
                "dcc4d675cbe95527"
            ]
        ]
    },
    {
        "id": "d5ea45e6cb0d7090",
        "type": "link in",
        "z": "1bbb83617feb5d61",
        "g": "fac4518c226fbf0c",
        "name": "CL_Auth_StartTx",
        "links": [],
        "x": 685,
        "y": 660,
        "wires": [
            [
                "e930a4053f3ebf38"
            ]
        ]
    },
    {
        "id": "81b335ea88991f47",
        "type": "link out",
        "z": "1bbb83617feb5d61",
        "g": "fac4518c226fbf0c",
        "name": "link out 33",
        "mode": "link",
        "links": [
            "f5e6a6b98ad89c35"
        ],
        "x": 905,
        "y": 700,
        "wires": []
    },
    {
        "id": "7085c4e9b54ca5e5",
        "type": "link out",
        "z": "1bbb83617feb5d61",
        "g": "fac4518c226fbf0c",
        "name": "link out 31",
        "mode": "return",
        "links": [],
        "x": 895,
        "y": 620,
        "wires": []
    },
    {
        "id": "05dc69bf9c191b85",
        "type": "function",
        "z": "1bbb83617feb5d61",
        "g": "fac4518c226fbf0c",
        "name": "Save sessions context",
        "func": "if (msg.ocpp.command === \"StartTransaction\"){\n    let session = {}\n    session.cbId = msg.ocpp.chargeBoxIdentity\n    session.connectorId = msg.ocpp.connectorId\n    session.transactionId = msg.payload.transactionId\n    session.amps = msg.evse.amps\n    let sessions = global.get(\"CSMS:SESSIONS\") || []\n    sessions.push(session)\n    global.set(\"CSMS:SESSIONS\",sessions)\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 700,
        "wires": [
            [
                "bc558f4221526ddb"
            ]
        ]
    },
    {
        "id": "277e1a6705982260",
        "type": "link out",
        "z": "1bbb83617feb5d61",
        "g": "adad8cfed89e9a2e",
        "name": "link out 28",
        "mode": "link",
        "links": [
            "8eb3b8e8db8b77c7",
            "8bd502e33fe2ee01"
        ],
        "x": 1065,
        "y": 780,
        "wires": []
    },
    {
        "id": "74558ab2bc828dd9",
        "type": "function",
        "z": "1bbb83617feb5d61",
        "g": "adad8cfed89e9a2e",
        "name": "Smart Charge Management Algorithm",
        "func": "const currentTx = global.get(\"CSMS:SESSIONS\") || []\nconst loadLimit = global.get(\"SITE:LoadLimit\")\nlet adjustment = 1\n\nlet potential = 0\n\ncurrentTx.forEach(function(sess) {\n    potential += sess.amps\n})\n\nif (potential > loadLimit){\n    // Calculate an adjustment %\n    adjustment = 1 - ((( (potential - loadLimit ) / potential ) * 100) / 100)\n}\n\ncurrentTx.forEach(function(sess) {\n    msg = {}\n    msg.payload = {\n        command: \"SetChargingProfile\",\n        cbId: sess.cbId,\n        data: {\n            connectorId: sess.connectorId,\n            csChargingProfiles: {\n              chargingProfileId: 1,\n              transactionId: sess.transactionId,\n              stackLevel: 1,\n              chargingProfilePurpose: \"TxProfile\",\n              chargingProfileKind: \"Absolute\",\n              chargingSchedule: {\n                startSchedule: new Date().toISOString(),\n                chargingRateUnit: \"A\",\n                chargingSchedulePeriod: [\n                    {\n                        startPeriod: 0,\n                        limit: sess.amps * adjustment,\n                        numberPhases: 1\n                    }\n                ]\n              }  \n            }\n        }\n    }\n    msg.potential = potential\n    msg.adjustment = adjustment\n    msg.loadLimit = loadLimit\n    node.send(msg)\n});\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 880,
        "y": 780,
        "wires": [
            [
                "277e1a6705982260"
            ]
        ]
    },
    {
        "id": "3d9889d0e7face61",
        "type": "link out",
        "z": "1bbb83617feb5d61",
        "g": "f6e1783b4f8d6029",
        "name": "link out 27",
        "mode": "link",
        "links": [
            "8eb3b8e8db8b77c7"
        ],
        "x": 1205,
        "y": 480,
        "wires": []
    },
    {
        "id": "31cbb896896da083",
        "type": "link in",
        "z": "1bbb83617feb5d61",
        "g": "adad8cfed89e9a2e",
        "name": "CL_SCM",
        "links": [],
        "x": 685,
        "y": 780,
        "wires": [
            [
                "74558ab2bc828dd9",
                "317d216b8fa4f66a"
            ]
        ]
    },
    {
        "id": "20e60ae443b8c057",
        "type": "switch",
        "z": "1bbb83617feb5d61",
        "g": "fac4518c226fbf0c",
        "name": "StartTx Accepted",
        "property": "payload.idTagInfo.status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Accepted",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 990,
        "y": 660,
        "wires": [
            [
                "0cf0b97d82a84f68"
            ]
        ]
    },
    {
        "id": "e892b41d16a803e6",
        "type": "function",
        "z": "1bbb83617feb5d61",
        "g": "f6e1783b4f8d6029",
        "name": "Do Nothing",
        "func": "msg.payload = `Got a status of ${msg.payload.data.status}`\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1130,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "b348b5858bbb69e9",
        "type": "function",
        "z": "1bbb83617feb5d61",
        "g": "f6e1783b4f8d6029",
        "name": "Reset",
        "func": "let connectorId = 0\nlet cbId = msg.ocpp.chargeBoxIdentity\nlet amps = 6\n\nif (msg.payload.data.connectorId > 0){\n    connectorId = msg.payload.data.connectorId\n    msg.payload = {\n        command: \"SetChargingProfile\",\n        cbId,\n        data: {\n            connectorId,\n            csChargingProfiles: {\n              chargingProfileId: 1,\n              stackLevel: 1,\n              chargingProfilePurpose: \"TxDefaultProfile\",\n              chargingProfileKind: \"Absolute\",\n              chargingSchedule: {\n                chargingRateUnit: \"A\",\n                chargingSchedulePeriod: [\n                    {\n                        startPeriod: 0,\n                        limit: amps,\n                        numberPhases: 1\n                    }\n                ]\n              }  \n            }\n        }\n    }\n\n    return msg\n\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1110,
        "y": 480,
        "wires": [
            [
                "3d9889d0e7face61"
            ]
        ]
    },
    {
        "id": "dcc4d675cbe95527",
        "type": "switch",
        "z": "1bbb83617feb5d61",
        "g": "f6e1783b4f8d6029",
        "name": "Send Initial/Final ChargeProfile",
        "property": "payload.data.status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Preparing",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Available",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 870,
        "y": 500,
        "wires": [
            [
                "b348b5858bbb69e9"
            ],
            [
                "b348b5858bbb69e9"
            ],
            [
                "e892b41d16a803e6"
            ]
        ]
    },
    {
        "id": "e930a4053f3ebf38",
        "type": "function",
        "z": "1bbb83617feb5d61",
        "g": "fac4518c226fbf0c",
        "name": "Auth/Start Tx",
        "func": "// function handles both Authorize and StartTransaction\n// This generate a unique TxId, as long as the function doesn't get called twice\n// within the same millisecond\n\n\n// defaults\nconst ACCEPTED = \"Accepted\"\nlet status = ACCEPTED\nlet tags = []\n\n// copy message for the enhanced message with TxId\nlet msg2 = RED.util.cloneMessage(msg)\n\nmsg2.payload = {\n    idTagInfo: {\n        status\n    }\n}\n\nif (msg.ocpp.command === \"StartTransaction\"){\n    msg2.payload.transactionId = generateUniqueId()\n    //msg.ocpp.command = 'StartTransactionEnhanced'\n    //msg.payload.command = msg.ocpp.command\n    msg2.ocpp.connectorId = msg.payload.data.connectorId || 1\n}\n\n\nlet freeVend = global.get(\"CSMS:FreeVend\") \n    \nif (! freeVend ){\n    tags = global.get(\"CSMS:Tags\")\n\n    const result = tags.find((tag) => tag.tagId === msg.payload.data.idTag)\n\n    if (result){\n        if (!result.enabled){\n            msg2.payload.idTagInfo.status = \"Blocked\"\n        }\n        else if (result.expdate){\n            let expDate = new Date(result.expdate)\n            expDate.setHours(23, 59, 59, 999); // Set to the end of the day\n            let currentDate = new Date()\n\n            if (currentDate > expDate){\n                msg2.payload.idTagInfo.status = \"Expired\"\n            }\n            else {\n                msg2.payload.idTagInfo.expiryDate = expDate.toISOString()\n            }\n        } \n    }\n    else {\n        msg2.payload.idTagInfo.status = \"Invalid\"\n    }\n\n    if (msg2.payload.idTagInfo.status !== ACCEPTED){\n        msg2.payload.transactionId = 0\n    }\n\n}\n\nlet data\n\nif(msg.ocpp.command == \"StartTransaction\"){\n    data = msg.payload.data\n    data.transactionId = msg2.payload.transactionId\n    data.status = msg2.payload.idTagInfo.status\n    const ts = new Date(data.timestamp)\n    msg.timestamp = ts.getTime()\n    msg.cbId = msg2.ocpp.chargeBoxIdentity\n    msg.msgFrom = \"CS\"\n    msg.payload = [2,msg2.ocpp.MessageId,\"StartTransactionEnhanced\",data]\n} else {\n    msg = null\n} \n\nreturn [msg2,msg];\n\n\nfunction generateUniqueId() {\n    // Return a positive 32bit Int as a random TxId\n    const isoTimestamp = new Date().toISOString();\n    // Create a Date object from the ISO timestamp string\n    const date = new Date(isoTimestamp);\n\n    // Get the timestamp in seconds since the Unix epoch\n    const timestampInSeconds = Math.floor(date.getTime() / 1000);\n\n    // Calculate offset to ensure positive value within 32-bit signed range\n    const offset = timestampInSeconds < 0 ? 2147483648 : 0;\n\n    // Convert to 32-bit signed integer and apply offset\n    const int32Timestamp = (timestampInSeconds + offset) | 0;\n\n    return int32Timestamp;\n}\n",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 790,
        "y": 660,
        "wires": [
            [
                "20e60ae443b8c057",
                "7085c4e9b54ca5e5"
            ],
            [
                "81b335ea88991f47"
            ]
        ]
    },
    {
        "id": "0b35c35ff6b34816",
        "type": "CS server",
        "z": "1bbb83617feb5d61",
        "name": "CSMS Server",
        "port": "CIPIO_CSMS_PORT",
        "portType": "env",
        "enabled15": false,
        "path15": "/ocpp15s",
        "enabled16": false,
        "path16": "/ocpp16s",
        "enabled16j": true,
        "path16j": "${CIPIO_CSMS_PATH}",
        "log": false,
        "pathlog": "c:\\tmp\\OCPP__.log",
        "x": 110,
        "y": 280,
        "wires": [
            [
                "29ecf3de64707bd2",
                "7b10cc4aa964564d"
            ],
            [
                "b53020c58b6c45a9"
            ]
        ]
    },
    {
        "id": "fb654b19a6a965cd",
        "type": "server response",
        "z": "1bbb83617feb5d61",
        "name": "",
        "x": 980,
        "y": 280,
        "wires": []
    },
    {
        "id": "70bfca444e38cb32",
        "type": "CS request JSON",
        "z": "1bbb83617feb5d61",
        "name": "CS Req evse-001",
        "remotecb": "e254737171de6271",
        "command": "GetConfiguration",
        "cmddata": "",
        "log": true,
        "pathlog": "",
        "x": 250,
        "y": 40,
        "wires": [
            [
                "4a497f3abebf77a4"
            ]
        ]
    },
    {
        "id": "3c84a4a19698b6e3",
        "type": "comment",
        "z": "1bbb83617feb5d61",
        "name": "Basic OCPP Central System Server and supporting nodes",
        "info": "Change the port address and paths to meet your needs.\nThis is a very basic (does represent a fully functional CS) example",
        "x": 271,
        "y": 135,
        "wires": []
    },
    {
        "id": "1013277df36e9c6b",
        "type": "comment",
        "z": "1bbb83617feb5d61",
        "name": "Log all incoming msgs",
        "info": "",
        "x": 120,
        "y": 340,
        "wires": []
    },
    {
        "id": "79545bf715d76089",
        "type": "comment",
        "z": "1bbb83617feb5d61",
        "name": "Example with JSON 1.6",
        "info": "Keep in mind that some of the basic CS responses vary depending on OCPP 1.5 vs 1.6",
        "x": 231,
        "y": 175,
        "wires": []
    },
    {
        "id": "8eb3b8e8db8b77c7",
        "type": "link in",
        "z": "1bbb83617feb5d61",
        "name": "Send OCPP CMD",
        "links": [
            "3d9889d0e7face61",
            "277e1a6705982260",
            "999d9205e0499c3c"
        ],
        "x": 125,
        "y": 80,
        "wires": [
            [
                "70bfca444e38cb32"
            ]
        ]
    },
    {
        "id": "8bd502e33fe2ee01",
        "type": "link in",
        "z": "1bbb83617feb5d61",
        "name": "Send Debug Output",
        "links": [
            "277e1a6705982260"
        ],
        "x": 825,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "29b7e74ff8279110",
        "type": "function",
        "z": "1bbb83617feb5d61",
        "name": "BootNotification",
        "func": "//Load defaults\nconst interval = global.get(\"CSMS:HeartBeatInterval\") ?? 120\nconst currentTime = new Date().toISOString()\nconst validEVSEs = global.get(\"CSMS:EVSEs\") ?? []\n\nlet status = (validEVSEs.find((cbId) => cbId === msg.ocpp.chargeBoxIdentity) != undefined) ? \"Accepted\" : \"Rejected\"\n\n\nmsg.payload = {\n    interval,\n    currentTime,\n    status\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 180,
        "y": 520,
        "wires": [
            [
                "e09d8995ecbe67f7",
                "a3ed9085610d4b68"
            ]
        ]
    },
    {
        "id": "041c7cd4a35efa4d",
        "type": "link in",
        "z": "1bbb83617feb5d61",
        "name": "Server Response Node",
        "links": [
            "fb6d59603b2b3beb"
        ],
        "x": 825,
        "y": 280,
        "wires": [
            [
                "fb654b19a6a965cd"
            ]
        ]
    },
    {
        "id": "e09d8995ecbe67f7",
        "type": "link out",
        "z": "1bbb83617feb5d61",
        "name": "link out 30",
        "mode": "return",
        "links": [],
        "x": 285,
        "y": 520,
        "wires": []
    },
    {
        "id": "f5e6a6b98ad89c35",
        "type": "link in",
        "z": "1bbb83617feb5d61",
        "name": "OCPP Logging Port",
        "links": [
            "81b335ea88991f47",
            "b53020c58b6c45a9"
        ],
        "x": 825,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "b53020c58b6c45a9",
        "type": "link out",
        "z": "1bbb83617feb5d61",
        "name": "link out 32",
        "mode": "link",
        "links": [
            "f5e6a6b98ad89c35"
        ],
        "x": 275,
        "y": 340,
        "wires": []
    },
    {
        "id": "0508b4312099eed7",
        "type": "link in",
        "z": "1bbb83617feb5d61",
        "name": "OCPP Msg Port",
        "links": [
            "29ecf3de64707bd2",
            "4a497f3abebf77a4"
        ],
        "x": 825,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "29ecf3de64707bd2",
        "type": "link out",
        "z": "1bbb83617feb5d61",
        "name": "link out 34",
        "mode": "link",
        "links": [
            "0508b4312099eed7"
        ],
        "x": 275,
        "y": 220,
        "wires": []
    },
    {
        "id": "4a497f3abebf77a4",
        "type": "link out",
        "z": "1bbb83617feb5d61",
        "name": "link out 35",
        "mode": "link",
        "links": [
            "0508b4312099eed7"
        ],
        "x": 405,
        "y": 40,
        "wires": []
    },
    {
        "id": "50d2e6f3bb1e94f5",
        "type": "link in",
        "z": "1bbb83617feb5d61",
        "name": "CL_BootNotification",
        "links": [],
        "x": 55,
        "y": 520,
        "wires": [
            [
                "29b7e74ff8279110"
            ]
        ]
    },
    {
        "id": "58a508d07089ac02",
        "type": "change",
        "z": "1bbb83617feb5d61",
        "name": "Heartbeat",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "payload.currentTime",
                "pt": "msg",
                "to": "$now()",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 160,
        "y": 560,
        "wires": [
            [
                "d363a59df51b1603"
            ]
        ]
    },
    {
        "id": "d363a59df51b1603",
        "type": "link out",
        "z": "1bbb83617feb5d61",
        "name": "link out 37",
        "mode": "return",
        "links": [],
        "x": 285,
        "y": 560,
        "wires": []
    },
    {
        "id": "26c6df27758d1898",
        "type": "link in",
        "z": "1bbb83617feb5d61",
        "name": "CL_Heartbeat",
        "links": [],
        "x": 55,
        "y": 560,
        "wires": [
            [
                "58a508d07089ac02"
            ]
        ]
    },
    {
        "id": "b109c9e3b6b4ef7a",
        "type": "change",
        "z": "1bbb83617feb5d61",
        "name": "StopTransaction",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"idTagInfo\":{\"status\":\"Accepted\"}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 180,
        "y": 620,
        "wires": [
            [
                "d822835855e62f28"
            ]
        ]
    },
    {
        "id": "c65873db62d0456e",
        "type": "function",
        "z": "1bbb83617feb5d61",
        "name": "Remove from active sessions",
        "func": "let sessions = global.get(\"CSMS:SESSIONS\") || []\nlet cbId = msg.ocpp.chargeBoxIdentity\nlet transactionId = msg.payload.data.transactionId\n\nlet updated_sessions = sessions.filter( sess => (sess.cbId == cbId && sess.transactionId == transactionId) == false)\nmsg = {\n    payload: {\n        updated_sessions,\n        cbId,\n        transactionId\n    }\n}\n\nglobal.set(\"CSMS:SESSIONS\", updated_sessions)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 220,
        "y": 660,
        "wires": [
            [
                "bbed1bd5b44c8a60"
            ]
        ]
    },
    {
        "id": "98a99004fba3ce97",
        "type": "link in",
        "z": "1bbb83617feb5d61",
        "name": "CL_StopTransaction",
        "links": [],
        "x": 55,
        "y": 660,
        "wires": [
            [
                "c65873db62d0456e",
                "b109c9e3b6b4ef7a"
            ]
        ]
    },
    {
        "id": "4df5bbe3dc069615",
        "type": "change",
        "z": "1bbb83617feb5d61",
        "name": "Generic Return",
        "rules": [
            {
                "t": "set",
                "p": "ocpp.data",
                "pt": "msg",
                "to": "payload.data",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 180,
        "y": 480,
        "wires": [
            [
                "f15df67d396f9ee3"
            ]
        ]
    },
    {
        "id": "20e77c4a2c2e1bc8",
        "type": "link in",
        "z": "1bbb83617feb5d61",
        "name": "CL_Generic",
        "links": [
            "dec2c34e2f47883d"
        ],
        "x": 55,
        "y": 480,
        "wires": [
            [
                "4df5bbe3dc069615"
            ]
        ]
    },
    {
        "id": "f15df67d396f9ee3",
        "type": "link out",
        "z": "1bbb83617feb5d61",
        "name": "link out 41",
        "mode": "return",
        "links": [],
        "x": 285,
        "y": 480,
        "wires": []
    },
    {
        "id": "d822835855e62f28",
        "type": "link out",
        "z": "1bbb83617feb5d61",
        "name": "link out 45",
        "mode": "return",
        "links": [],
        "x": 295,
        "y": 620,
        "wires": []
    },
    {
        "id": "7b10cc4aa964564d",
        "type": "function",
        "z": "1bbb83617feb5d61",
        "name": "Map Commands",
        "func": "if (msg?.payload?.command){\n    const reqMap = global.get(\"CSMS:Req_Map\");\n    const command = msg.payload.command\n\n    if (reqMap.has(command)){\n        msg.target = reqMap.get(command)\n    }\n    else {\n        msg.target = `CL_${command}`\n        switch(msg.payload.command){\n            case \"BootNotification\":\n                break;\n            case \"StatusNotification\":\n                break;\n            case \"Authorize\":\n            case \"StartTransaction\":\n                msg.target = \"CL_Auth_StartTx\"\n                break;\n            case \"StopTransaction\":\n                break;\n            case \"DataTransfer\":\n                break;\n            case \"Heartbeat\":\n                break;\n            case \"MeterValues\":\n            case \"FirmwareStatusNotification\":\n            case \"DiagnosticsStatusNotification\":\n                msg.target = \"CL_Generic\";\n                break;\n            default:\n                return;\n            break;\n        }\n    }\n    return msg;\n}\nelse {\n    return;\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\nconst reqMap = new Map()\nglobal.set(\"CSMS:Req_Map\",reqMap)",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 280,
        "wires": [
            [
                "54b69c32249426ce"
            ]
        ]
    },
    {
        "id": "54b69c32249426ce",
        "type": "link call",
        "z": "1bbb83617feb5d61",
        "name": "",
        "links": [],
        "linkType": "dynamic",
        "timeout": "30",
        "x": 560,
        "y": 280,
        "wires": [
            [
                "fb6d59603b2b3beb"
            ]
        ]
    },
    {
        "id": "fb6d59603b2b3beb",
        "type": "link out",
        "z": "1bbb83617feb5d61",
        "name": "link out 16",
        "mode": "link",
        "links": [
            "041c7cd4a35efa4d"
        ],
        "x": 685,
        "y": 280,
        "wires": []
    },
    {
        "id": "120b3e12226d45fa",
        "type": "link in",
        "z": "1bbb83617feb5d61",
        "name": "CL_DataTransfer",
        "links": [],
        "x": 55,
        "y": 440,
        "wires": [
            [
                "bb8501896177294a"
            ]
        ]
    },
    {
        "id": "841bf57c5d32ad57",
        "type": "link out",
        "z": "1bbb83617feb5d61",
        "name": "link out 36",
        "mode": "return",
        "links": [],
        "x": 285,
        "y": 440,
        "wires": []
    },
    {
        "id": "bb8501896177294a",
        "type": "change",
        "z": "1bbb83617feb5d61",
        "name": "DataTransfer",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"status\":\"Accepted\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 170,
        "y": 440,
        "wires": [
            [
                "841bf57c5d32ad57"
            ]
        ]
    },
    {
        "id": "bc558f4221526ddb",
        "type": "function",
        "z": "1bbb83617feb5d61",
        "g": "fac4518c226fbf0c",
        "name": "function 6",
        "func": "const command = \"SCM\"\nconst reqMap = global.get(\"CSMS:Req_Map\");\n\n//default target\nmsg.target = \"CL_SCM\"\n\n// Override target\nif (reqMap.has(command)){\n    msg.target = reqMap.get(command)\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1420,
        "y": 700,
        "wires": [
            [
                "1a959d6556da3c19"
            ]
        ]
    },
    {
        "id": "1a959d6556da3c19",
        "type": "link call",
        "z": "1bbb83617feb5d61",
        "g": "fac4518c226fbf0c",
        "name": "SCM",
        "links": [],
        "linkType": "dynamic",
        "timeout": "30",
        "x": 1550,
        "y": 700,
        "wires": [
            []
        ]
    },
    {
        "id": "317d216b8fa4f66a",
        "type": "link out",
        "z": "1bbb83617feb5d61",
        "g": "adad8cfed89e9a2e",
        "name": "link out 26",
        "mode": "return",
        "links": [],
        "x": 745,
        "y": 820,
        "wires": []
    },
    {
        "id": "d8c533dd612d0df0",
        "type": "link in",
        "z": "1bbb83617feb5d61",
        "name": "CL_StatusNotification",
        "links": [],
        "x": 65,
        "y": 720,
        "wires": [
            [
                "dec2c34e2f47883d"
            ]
        ]
    },
    {
        "id": "e855a16be03e78b3",
        "type": "comment",
        "z": "1bbb83617feb5d61",
        "name": "StatusNotification",
        "info": "",
        "x": 160,
        "y": 880,
        "wires": []
    },
    {
        "id": "b19a54056e36c12d",
        "type": "comment",
        "z": "1bbb83617feb5d61",
        "name": "Outputs",
        "info": "",
        "x": 850,
        "y": 60,
        "wires": []
    },
    {
        "id": "bbed1bd5b44c8a60",
        "type": "function",
        "z": "1bbb83617feb5d61",
        "name": "Get SCM node",
        "func": "const command = \"SCM\"\nconst reqMap = global.get(\"CSMS:Req_Map\") || new Map();\n\n//default target\nmsg.target = \"CL_SCM\"\n\n// Override target\nif (reqMap.has(command)){\n    msg.target = reqMap.get(command)\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 660,
        "wires": [
            [
                "f6128d47522c0a77"
            ]
        ]
    },
    {
        "id": "f6128d47522c0a77",
        "type": "link call",
        "z": "1bbb83617feb5d61",
        "name": "SCM",
        "links": [],
        "linkType": "dynamic",
        "timeout": "30",
        "x": 590,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "80a77a8a82c0f361",
        "type": "comment",
        "z": "1bbb83617feb5d61",
        "name": "Default Request Responses",
        "info": "",
        "x": 160,
        "y": 400,
        "wires": []
    },
    {
        "id": "dec2c34e2f47883d",
        "type": "link out",
        "z": "1bbb83617feb5d61",
        "name": "link out 29",
        "mode": "link",
        "links": [
            "20e77c4a2c2e1bc8",
            "565b9e3d1ccde32e"
        ],
        "x": 145,
        "y": 720,
        "wires": []
    },
    {
        "id": "2b61a29bf378cb19",
        "type": "link in",
        "z": "1bbb83617feb5d61",
        "g": "fac4518c226fbf0c",
        "name": "link in 2",
        "links": [
            "8dd31db647e97e9a"
        ],
        "x": 1115,
        "y": 700,
        "wires": [
            [
                "05dc69bf9c191b85"
            ]
        ]
    },
    {
        "id": "0cf0b97d82a84f68",
        "type": "change",
        "z": "1bbb83617feb5d61",
        "g": "fac4518c226fbf0c",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload2",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$join([\"evse:\",ocpp.chargeBoxIdentity])",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1200,
        "y": 660,
        "wires": [
            [
                "36d20d6f10701b5e"
            ]
        ]
    },
    {
        "id": "36d20d6f10701b5e",
        "type": "redis-command",
        "z": "1bbb83617feb5d61",
        "g": "fac4518c226fbf0c",
        "server": "0430675ed6c7cd83",
        "command": "GET",
        "name": "",
        "topic": "",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 1360,
        "y": 660,
        "wires": [
            [
                "aa717d0237b2f9f2"
            ]
        ]
    },
    {
        "id": "aa717d0237b2f9f2",
        "type": "json",
        "z": "1bbb83617feb5d61",
        "g": "fac4518c226fbf0c",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1490,
        "y": 660,
        "wires": [
            [
                "ba2cbe8ea7210112"
            ]
        ]
    },
    {
        "id": "ba2cbe8ea7210112",
        "type": "change",
        "z": "1bbb83617feb5d61",
        "g": "fac4518c226fbf0c",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "evse",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "evse.amps",
                "pt": "msg",
                "to": "$number(payload.amps)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload2",
                "tot": "msg"
            },
            {
                "t": "delete",
                "p": "payload2",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1640,
        "y": 660,
        "wires": [
            [
                "8dd31db647e97e9a"
            ]
        ]
    },
    {
        "id": "8dd31db647e97e9a",
        "type": "link out",
        "z": "1bbb83617feb5d61",
        "g": "fac4518c226fbf0c",
        "name": "link out 39",
        "mode": "link",
        "links": [
            "2b61a29bf378cb19"
        ],
        "x": 1765,
        "y": 680,
        "wires": []
    },
    {
        "id": "a3ed9085610d4b68",
        "type": "delay",
        "z": "1bbb83617feb5d61",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 325,
        "y": 520,
        "wires": [
            [
                "ed4a4b99e2a754d0"
            ]
        ],
        "l": false
    },
    {
        "id": "ed4a4b99e2a754d0",
        "type": "function",
        "z": "1bbb83617feb5d61",
        "name": "Chg Config MVInterval",
        "func": "let mvint = global.get(\"CSMS:MVSampleInterval\") || 61\n\nlet payload = {\n    cbId: msg.ocpp.chargeBoxIdentity,\n    command: \"ChangeConfiguration\",\n    data: {\n        key: \"MeterValueSampleInterval\",\n        value: `${mvint}`\n    }\n}\nmsg = { payload }\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 520,
        "wires": [
            [
                "999d9205e0499c3c"
            ]
        ]
    },
    {
        "id": "999d9205e0499c3c",
        "type": "link out",
        "z": "1bbb83617feb5d61",
        "name": "link out 56",
        "mode": "link",
        "links": [
            "8eb3b8e8db8b77c7"
        ],
        "x": 595,
        "y": 520,
        "wires": []
    },
    {
        "id": "4f4c8a9f1f8d9bb4",
        "type": "function",
        "z": "9ca80d42115ee3c3",
        "g": "f6f7b333be6e5917",
        "name": "EXAMPLE: Enable Overrides",
        "func": "// Global Context ocppCmdTargets is a Map object\n\nlet ctx = 'ocppCmdTargets'\n\n//Get the current map\nlet targetMap = global.get(ctx)\n\n// Set new targets for ocpp commands\ntargetMap.set('BootNotification','EXAMPLE_BootNotification')\ntargetMap.set('Heartbeat','EXAMPLE_Heartbeat')\n\n\n// As an example to clear out a user defined ocpp function and return to defaults, do:\n// targetMap.delete('BootNotification')\n\n\n// Set the map back to the global context so the CSMS subflow can use them\nglobal.set(ctx, targetMap)\nreturn\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 660,
        "y": 760,
        "wires": [
            []
        ]
    },
    {
        "id": "056c40eb67d6fe4c",
        "type": "link in",
        "z": "9ca80d42115ee3c3",
        "g": "f6f7b333be6e5917",
        "name": "EXAMPLE_BootNotification",
        "links": [],
        "x": 105,
        "y": 780,
        "wires": [
            [
                "9298f921e122faa5"
            ]
        ]
    },
    {
        "id": "fa1a321403a73088",
        "type": "link out",
        "z": "9ca80d42115ee3c3",
        "g": "f6f7b333be6e5917",
        "name": "link out 55",
        "mode": "return",
        "links": [],
        "x": 405,
        "y": 780,
        "wires": []
    },
    {
        "id": "9298f921e122faa5",
        "type": "function",
        "z": "9ca80d42115ee3c3",
        "g": "f6f7b333be6e5917",
        "name": "BootNotification",
        "func": "//Load defaults\nconst interval = global.get(\"CSMS:HeartBeatInterval\") ?? 120\nconst currentTime = new Date().toISOString()\nconst validEVSEs = global.get(\"CSMS:EVSEs\") ?? []\n\nlet status = (validEVSEs.find((cbId) => cbId === msg.ocpp.chargeBoxIdentity) != undefined) ? \"Accepted\" : \"Rejected\"\n\nmsg.payload = {\n    interval,\n    currentTime,\n    status\n}\n\nmsg.ack = true\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 780,
        "wires": [
            [
                "fa1a321403a73088"
            ]
        ]
    },
    {
        "id": "7283d4e60852fabc",
        "type": "change",
        "z": "9ca80d42115ee3c3",
        "g": "f6f7b333be6e5917",
        "name": "Heartbeat",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "payload.currentTime",
                "pt": "msg",
                "to": "$now()",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "ack",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 240,
        "y": 740,
        "wires": [
            [
                "2b16b2bbbd57fabc"
            ]
        ]
    },
    {
        "id": "2b16b2bbbd57fabc",
        "type": "link out",
        "z": "9ca80d42115ee3c3",
        "g": "f6f7b333be6e5917",
        "name": "HB_OUT",
        "mode": "return",
        "links": [],
        "x": 395,
        "y": 740,
        "wires": []
    },
    {
        "id": "1e88d1e2d4dcc7d3",
        "type": "link in",
        "z": "9ca80d42115ee3c3",
        "g": "f6f7b333be6e5917",
        "name": "EXAMPLE_Heartbeat",
        "links": [],
        "x": 105,
        "y": 740,
        "wires": [
            [
                "7283d4e60852fabc"
            ]
        ]
    },
    {
        "id": "02e68d94d30084bf",
        "type": "debug",
        "z": "9ca80d42115ee3c3",
        "g": "c20c8766fa664d2e",
        "name": "MSG 2",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 480,
        "y": 860,
        "wires": []
    },
    {
        "id": "9553dfbcb3b284b3",
        "type": "debug",
        "z": "9ca80d42115ee3c3",
        "g": "c20c8766fa664d2e",
        "name": "MSG",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 450,
        "y": 960,
        "wires": []
    },
    {
        "id": "3890b31b33998ff0",
        "type": "link out",
        "z": "9ca80d42115ee3c3",
        "g": "c20c8766fa664d2e",
        "name": "link out 54",
        "mode": "link",
        "links": [
            "25afca3af5d04a0d"
        ],
        "x": 855,
        "y": 900,
        "wires": []
    },
    {
        "id": "378785534c46db9b",
        "type": "function",
        "z": "9ca80d42115ee3c3",
        "g": "c20c8766fa664d2e",
        "name": "Save sessions context",
        "func": "if (msg.ocpp.command === \"StartTransaction\"){\n    let session = {}\n    session.cbId = msg.ocpp.chargeBoxIdentity\n    session.connectorId = msg.ocpp.connectorId\n    session.transactionId = msg.payload.transactionId\n    session.amps = (session.cbId == \"EVOChargeLab1\") ? 32 : 40\n    let sessions = global.get(\"CSMS:SESSIONS\") || []\n    sessions.push(session)\n    global.set(\"CSMS:SESSIONS\",sessions)\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 900,
        "wires": [
            [
                "3890b31b33998ff0"
            ]
        ]
    },
    {
        "id": "08c6daf9b344995d",
        "type": "link out",
        "z": "9ca80d42115ee3c3",
        "g": "c20c8766fa664d2e",
        "name": "link out 53",
        "mode": "link",
        "links": [
            "31dee9642ab622cd"
        ],
        "x": 345,
        "y": 940,
        "wires": []
    },
    {
        "id": "1b09a234a1e45737",
        "type": "link out",
        "z": "9ca80d42115ee3c3",
        "g": "c20c8766fa664d2e",
        "name": "link out 52",
        "mode": "return",
        "links": [],
        "x": 335,
        "y": 880,
        "wires": []
    },
    {
        "id": "e2a9a4f6ea0938e9",
        "type": "switch",
        "z": "9ca80d42115ee3c3",
        "g": "c20c8766fa664d2e",
        "name": "StartTx Accepted",
        "property": "payload.idTagInfo.status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Accepted",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 500,
        "y": 900,
        "wires": [
            [
                "378785534c46db9b"
            ]
        ]
    },
    {
        "id": "5bb26352bd2d7e5a",
        "type": "link in",
        "z": "9ca80d42115ee3c3",
        "g": "c20c8766fa664d2e",
        "name": "EXAMPLE_Auth_StartTx",
        "links": [],
        "x": 125,
        "y": 920,
        "wires": [
            [
                "c71183f6d99d46ef"
            ]
        ]
    },
    {
        "id": "c71183f6d99d46ef",
        "type": "function",
        "z": "9ca80d42115ee3c3",
        "g": "c20c8766fa664d2e",
        "name": "Auth/Start Tx",
        "func": "// function handles both Authorize and StartTransaction\n// This generate a unique TxId, as long as the function doesn't get called twice\n// within the same millisecond\n\n\n// defaults\nconst ACCEPTED = \"Accepted\"\nlet status = ACCEPTED\nlet tags = []\n\n// copy message for the enhanced message with TxId\nlet msg2 = RED.util.cloneMessage(msg)\n\nmsg2.payload = {\n    idTagInfo: {\n        status\n    }\n}\n\nif (msg.ocpp.command === \"StartTransaction\"){\n    msg2.payload.transactionId = generateUniqueId()\n    msg.ocpp.command = 'StartTransactionEnhanced'\n    msg.payload.command = msg.ocpp.command\n    msg2.ocpp.connectorId = msg.payload.data.connectorId || 1\n}\n\nlet freeVend = global.get(\"CSMS:FreeVend\") \n    \nif (! freeVend ){\n    tags = global.get(\"CSMS:Tags\")\n\n    const result = tags.find((tag) => tag.tagId === msg.payload.data.idTag)\n\n    if (result){\n        if (!result.enabled){\n            msg2.payload.idTagInfo.status = \"Blocked\"\n        }\n        else if (result.expdate){\n            let expDate = new Date(result.expdate)\n            expDate.setHours(23, 59, 59, 999); // Set to the end of the day\n            let currentDate = new Date()\n\n            if (currentDate > expDate){\n                msg2.payload.idTagInfo.status = \"Expired\"\n            }\n            else {\n                msg2.payload.idTagInfo.expiryDate = expDate.toISOString()\n            }\n        } \n    }\n    else {\n        msg2.payload.idTagInfo.status = \"Invalid\"\n    }\n\n    if (msg2.payload.idTagInfo.status !== ACCEPTED){\n        msg2.payload.transactionId = 0\n    }\n\n}\n\nlet data\n\nif(msg.ocpp.command == \"StartTransactionEnhanced\"){\n    data = msg.payload.data\n    data.transactionId = msg2.payload.transactionId\n    data.status = msg2.payload.idTagInfo.status\n    const ts = new Date(data.timestamp)\n    msg.timestamp = ts.getTime()\n    msg.cbId = msg2.ocpp.chargeBoxIdentity\n    msg.msgFrom = \"CS\"\n    msg.payload = [2,msg2.ocpp.MessageId,\"StartTransactionEnhanced\",data]\n} else {\n    msg = null\n}\n\nmsg2.ack = true\n\nreturn [msg2,msg];\n\n\nfunction generateUniqueId() {\n    // Return a positive 32bit Int as a random TxId\n    const isoTimestamp = new Date().toISOString();\n    // Create a Date object from the ISO timestamp string\n    const date = new Date(isoTimestamp);\n\n    // Get the timestamp in seconds since the Unix epoch\n    const timestampInSeconds = Math.floor(date.getTime() / 1000);\n\n    // Calculate offset to ensure positive value within 32-bit signed range\n    const offset = timestampInSeconds < 0 ? 2147483648 : 0;\n\n    // Convert to 32-bit signed integer and apply offset\n    const int32Timestamp = (timestampInSeconds + offset) | 0;\n\n    return int32Timestamp;\n}\n\n/*\n// msg format\n//\n{\n    \"timestamp\":1735842833857,\n    \"cbId\":\"evsesim1\",\n    \"msgFrom\":\"CS\",\n    \"payload\":\n        [\n            2,\n            \"d5f3026e-d602-4ab8-a009-bcdef17932e3\",\n            \"StartTransaction\",\n            {\"connectorId\":1,\"idTag\":\"ccc\",\"meterStart\":2004,\"timestamp\":\"2025-01-02T18:33:53.856Z\"}\n         ],\n         \"_msgid\":\"6dc75f6161d5a70b\"\n}\n*/",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 230,
        "y": 920,
        "wires": [
            [
                "e2a9a4f6ea0938e9",
                "1b09a234a1e45737",
                "02e68d94d30084bf"
            ],
            [
                "08c6daf9b344995d",
                "9553dfbcb3b284b3"
            ]
        ]
    },
    {
        "id": "1186737eeaebd401",
        "type": "link out",
        "z": "9ca80d42115ee3c3",
        "g": "23d227486f4a19f5",
        "name": "link out 51",
        "mode": "return",
        "links": [],
        "x": 495,
        "y": 1080,
        "wires": []
    },
    {
        "id": "668279fcb445ce5d",
        "type": "function",
        "z": "9ca80d42115ee3c3",
        "g": "23d227486f4a19f5",
        "name": "Smart Charge Management Algorithm",
        "func": "const currentTx = global.get(\"CSMS:SESSIONS\") || []\nconst loadLimit = global.get(\"SITE:LoadLimit\")\nlet adjustment = 1\n\nlet potential = 0\n\ncurrentTx.forEach(function(sess) {\n    potential += sess.amps\n})\n\nif (potential > loadLimit){\n    // Calculate an adjustment %\n    adjustment = 1 - ((( (potential - loadLimit ) / potential ) * 100) / 100)\n}\n\ncurrentTx.forEach(function(sess) {\n    msg = {}\n    msg.payload = {\n        command: \"SetChargingProfile\",\n        cbId: sess.cbId,\n        data: {\n            connectorId: sess.connectorId,\n            csChargingProfiles: {\n              chargingProfileId: 1,\n              transactionId: sess.transactionId,\n              stackLevel: 1,\n              chargingProfilePurpose: \"TxProfile\",\n              chargingProfileKind: \"Absolute\",\n              chargingSchedule: {\n                startSchedule: new Date().toISOString(),\n                chargingRateUnit: \"A\",\n                chargingSchedulePeriod: [\n                    {\n                        startPeriod: 0,\n                        limit: sess.amps * adjustment,\n                        numberPhases: 1\n                    }\n                ]\n              }  \n            }\n        }\n    }\n    msg.potential = potential\n    msg.adjustment = adjustment\n    msg.loadLimit = loadLimit\n    node.send(msg)\n});\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 1080,
        "wires": [
            [
                "1186737eeaebd401"
            ]
        ]
    },
    {
        "id": "25afca3af5d04a0d",
        "type": "link in",
        "z": "9ca80d42115ee3c3",
        "g": "23d227486f4a19f5",
        "name": "Generate ChargeProfiles",
        "links": [
            "3890b31b33998ff0"
        ],
        "x": 125,
        "y": 1080,
        "wires": [
            [
                "668279fcb445ce5d"
            ]
        ]
    },
    {
        "id": "a1f721f1a03c965a",
        "type": "link out",
        "z": "9ca80d42115ee3c3",
        "g": "a0169f65e4967ec2",
        "name": "link out 17",
        "mode": "link",
        "links": [
            "19a1d55d0ad937f5"
        ],
        "x": 1275,
        "y": 480,
        "wires": []
    },
    {
        "id": "d836b12b64275a9d",
        "type": "link in",
        "z": "9ca80d42115ee3c3",
        "g": "a0169f65e4967ec2",
        "name": "Update TS",
        "links": [
            "846c6af009c205bd"
        ],
        "x": 145,
        "y": 480,
        "wires": [
            [
                "868ca4fd5276022e"
            ]
        ]
    },
    {
        "id": "d2d365e869ae5aa3",
        "type": "redis-command",
        "z": "9ca80d42115ee3c3",
        "g": "a0169f65e4967ec2",
        "server": "0430675ed6c7cd83",
        "command": "SET",
        "name": "",
        "topic": "",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 1160,
        "y": 480,
        "wires": [
            [
                "a1f721f1a03c965a"
            ]
        ]
    },
    {
        "id": "7bc0d39e117db98a",
        "type": "json",
        "z": "9ca80d42115ee3c3",
        "g": "a0169f65e4967ec2",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1020,
        "y": 480,
        "wires": [
            [
                "d2d365e869ae5aa3"
            ]
        ]
    },
    {
        "id": "34b27b38f2e7609a",
        "type": "change",
        "z": "9ca80d42115ee3c3",
        "g": "a0169f65e4967ec2",
        "name": "Update TS",
        "rules": [
            {
                "t": "set",
                "p": "payload.lastcommtime",
                "pt": "msg",
                "to": "timestamp",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 880,
        "y": 480,
        "wires": [
            [
                "7bc0d39e117db98a"
            ]
        ]
    },
    {
        "id": "b952178113645c64",
        "type": "json",
        "z": "9ca80d42115ee3c3",
        "g": "a0169f65e4967ec2",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 750,
        "y": 480,
        "wires": [
            [
                "34b27b38f2e7609a"
            ]
        ]
    },
    {
        "id": "e07f99fdfc73cd44",
        "type": "change",
        "z": "9ca80d42115ee3c3",
        "g": "a0169f65e4967ec2",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "\"evse:\" & msg.cbId",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 460,
        "y": 480,
        "wires": [
            [
                "124fa94892413c81"
            ]
        ]
    },
    {
        "id": "124fa94892413c81",
        "type": "redis-command",
        "z": "9ca80d42115ee3c3",
        "g": "a0169f65e4967ec2",
        "server": "0430675ed6c7cd83",
        "command": "GET",
        "name": "",
        "topic": "",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 620,
        "y": 480,
        "wires": [
            [
                "b952178113645c64"
            ]
        ]
    },
    {
        "id": "868ca4fd5276022e",
        "type": "switch",
        "z": "9ca80d42115ee3c3",
        "g": "a0169f65e4967ec2",
        "name": "Filter from CS only",
        "property": "msgFrom",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "CS",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 270,
        "y": 480,
        "wires": [
            [
                "e07f99fdfc73cd44"
            ]
        ]
    },
    {
        "id": "fdaa305606c3401a",
        "type": "subflow:1bbb83617feb5d61",
        "z": "9ca80d42115ee3c3",
        "name": "",
        "env": [
            {
                "name": "CSMS_PORT",
                "value": "8834",
                "type": "num"
            }
        ],
        "x": 550,
        "y": 80,
        "wires": [
            [
                "0bfecc1d6f524575",
                "ac99e09b91853939"
            ],
            [
                "846c6af009c205bd",
                "53e5e6b513fae4c6"
            ],
            [
                "2690df904d04509c"
            ]
        ]
    },
    {
        "id": "c001b42457967649",
        "type": "debug",
        "z": "9ca80d42115ee3c3",
        "name": "debug 24",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 980,
        "y": 40,
        "wires": []
    },
    {
        "id": "44e8fa5ea6d0b7fe",
        "type": "function",
        "z": "9ca80d42115ee3c3",
        "name": "LOCAL_SET_ALL_AUTH_EVSES",
        "func": "let evse_array = msg.payload;\n\nmsg.payload = {}\nmsg.payload.command = \"LOCAL_SET_ALL_AUTH_EVSES\"\nmsg.payload.data = {}\n\nevse_array.forEach(function(evse) {\n    msg.payload.data[evse.cbId] = evse.password;\n});\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 220,
        "wires": [
            [
                "fdaa305606c3401a"
            ]
        ]
    },
    {
        "id": "801901d267859d27",
        "type": "link in",
        "z": "9ca80d42115ee3c3",
        "name": "LOCAL_SET_VALID_EVSES",
        "links": [
            "40fe4278635a683c"
        ],
        "x": 125,
        "y": 220,
        "wires": [
            [
                "44e8fa5ea6d0b7fe"
            ]
        ]
    },
    {
        "id": "41174ff287679f83",
        "type": "debug",
        "z": "9ca80d42115ee3c3",
        "name": "debug 25",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1500,
        "y": 140,
        "wires": []
    },
    {
        "id": "846c6af009c205bd",
        "type": "link out",
        "z": "9ca80d42115ee3c3",
        "name": "link out 8",
        "mode": "link",
        "links": [
            "beada0a7e53cb46a",
            "d836b12b64275a9d"
        ],
        "x": 795,
        "y": 160,
        "wires": []
    },
    {
        "id": "14970b0433fc1816",
        "type": "link in",
        "z": "9ca80d42115ee3c3",
        "name": "Trigger Reqs",
        "links": [
            "82c7dc438bcf613e"
        ],
        "x": 145,
        "y": 20,
        "wires": [
            [
                "ea9c78552e696e47"
            ]
        ]
    },
    {
        "id": "0bfecc1d6f524575",
        "type": "switch",
        "z": "9ca80d42115ee3c3",
        "name": "",
        "property": "ocpp.command",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "GetConfiguration",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 770,
        "y": 60,
        "wires": [
            [
                "c001b42457967649",
                "b13502a9cfe6c685"
            ]
        ]
    },
    {
        "id": "b13502a9cfe6c685",
        "type": "link out",
        "z": "9ca80d42115ee3c3",
        "name": "GetConfig",
        "mode": "link",
        "links": [
            "6d40c15be6021ad7"
        ],
        "x": 935,
        "y": 80,
        "wires": []
    },
    {
        "id": "ea9c78552e696e47",
        "type": "change",
        "z": "9ca80d42115ee3c3",
        "name": "TriggerMsg",
        "rules": [
            {
                "t": "set",
                "p": "payload.data",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "move",
                "p": "payload.connectorId",
                "pt": "msg",
                "to": "payload.data.connectorId",
                "tot": "msg"
            },
            {
                "t": "move",
                "p": "payload.requestedMessage",
                "pt": "msg",
                "to": "payload.data.requestedMessage",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 290,
        "y": 20,
        "wires": [
            [
                "fdaa305606c3401a"
            ]
        ]
    },
    {
        "id": "6ea73070a96d4eeb",
        "type": "link in",
        "z": "9ca80d42115ee3c3",
        "name": "ocppReqs",
        "links": [
            "9061953296c99fc7",
            "bf301b6e3cd5b7f3",
            "647ae537e6cb80bc",
            "e762dccd76164608",
            "485897ecb288f5b2"
        ],
        "x": 145,
        "y": 80,
        "wires": [
            [
                "fdaa305606c3401a",
                "f6cabb9b8b83d2ce"
            ]
        ]
    },
    {
        "id": "2690df904d04509c",
        "type": "debug",
        "z": "9ca80d42115ee3c3",
        "name": "debug 51",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 760,
        "y": 220,
        "wires": []
    },
    {
        "id": "53e5e6b513fae4c6",
        "type": "switch",
        "z": "9ca80d42115ee3c3",
        "name": "",
        "property": "msgFrom",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "CS",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 990,
        "y": 140,
        "wires": [
            [
                "bc7897cb10724b22"
            ]
        ]
    },
    {
        "id": "bc7897cb10724b22",
        "type": "switch",
        "z": "9ca80d42115ee3c3",
        "name": "",
        "property": "payload[0]",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "2",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1130,
        "y": 140,
        "wires": [
            [
                "228ad740515166f1"
            ]
        ]
    },
    {
        "id": "228ad740515166f1",
        "type": "switch",
        "z": "9ca80d42115ee3c3",
        "name": "",
        "property": "payload[2]",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "StartTransaction",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "StartTransactionExtended",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1300,
        "y": 140,
        "wires": [
            [
                "41174ff287679f83",
                "e9e2899132889fc9"
            ],
            [
                "41174ff287679f83"
            ]
        ]
    },
    {
        "id": "675fb2cc11250d8b",
        "type": "inject",
        "z": "9ca80d42115ee3c3",
        "name": "GetOnlneList",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"type\":99,\"command\":\"LOCAL_GET_ONLINE_LIST\"}",
        "payloadType": "json",
        "x": 210,
        "y": 160,
        "wires": [
            [
                "fdaa305606c3401a"
            ]
        ]
    },
    {
        "id": "ac99e09b91853939",
        "type": "debug",
        "z": "9ca80d42115ee3c3",
        "name": "debug 59",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 670,
        "y": 20,
        "wires": []
    },
    {
        "id": "e9e2899132889fc9",
        "type": "function",
        "z": "9ca80d42115ee3c3",
        "name": "function 23",
        "func": "let message = `Transaction starting on <span style=\"color:navy;font-weight:bold\">${msg.cbId}</span>, connector <span style=\"color:#023020;font-weight:bold\">${msg.payload[3].connectorId}`\nmsg.payload = message\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1470,
        "y": 80,
        "wires": [
            [
                "dd9016feeab69f8a"
            ]
        ]
    },
    {
        "id": "dd9016feeab69f8a",
        "type": "link out",
        "z": "9ca80d42115ee3c3",
        "name": "link out 46",
        "mode": "link",
        "links": [
            "05b1553fcabcbc8b"
        ],
        "x": 1585,
        "y": 80,
        "wires": []
    },
    {
        "id": "f6cabb9b8b83d2ce",
        "type": "debug",
        "z": "9ca80d42115ee3c3",
        "name": "debug 80",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 540,
        "y": 140,
        "wires": []
    },
    {
        "id": "31dee9642ab622cd",
        "type": "link in",
        "z": "9ca80d42115ee3c3",
        "name": "link in 3",
        "links": [
            "08c6daf9b344995d"
        ],
        "x": 705,
        "y": 160,
        "wires": [
            [
                "846c6af009c205bd"
            ]
        ]
    },
    {
        "id": "366db60c10403558",
        "type": "redis-command",
        "z": "217382551c48905d",
        "server": "0430675ed6c7cd83",
        "command": "SET",
        "name": "",
        "topic": "",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 540,
        "y": 560,
        "wires": [
            [
                "1365105ad88ede6c",
                "b04ff9b4a10e46b3"
            ]
        ]
    },
    {
        "id": "1365105ad88ede6c",
        "type": "debug",
        "z": "217382551c48905d",
        "name": "debug 2",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 680,
        "y": 600,
        "wires": []
    },
    {
        "id": "6c962dc6f4338719",
        "type": "inject",
        "z": "217382551c48905d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "evse:1",
        "payload": "{\"cbId\":\"ChargionONE\",\"ports\":1,\"type\":\"DCFC\",\"amps\":40}",
        "payloadType": "json",
        "x": 190,
        "y": 520,
        "wires": [
            [
                "a22435a838a7042d"
            ]
        ]
    },
    {
        "id": "a22435a838a7042d",
        "type": "json",
        "z": "217382551c48905d",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": true,
        "x": 370,
        "y": 560,
        "wires": [
            [
                "366db60c10403558"
            ]
        ]
    },
    {
        "id": "cc105e30cbf544b1",
        "type": "redis-command",
        "z": "217382551c48905d",
        "server": "0430675ed6c7cd83",
        "command": "KEYS",
        "name": "",
        "topic": "",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 360,
        "y": 420,
        "wires": [
            [
                "3381d09488bdd1f6",
                "a25df1a5696fa43b"
            ]
        ]
    },
    {
        "id": "3381d09488bdd1f6",
        "type": "json",
        "z": "217382551c48905d",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": true,
        "x": 500,
        "y": 420,
        "wires": [
            [
                "0d19c3c9e4f2be19"
            ]
        ]
    },
    {
        "id": "75bf5024ec62eb25",
        "type": "inject",
        "z": "217382551c48905d",
        "name": "Inject List at Startup",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "3",
        "topic": "0",
        "x": 160,
        "y": 80,
        "wires": [
            [
                "2f70c5015a5d4885"
            ]
        ]
    },
    {
        "id": "0d19c3c9e4f2be19",
        "type": "json",
        "z": "217382551c48905d",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 620,
        "y": 420,
        "wires": [
            [
                "f25b98ea7ace00e0"
            ]
        ]
    },
    {
        "id": "7d7b852ff14ab0d0",
        "type": "redis-command",
        "z": "217382551c48905d",
        "server": "0430675ed6c7cd83",
        "command": "MGET",
        "name": "",
        "topic": "",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 930,
        "y": 420,
        "wires": [
            [
                "928aa3eab1d807cf"
            ]
        ]
    },
    {
        "id": "426241cfa981a02b",
        "type": "redis-command",
        "z": "217382551c48905d",
        "server": "0430675ed6c7cd83",
        "command": "DEL",
        "name": "",
        "topic": "",
        "params": "",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 1880,
        "y": 460,
        "wires": [
            [
                "d67d4f13803bc38a"
            ]
        ]
    },
    {
        "id": "928aa3eab1d807cf",
        "type": "function",
        "z": "217382551c48905d",
        "name": "function 1",
        "func": "let evse\nlet evse_str\nlet evses = []\n\nmsg.payload.splice(0,1)\n\nmsg.payload.forEach(function(evse_str) {\n    evse = JSON.parse(evse_str)\n    evses.push(evse)\n})\nmsg.headers = [\n    { key: 'cbId', title: 'ChargeBox ID', align: 'start'},\n    { key: 'type', title: 'Type'},\n    { key: 'amps', title: 'Amps'},\n    { key: 'ports', title: 'Ports', align: 'center'},\n    { key: 'password', title: 'P/W', align: 'center'},\n    { key: 'lat', title: 'lat', align: 'center'},\n    { key: 'lon', title: 'lon', align: 'center'},\n    //{ key: 'group', title: 'Group'},\n    { key: 'lastcommtime'},\n    { key: 'actions', title: 'Action',align: 'end', sortable: false} \n]\nmsg.payload = evses\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 420,
        "wires": [
            [
                "ee41c358ac7c402f",
                "40fe4278635a683c",
                "a361a3233397f32f",
                "3cf0aaa06cd6633b"
            ]
        ]
    },
    {
        "id": "c5027bda20e0bca6",
        "type": "function",
        "z": "217382551c48905d",
        "name": "Create Key",
        "func": "let key = `evse:${msg.payload.cbId}`\nmsg.topic = key\nreturn msg\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 190,
        "y": 560,
        "wires": [
            [
                "a22435a838a7042d"
            ]
        ]
    },
    {
        "id": "ee41c358ac7c402f",
        "type": "ui-template",
        "z": "217382551c48905d",
        "group": "1723c74d3f81385c",
        "page": "",
        "ui": "",
        "name": "EVSE List",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n    <!-- v-toolbar flat>\n      <v-toolbar-title class=\"text-grey\">\n        Actions\n      </v-toolbar-title>\n\n      <v-spacer></v-spacer>\n\n      <v-tooltip text=\"Refresh\" location=\"bottom\">\n        <template v-slot:activator=\"{ props }\">\n          <v-btn icon v-bind=\"props\" @click=\"refresh\">\n            <v-icon>mdi-refresh</v-icon>\n          </v-btn>\n        </template>\n      </v-tooltip>\n\n      <v-tooltip text=\"New\" location=\"bottom\">\n        <template v-slot:activator=\"{ props }\">\n          <v-btn icon v-bind=\"props\" @click=\"addNew\">\n            <v-icon>mdi-ev-station</v-icon>\n          </v-btn>\n        </template>\n      </v-tooltip>\n\n    </v-toolbar>\n\n\n      <v-text-field\n        v-model=\"search\"\n        label=\"Search\"\n        prepend-inner-icon=\"mdi-magnify\"\n        clear-icon=\"mdi-close-circle\"\n        variant=\"oulined\"\n        hide-details\n        single-line\n        clearable\n      ></v-text-field-->\n\n    \n    <v-data-table  \n        :search=\"search\" \n        :items=\"msg?.payload\"\n        :headers=\"msg?.headers\"\n        v-model=\"selected\"\n        item-selectable=\"selectable\"\n        select-strategy=\"all\"\n        hide-select    \n        return-object>\n      <template v-slot:top>\n        <v-toolbar flat>\n          <v-toolbar-title>\n            <v-icon color=\"medium-emphasis\" icon=\"mdi-ev-station\" size=\"x-small\" start></v-icon>\n            EVSEs\n          </v-toolbar-title>\n          <v-text-field\n            v-model=\"search\"\n            label=\"Search\"\n            prepend-inner-icon=\"mdi-magnify\"\n            clear-icon=\"mdi-close-circle\"\n            variant=\"solo-filled\"\n            density=\"compact\"\n            hide-details\n            single-line\n            clearable\n          ></v-text-field>\n                <v-tooltip text=\"Refresh\" location=\"bottom\">\n        <template v-slot:activator=\"{ props }\">\n          <v-btn icon v-bind=\"props\" @click=\"refresh\">\n            <v-icon>mdi-refresh</v-icon>\n          </v-btn>\n        </template>\n      </v-tooltip>\n\n      <v-tooltip text=\"New\" location=\"bottom\">\n        <template v-slot:activator=\"{ props }\">\n          <v-btn icon v-bind=\"props\" @click=\"addNew\">\n            <v-icon>mdi-ev-station</v-icon>\n          </v-btn>\n        </template>\n      </v-tooltip>\n        </v-toolbar>\n      </template>\n      <template v-slot:loading>\n        <v-skeleton-loader type=\"table-row@10\"></v-skeleton-loader>\n      </template>\n\n      <template v-slot:header.lastcommtime>\n        <div><v-icon icon=\"mdi-heart\" class=\"text-center\"></div>\n      </template>\n\n      <template v-slot:header.password>\n        <div class=\"text-center\">p/w</div>\n      </template>\n      <template v-slot:header.ports>\n        <div class=\"text-center\">Ports</div>\n      </template>\n      \n      <template v-slot:item.ports=\"{ item }\">\n        <div class=\"text-center header1\">\n          <v-text>{{ item.ports }}</v-text>\n        </div>\n      </template>\n      \n      <template v-slot:item.cbId=\"{ item }\">\n        <div>\n          <v-text>{{ item.cbId }} xyz</v-text>\n        </div>\n      </template>\n      <template v-slot:item.lat=\"{ item }\">\n        <div class=\"text-center\">\n          <v-text >{{ getShortLatLon(item.lat) }}</v-text>\n        </div>\n      </template>\n      <template v-slot:item.lon=\"{ item }\">\n        <div class=\"text-center\">\n          <v-text >{{ getShortLatLon(item.lon) }}</v-text>\n        </div>\n      </template>      \n\n      <template v-slot:item.password=\"{ item }\">\n        <div class=\"text-center\">\n          <v-icon v-if=\"item.password\" color=\"green\" icon=\"mdi-checkbox-outline\"></v-icon>\n        </div>\n      </template>\n\n      <template v-slot:item.lastcommtime=\"{ item }\">\n        <div class=\"text-center\">\n          <v-icon :icon=\"getLastCommIcon(item)\" :color=\"getLastCommColor(item)\"></v-icon>\n        </div>\n      </template>\n      <template v-slot:item.amps=\"{ item }\">\n        <v-text>{{ item.amps }}A</v-chip>\n      </template>\n\n      <template v-slot:item.type=\"{ item }\">\n        <v-chip :color=\"getTypeColor(item)\">{{ item.type }}</v-chip>\n      </template>\n\n      <template v-slot:item.actions=\"{ item }\">\n        <v-icon v-if=\"getIsOnline(item)\"\n          class=\"me-2\"\n          size=\"small\"\n          @click=\"send({action: 'command', payload: [item]})\"\n        >\n          mdi-apps\n        </v-icon>\n        <v-icon\n          class=\"me-2\"\n          size=\"small\"\n          @click=\"send({action: 'edit', payload: [item]})\"\n        >\n          mdi-pencil\n        </v-icon>\n        <v-icon\n          size=\"small\"\n          @click=\"send({action: 'delete', payload: [item]})\"\n        >\n          mdi-delete\n        </v-icon>\n      </template>\n\n    </v-data-table>\n</template>\n\n<script>\n    export default {\n    data () {\n      return {\n        selected: [],\n        search: '',\n        multiSelected: 0,\n        heartbeat: 120,\n      }\n    },\n    watch: {\n        selected: function() {\n          this.multiSelected = this.selected.length\n        }\n    },\n    mounted() {\n      this.refresh()\n    },\n    methods: {\n      addNew() {\n        this.send({action: 'add', payload: [{ cbId: ''}]});\n        this.selected = [];\n        this.multiSelected = 0;\n      },\n      refresh() {\n        this.send({action: 'refresh', payload: [{}]});\n        this.selected = []\n        this.multiSelected = 0;\n      },\n      // expose a method to our <template> and Vue Application\n      getTypeColor: function(item) {\n        switch(item.type.toLowerCase()) {\n          case 'l1':\n          case 'level1':\n          case 'level 1':\n            return 'gray';\n            break;\n          case 'l2':\n          case 'level2':\n          case 'level 2':\n            return 'purple';\n            break;\n          case 'dcfc':\n          case 'dc':\n            return 'green';\n            break;\n          case 'xfc':\n          case 'hpc':\n            return 'blue';\n            break;\n          default:\n            return 'cyan';\n            break;\n        }\n      },\n\n      getLastCommIcon: function(item) {\n        if (Math.floor((Date.now() - item.lastcommtime) / 1000) > this.heartbeat ){\n          return \"mdi-heart-broken\"\n        }\n        else return \"mdi-heart-flash\"\n      },\n      getLastCommColor: function(item) {\n        if (Math.floor((Date.now() - item.lastcommtime) / 1000) > this.heartbeat ){\n          return \"grey\"\n        }\n        else return \"green\"\n      },\n      getLastCommClass: function(item) {\n        if (Math.floor((Date.now() - item.lastcommtime) / 1000) > this.heartbeat ){\n          return \"offline\"\n        }\n        else return \"online\"\n      },\n      getIsOnline: function(item) {\n        return (Math.floor((Date.now() - item.lastcommtime) / 1000) <= this.heartbeat)\n      },\n      getShortLatLon: function(latlon){\n        if (latlon){\n          return (Math.floor(Number(latlon) * 1000)/ 1000)\n        }\n      }\n    }  \n  }\n</script>\n\n<style>\n\n  .online {\n    font-weight: bold;\n    color: green;\n  }\n  .offline {\n    color: grey;\n  }\n  .header1 {\n    font-weight: bolder;\n  }\n</style>",
        "storeOutMessages": true,
        "passthru": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1230,
        "y": 380,
        "wires": [
            [
                "cdfaf0ad88e1c53d"
            ]
        ]
    },
    {
        "id": "cb4389b379c7a461",
        "type": "ui-template",
        "z": "217382551c48905d",
        "group": "276c45fccf8e6765",
        "page": "",
        "ui": "",
        "name": "Edit Dialog",
        "order": 4,
        "width": "0",
        "height": "0",
        "head": "",
        "format": "<template>\n    <v-dialog width=\"50%\" v-model=\"showDialog\">\n        <v-card color=\"white\" v-click-outside=\"{handler: onClickOutside}\">\n            <v-toolbar color=\"primary\">\n                <v-card-title>\n                    <span>{{ title }}</span>\n                </v-card-title>\n            </v-toolbar>\n            <v-container>\n                <v-text-field\n                    v-model=\"cbid\"\n                    label=\"Chargebox ID\"\n                    type=\"text\"\n                    :readonly=\"getReadOnly()\"\n                    hint=\"Provide a unique chargebox name\"\n                ></v-text-field>\n                <v-text-field\n                    v-model=\"evseType\"\n                    label=\"Type\"\n                    type=\"text\"\n                    hint=\"example: L2 or DCFC\"\n                ></v-text-field>\n                <v-text-field\n                    v-model=\"ports\"\n                    label=\"Connectors\"\n                    type=\"number\"\n                    hint=\"Number of connectors/ports\"\n                ></v-text-field>\n                <v-text-field\n                    v-model=\"amps\"\n                    label=\"Amperage\"\n                    type=\"number\"\n                    suffix=\"Amps\"\n                    hint=\"Example: 40\"\n                ></v-text-field>\n                <v-text-field\n                    v-model=\"password\"\n                    label=\"Password\"\n                    type=\"password\"\n                    placeholder=\"<optional>\"\n                    hint=\"Enter a password if using basic auth\"\n                ></v-text-field>\n                <v-text-field\n                    v-model=\"lat\"\n                    label=\"latitude\"\n                    type=\"number\"\n                    placeholder=\"<optional>\"\n                    hint=\"Enter location latiitude\"\n                ></v-text-field>\n               <v-text-field\n                    v-model=\"lon\"\n                    label=\"longitude\"\n                    type=\"number\"\n                    placeholder=\"<optional>\"\n                    hint=\"Enter location longitude\"\n                ></v-text-field>               <v-text-field\n                    v-model=\"group\"\n                    label=\"Group\"\n                    type=\"number\"\n                    placeholder=\"<optional>\"\n                    hint=\"Enter EVSE group\"\n                ></v-text-field>\n                <v-card-actions class=\"justify-end\">\n                    <v-btn variant=\"elevated\" @click=\"okDialog\">{{ okText }}</v-btn>\n                    <v-btn variant=\"elevated\" @click=\"cancelDialog\">{{ cancelText }}</v-btn>\n                </v-card-actions>\n            </v-container>\n        </v-card>\n    </v-dialog>\n</template>\n\n<script>\n    export default {\n        data() {\n            return {\n                cbid: '',\n                ports: 1,\n                amps: 30,\n                evseType: 'L2',\n                password: '',\n                lat: '',\n                lon: '',\n                group: '',\n                lastcommtime: '',\n                newEdit: \"New\",\n                title: \"\",\n                showDialog: false,\n                okText: \"OK\",\n                cancelText: \"Cancel\"\n            }\n        },\n        watch: {\n            \n\n        },\n\n        computed: {\n            // automatically compute this variable\n            // whenever VueJS deems appropriate\n            \n        },\n        mounted: {\n            //this.showDialog = false\n        },\n        unmounted: {\n            //this.showDialog = false\n        },\n        methods: {\n            // expose a method to our <template> and Vue Application\n            sendevsedata: function() {\n                this.send({\n                    payload: {\n                        cbId: this.cbid,\n                        type: this.evseType,\n                        amps: this.amps,\n                        ports: this.ports,\n                        password: this.password,\n                        lat: this.lat,\n                        lon: this.lon,\n                        group: this.group,\n                        lastcommtime: this.lastcommtime || Math.floor(Date.now() / 1000)\n                    }\n                })\n            },\n            okDialog: function() {\n                this.sendevsedata()\n                this.showDialog = false\n            },\n            cancelDialog: function() {\n                this.msg.payload = {}\n                this.showDialog = false\n            },\n            onClickOutside: function() {\n                this.msg.payload = {}\n                this.showDialog = false\n            },\n            getReadOnly: function() {\n                return (this.newEdit == \"New\") ? false : true\n            }\n\n        },\n        mounted() {\n            this.$socket.on('msg-input:' + this.id, (msg) => {\n            // do stuff with msg\n            // runs only when messages are received\n                if (this.msg.payload){\n                    let payload = this.msg.payload\n                    this.ports = payload.ports\n                    this.cbid = payload.cbId\n                    this.amps = payload.amps\n                    this.evseType = payload.type\n                    this.password = payload.password\n                    this.lat = payload.lat\n                    this.lon = payload.lon\n                    this.group = payload.group\n                    this.lastcommtime = payload.lastcommtime ?? Math.floor(Date.now() / 1000);\n                }\n                if (this.msg.dialog){\n                    let dialog = this.msg.dialog\n                    this.showDialog = dialog.showDialog\n                    this.okText = dialog.okText ?? \"OK\"\n                    this.cancelText = dialog.cancelText ?? \"Cancel\"\n                    this.showDialog = dialog.showDialog ?? false\n                    this.title = dialog.title ?? \"EVSE\"\n                    this.newEdit = dialog.newEdit ?? \"New\"\n                }\n            })\n        },\n   }\n</script>\n",
        "storeOutMessages": true,
        "passthru": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 310,
        "y": 140,
        "wires": [
            [
                "f02867b7f09b0ad1",
                "c1ed374a1bace4de"
            ]
        ]
    },
    {
        "id": "c1ed374a1bace4de",
        "type": "link out",
        "z": "217382551c48905d",
        "name": "link out 1",
        "mode": "link",
        "links": [
            "9309e7f51ccc6c6c",
            "9405f117efca5faf",
            "19a1d55d0ad937f5"
        ],
        "x": 455,
        "y": 140,
        "wires": []
    },
    {
        "id": "9309e7f51ccc6c6c",
        "type": "link in",
        "z": "217382551c48905d",
        "name": "Edit EVSE",
        "links": [
            "c1ed374a1bace4de"
        ],
        "x": 65,
        "y": 560,
        "wires": [
            [
                "c5027bda20e0bca6"
            ]
        ]
    },
    {
        "id": "19a1d55d0ad937f5",
        "type": "link in",
        "z": "217382551c48905d",
        "name": "Refresh EVSE List",
        "links": [
            "b04ff9b4a10e46b3",
            "d67d4f13803bc38a",
            "2f70c5015a5d4885",
            "a20667f00c1262ba",
            "a1f721f1a03c965a",
            "c1ed374a1bace4de"
        ],
        "x": 65,
        "y": 420,
        "wires": [
            [
                "bd34c2295601f999"
            ]
        ]
    },
    {
        "id": "b04ff9b4a10e46b3",
        "type": "link out",
        "z": "217382551c48905d",
        "name": "link out 2",
        "mode": "link",
        "links": [
            "19a1d55d0ad937f5"
        ],
        "x": 685,
        "y": 540,
        "wires": []
    },
    {
        "id": "cdfaf0ad88e1c53d",
        "type": "switch",
        "z": "217382551c48905d",
        "name": "",
        "property": "action",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "add",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "edit",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "delete",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "command",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "refresh",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 5,
        "x": 1360,
        "y": 380,
        "wires": [
            [
                "153896150836a241"
            ],
            [
                "2df63633a3901591"
            ],
            [
                "d9db7aa7fbab290f"
            ],
            [
                "7bc827572072b785"
            ],
            [
                "a20667f00c1262ba"
            ]
        ]
    },
    {
        "id": "639178f5d96d873a",
        "type": "debug",
        "z": "217382551c48905d",
        "name": "debug 10",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1700,
        "y": 440,
        "wires": []
    },
    {
        "id": "d67d4f13803bc38a",
        "type": "link out",
        "z": "217382551c48905d",
        "name": "link out 3",
        "mode": "link",
        "links": [
            "19a1d55d0ad937f5"
        ],
        "x": 1975,
        "y": 460,
        "wires": []
    },
    {
        "id": "96ac685aafead6da",
        "type": "change",
        "z": "217382551c48905d",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload[0]",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "dialog.showDialog",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            },
            {
                "t": "set",
                "p": "dialog.cancelText",
                "pt": "msg",
                "to": "Cancel",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1740,
        "y": 340,
        "wires": [
            [
                "8c62605df95e3ac2",
                "f305a66a592946cc"
            ]
        ]
    },
    {
        "id": "6563370d3a461ac1",
        "type": "ui-template",
        "z": "217382551c48905d",
        "group": "276c45fccf8e6765",
        "page": "",
        "ui": "",
        "name": "EVSE Commands Dialog",
        "order": 5,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n    <v-dialog width=\"auto\" v-model=\"showDialog\">\n        <v-card color=\"white\" v-click-outside=\"{handler: onClickOutside}\" >\n            <v-toolbar color=\"primary\">\n                <v-card-title>\n                    <span>{{ title }}</span>\n                </v-card-title>\n            </v-toolbar>\n            <v-container>\n                                <v-row>\n                <v-col cols=\"12\">\n                    <v-card \n                        :title=\"this.cbId\"\n                        prepend-icon=\"mdi-ev-station\"\n                        subtitle=\"Commands will be sent to this EVSE\">\n                    </v-card>\n                </v-col>\n                </v-row>\n                                <v-row>\n                <v-col cols=\"6\">\n                    <v-btn block \n                        prepend-icon=\"mdi-lock-open\" \n                        color=\"primary\" \n                        @click=\"sendCmd('UnlockConnector')\"\n                        >\n                        Unlock Connector\n                    </v-btn>\n                </v-col>\n                <v-col cols=\"6\">\n                    <v-btn block \n                        prepend-icon=\"mdi-pause-octagon-outline\" \n                        color=\"primary\" \n                        @click=\"sendCmd('ChangeAvailability')\"\n                        >\n                        Change Availability\n                    </v-btn>\n                </v-col>\n                </v-row>\n                <v-row>\n                <v-col cols=\"6\">\n                    <v-btn block prepend-icon=\"mdi-play-circle-outline\" color=\"primary\" @click=\"sendCmd('RemoteStartTransaction')\">Remote Start Transaction</v-btn>\n                </v-col>\n                <v-col cols=\"6\">\n                    <v-btn block prepend-icon=\"mdi-stop-circle-outline\" color=\"primary\" @click=\"sendCmd('RemoteStopTransaction')\">Remote Stop Transaction</v-btn>\n                </v-col>\n                </v-row>\n                <v-row>\n                <v-col cols=\"6\">\n                    <v-btn block prepend-icon=\"mdi-hammer-screwdriver\" color=\"primary\" @click=\"sendCmd('TriggerMessage')\">Trigger Message</v-btn>\n                </v-col>\n                <v-col cols=\"6\">\n                    <v-btn block prepend-icon=\"mdi-cog-counterclockwise\" color=\"primary\" @click=\"sendCmd('ClearCache',{})\">Clear Cache</v-btn>\n                </v-col>\n                </v-row>                                        \n                <v-row>\n                <v-col cols=\"6\">\n                    <v-btn block prepend-icon=\"mdi-power-plug-outline\" color=\"primary\" @click=\"sendCmd('Reset',{ type: 'Soft'})\">Soft Reset</v-btn>\n                </v-col>\n                <v-col cols=\"6\">\n                    <v-btn block prepend-icon=\"mdi-power-plug\" color=\"primary\" @click=\"sendCmd('Reset',{ type: 'Hard'} )\">Hard Reset</v-btn>\n                </v-col>\n                </v-row>\n                <v-row>\n                    <v-col cols=\"12\">\n                    <v-btn block variant=\"elevated\" color=\"secondary\" @click=\"closeDialog()\">Close</v-btn>\n                </v-col>                                        \n\n            </v-container>\n        </v-card>\n    </v-dialog>                \n</template>\n\n<script>\n    export default {\n        data() {\n            // define variables available component-wide\n            // (in <template> and component functions)\n            return {\n                cbId: '',\n                ports: 1,\n                showDialog: false,\n                title: 'Send OCPP Commands'\n            }\n        },\n        watch: {  \n        },\n\n        computed: {\n            // automatically compute this variable\n            // whenever VueJS deems appropriate\n\n        },\n        methods: {\n            // expose a method to our <template> and Vue Application\n\n            sendCmd: function(command, data=0){\n                let payload = {\n                    cbId: this.cbId,\n                    command: command\n                }\n\n                if (data != 0) {\n                    payload.data = data\n                }\n\n                this.send({\n                    payload\n                })\n            },\n            closeDialog: function() {\n                let payload = {\n                    command: \"closeDialog\"\n                }\n                this.send({payload})\n                this.showDialog = false\n            }\n\n        },\n        mounted() {\n            this.$socket.on('msg-input:' + this.id, (msg) => {\n                if (this.msg.payload){\n                let payload = this.msg.payload\n                this.cbId = payload.cbId\n                this.ports = payload.ports\n                }\n                \n                if (this.msg.dialog) {\n                let dialog = this.msg.dialog\n                this.showDialog = dialog.showDialog\n                this.closeText = dialog.closeText\n                this.title = dialog.title ?? 'Send OCPP Commands'\n                }\n            })\n        },\n   }\n</script>\n",
        "storeOutMessages": true,
        "passthru": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 410,
        "y": 220,
        "wires": [
            [
                "abdf3b3fe821405d",
                "b89d3bee61c371a8"
            ]
        ]
    },
    {
        "id": "67831ed4d8bdfde1",
        "type": "change",
        "z": "217382551c48905d",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload[0]",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "dialog.showDialog",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            },
            {
                "t": "set",
                "p": "dialog.title",
                "pt": "msg",
                "to": "EVSE Commands",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 200,
        "y": 220,
        "wires": [
            [
                "6563370d3a461ac1"
            ]
        ]
    },
    {
        "id": "bd34c2295601f999",
        "type": "function",
        "z": "217382551c48905d",
        "name": "Scan evse tags",
        "func": "msg = {}\nmsg.payload = \"evse:*\"\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 180,
        "y": 420,
        "wires": [
            [
                "cc105e30cbf544b1"
            ]
        ]
    },
    {
        "id": "f25b98ea7ace00e0",
        "type": "change",
        "z": "217382551c48905d",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "getevses",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 770,
        "y": 420,
        "wires": [
            [
                "7d7b852ff14ab0d0"
            ]
        ]
    },
    {
        "id": "40fe4278635a683c",
        "type": "link out",
        "z": "217382551c48905d",
        "name": "link out 7",
        "mode": "link",
        "links": [
            "801901d267859d27"
        ],
        "x": 1245,
        "y": 440,
        "wires": []
    },
    {
        "id": "abdf3b3fe821405d",
        "type": "debug",
        "z": "217382551c48905d",
        "name": "debug 29",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 600,
        "y": 260,
        "wires": []
    },
    {
        "id": "82c7dc438bcf613e",
        "type": "link out",
        "z": "217382551c48905d",
        "name": "OCPP Cmd Out",
        "mode": "link",
        "links": [
            "14970b0433fc1816",
            "9405f117efca5faf"
        ],
        "x": 1425,
        "y": 80,
        "wires": []
    },
    {
        "id": "2f70c5015a5d4885",
        "type": "link out",
        "z": "217382551c48905d",
        "name": "link out 11",
        "mode": "link",
        "links": [
            "19a1d55d0ad937f5"
        ],
        "x": 285,
        "y": 80,
        "wires": []
    },
    {
        "id": "56ecdf3e1e7ccd5a",
        "type": "link in",
        "z": "217382551c48905d",
        "name": "Edit TagInfo",
        "links": [
            "8c62605df95e3ac2"
        ],
        "x": 45,
        "y": 140,
        "wires": [
            [
                "a15783afb2f690dc"
            ]
        ]
    },
    {
        "id": "8c62605df95e3ac2",
        "type": "link out",
        "z": "217382551c48905d",
        "name": "link out 12",
        "mode": "link",
        "links": [
            "56ecdf3e1e7ccd5a",
            "abd4fc7cece76024"
        ],
        "x": 1855,
        "y": 340,
        "wires": []
    },
    {
        "id": "bc68a668b062814c",
        "type": "link in",
        "z": "217382551c48905d",
        "name": "Open EVSE Commands",
        "links": [
            "7bc827572072b785"
        ],
        "x": 45,
        "y": 220,
        "wires": [
            [
                "f813f3d81530033f"
            ]
        ]
    },
    {
        "id": "7bc827572072b785",
        "type": "link out",
        "z": "217382551c48905d",
        "name": "link out 13",
        "mode": "link",
        "links": [
            "abd4fc7cece76024",
            "bc68a668b062814c"
        ],
        "x": 1505,
        "y": 440,
        "wires": []
    },
    {
        "id": "f02867b7f09b0ad1",
        "type": "debug",
        "z": "217382551c48905d",
        "name": "debug 32",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 430,
        "y": 60,
        "wires": []
    },
    {
        "id": "153896150836a241",
        "type": "change",
        "z": "217382551c48905d",
        "name": "Add",
        "rules": [
            {
                "t": "set",
                "p": "dialog",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "dialog.title",
                "pt": "msg",
                "to": "Add New EVSE",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "dialog.newEdit",
                "pt": "msg",
                "to": "New",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "dialog.okText",
                "pt": "msg",
                "to": "Add",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1510,
        "y": 320,
        "wires": [
            [
                "96ac685aafead6da"
            ]
        ]
    },
    {
        "id": "2df63633a3901591",
        "type": "change",
        "z": "217382551c48905d",
        "name": "Edit",
        "rules": [
            {
                "t": "set",
                "p": "dialog.title",
                "pt": "msg",
                "to": "Edit EVSE",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "dialog.newEdit",
                "pt": "msg",
                "to": "Edit",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "dialog.okText",
                "pt": "msg",
                "to": "Update",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1510,
        "y": 360,
        "wires": [
            [
                "96ac685aafead6da"
            ]
        ]
    },
    {
        "id": "f305a66a592946cc",
        "type": "debug",
        "z": "217382551c48905d",
        "name": "debug 33",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1900,
        "y": 280,
        "wires": []
    },
    {
        "id": "4ff6ccb2ddf56bba",
        "type": "ui-template",
        "z": "217382551c48905d",
        "group": "276c45fccf8e6765",
        "page": "",
        "ui": "",
        "name": "Unlock Connector",
        "order": 6,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n    <v-dialog width=\"auto\" v-model=\"showDialog\">\n        <v-card color=\"white\" v-click-outside=\"{handler: onClickOutside}\">\n            <v-toolbar color=\"primary\">\n                <v-card-title>\n                    <span>{{ cbId }}: Unlock Connector</span>\n                </v-card-title>\n            </v-toolbar>\n            <v-container>\n                <v-text-field\n                    v-model=\"connector\"\n                    label=\"Connector ID\"\n                    type=\"number\"\n                    hint=\"Connector ID to unlock\"\n                ></v-text-field>\n            </v-container>\n            <v-card-actions class=\"justify-end\">\n                <v-btn variant=\"elevated\" @click=\"okDialog\">{{ okText }}</v-btn>\n                <v-btn variant=\"elevated\" @click=\"cancelDialog\">{{ cancelText }}</v-btn>\n            </v-card-actions>\n        </v-card>\n    </v-dialog>\n</template>\n\n<script>\n    export default {\n        data() {\n            // define variables available component-wide\n            // (in <template> and component functions)\n            return {\n                connector: 1,\n                showDialog: false,\n                cbId: 'xyzzz',\n                okText: 'OK',\n                cancelText: 'Cancel',\n                command: 'unlockConnecotor'\n            }\n        },\n\n        watch: {},\n        mounted() {\n            this.$socket.on('msg-input:' + this.id, (msg) => {\n                if (this.msg.dialog){\n                    let dialog = this.msg.dialog\n                    this.showDialog = dialog.showDialog ?? false\n                    this.okText = dialog.okText ?? \"OK\"\n                    this.cancelText = dialog.cancelText ?? \"Cancel\"\n                }\n                if (this.msg.payload){\n                    this.cbId = this.msg.payload.cbId\n                    this.command = this.msg.payload.command\n\n                }\n            })\n        },\n        methods: {\n            okDialog: function() {\n                this.showDialog = false\n                this.send({\n                    payload: {\n                        cbId: this.cbId,\n                        data: {\n                            connectorId: this.connector\n                        },\n                        command: this.command\n                    }\n                })\n\n            },\n            cancelDialog: function() {\n                this.msg.paylaod = {}\n                this.showDialog = false\n                \n            }\n\n        }\n    }\n</script>\n<style>\n    /* define any styles here - supports raw CSS */\n    .my-class {\n        color: red;\n    }\n</style>",
        "storeOutMessages": true,
        "passthru": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1230,
        "y": 120,
        "wires": [
            [
                "f740792ad0c8f5fd"
            ]
        ]
    },
    {
        "id": "f024c7fc32d8d05e",
        "type": "switch",
        "z": "217382551c48905d",
        "name": "Switch Command",
        "property": "payload.command",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "TriggerMessage",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "UnlockConnector",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ChangeAvailability",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "RemoteStartTransaction",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "RemoteStopTransaction",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 6,
        "x": 810,
        "y": 220,
        "wires": [
            [
                "297ebea211c663ac"
            ],
            [
                "4ff6ccb2ddf56bba"
            ],
            [
                "c84ee996687096fe"
            ],
            [
                "35448e49dfc5fde2"
            ],
            [
                "f5a99899b46e0e63"
            ],
            [
                "c36b63f7c3de6924",
                "f740792ad0c8f5fd",
                "5e3e9b161183e7fa"
            ]
        ]
    },
    {
        "id": "297ebea211c663ac",
        "type": "ui-template",
        "z": "217382551c48905d",
        "group": "276c45fccf8e6765",
        "page": "",
        "ui": "",
        "name": "Trigger Msg",
        "order": 3,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n    <v-dialog width=\"auto\" v-model=\"showDialog\">\n        <v-card color=\"white\" v-click-outside=\"{handler: onClickOutside}\">\n            <v-toolbar color=\"primary\">\n                <v-card-title>\n                    <span>{{ cbId }}: Trigger Msg</span>\n                </v-card-title>\n            </v-toolbar>\n            <v-container>\n                <v-text-field \n                    v-model=\"connectorId\" \n                    label=\"Connector ID\" \n                    type=\"number\" \n                    hint=\"Connector ID\"\n                >\n                </v-text-field>\n                <v-select \n                    v-model=\"requestedMessage\" \n                    label=\"Command\"\n                    :items='requestedMessages'\n                    hint=\"OCPP Trigger Message\">\n                </v-select>            \n            </v-container>\n            <v-card-actions class=\"justify-end\">\n                <v-btn variant=\"elevated\" @click=\"okDialog\">{{ okText }}</v-btn>\n                <v-btn variant=\"elevated\" @click=\"cancelDialog\">{{ cancelText }}</v-btn>\n            </v-card-actions>\n        </v-card>\n    </v-dialog>\n</template>\n\n<script>\n    export default {\n        data() {\n            // define variables available component-wide\n            // (in <template> and component functions)\n            return {\n                connectorId: 1,\n                showDialog: false,\n                cbId: 'xyzzz',\n                okText: 'OK',\n                cancelText: 'Cancel',\n                requestedMessages: ['BootNotification','DiagnosticStatusNotification','FirmwareStatusNotification','Heartbeat','MeterValues','StatusNotification'] ,\n                requestedMessage: 'StatusNotification',\n                command: 'TriggerMessage',\n                trigger: 'StatusNotification'\n            }\n        },\n\n        watch: {},\n        mounted() {\n            this.$socket.on('msg-input:' + this.id, (msg) => {\n            \n                if (this.msg.dialog){\n                    let dialog = this.msg.dialog\n                    this.showDialog = dialog.showDialog ?? false\n                    this.okText = dialog.okText ?? \"OK\"\n                    this.cancelText = dialog.cancelText ?? \"Cancel\"\n                }\n                if (this.msg.payload){\n                    this.cbId = this.msg.payload.cbId\n                    this.command = this.msg.payload.command\n\n                }\n            })\n        },\n        methods: {\n            okDialog: function() {\n                this.showDialog = false\n                this.send({\n                    payload: {\n                        cbId: this.cbId,\n                        connectorId: this.connectorId,\n                        command: this.command,\n                        requestedMessage: this.requestedMessage\n                    }\n                })\n\n            },\n            cancelDialog: function() {\n                this.msg.paylaod = {}\n                this.showDialog = false\n                \n            }\n\n        }\n    }\n</script>\n<style>\n    /* define any styles here - supports raw CSS */\n    .my-class {\n        color: red;\n    }\n</style>",
        "storeOutMessages": true,
        "passthru": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1210,
        "y": 80,
        "wires": [
            [
                "82c7dc438bcf613e"
            ]
        ]
    },
    {
        "id": "f4550ea4a5f41146",
        "type": "ui-template",
        "z": "217382551c48905d",
        "group": "276c45fccf8e6765",
        "page": "",
        "ui": "",
        "name": "Remote Start Tx",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n    <v-dialog width=\"auto\" v-model=\"showDialog\">\n        <v-card color=\"white\" v-click-outside=\"{handler: onClickOutside}\">\n            <v-toolbar color=\"primary\">\n                <v-card-title>\n                    <span>{{ cbId }}: Remote Start Transaction</span>\n                </v-card-title>\n            </v-toolbar>\n            <v-container>\n                <v-text-field\n                    v-model=\"connector\"\n                    label=\"Connector ID\"\n                    type=\"number\"\n                    hint=\"Connector ID to start transaction on\"\n                ></v-text-field>\n                <v-select \n                    v-model=\"option\" \n                    label=\"tagId\"\n                    :items='options'\n                    hint=\"TokenID\">\n                </v-select>            \n            </v-container>\n            <v-card-actions class=\"justify-end\">\n                <v-btn variant=\"elevated\" @click=\"okDialog\">{{ okText }}</v-btn>\n                <v-btn variant=\"elevated\" @click=\"cancelDialog\">{{ cancelText }}</v-btn>\n            </v-card-actions>\n        </v-card>\n    </v-dialog>\n</template>\n\n<script>\n    export default {\n        data() {\n            // define variables available component-wide\n            // (in <template> and component functions)\n            return {\n                connector: 1,\n                cbId: 'xyzzz',\n                option: '',\n                options: [],\n                okText: 'OK',\n                showDialog: false,\n                cancelText: 'Cancel',\n                command: 'RemoteStartTransaction'                \n\n            }\n        },\n        mounted() {\n            this.$socket.on('msg-input:' + this.id, (msg) => {\n            \n                if (this.msg.dialog){\n                    let dialog = this.msg.dialog\n                    this.showDialog = dialog.showDialog ?? false\n                    this.okText = dialog.okText ?? \"OK\"\n                    this.cancelText = dialog.cancelText ?? \"Cancel\"\n                }\n                if (this.msg.payload){\n                    this.cbId = this.msg.payload.cbId\n                    this.command = this.msg.payload.command\n\n                }\n                if (this.msg.tags){\n                    this.options = this.msg.tags\n                }\n            })\n        },\n        methods: {\n            okDialog: function() {\n                this.showDialog = false\n                this.send({\n                    payload: {\n                        cbId: this.cbId,\n                        data: {\n                            connectorId: this.connector,\n                            tagId: this.option,\n                        },\n                        command: this.command\n                    }\n                })\n\n            },\n            cancelDialog: function() {\n                this.msg.paylaod = {}\n                this.showDialog = false\n                \n            }\n        }\n    }\n</script>\n<style>\n    /* define any styles here - supports raw CSS */\n    .my-class {\n        color: red;\n    }\n</style>",
        "storeOutMessages": true,
        "passthru": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1500,
        "y": 220,
        "wires": [
            [
                "3303c9688b7cce62",
                "9061953296c99fc7"
            ]
        ]
    },
    {
        "id": "f5a99899b46e0e63",
        "type": "ui-template",
        "z": "217382551c48905d",
        "group": "276c45fccf8e6765",
        "page": "",
        "ui": "",
        "name": "Remote Stop Tx",
        "order": 2,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n    <v-dialog width=\"auto\" v-model=\"showDialog\">\n        <v-card color=\"white\" v-click-outside=\"{handler: onClickOutside}\">\n            <v-toolbar color=\"primary\">\n                <v-card-title>\n                    <span>{{ cbId }}: Remote Start Transaction</span>\n                </v-card-title>\n            </v-toolbar>\n            <v-container>\n                <v-text-field\n                    v-model=\"transactionId\"\n                    label=\"Transaction ID\"\n                    type=\"number\"\n                    hint=\"Transaction ID to session to stop\"\n                ></v-text-field>\n            </v-container>\n            <v-card-actions class=\"justify-end\">\n                <v-btn variant=\"elevated\" @click=\"okDialog\">{{ okText }}</v-btn>\n                <v-btn variant=\"elevated\" @click=\"cancelDialog\">{{ cancelText }}</v-btn>\n            </v-card-actions>\n        </v-card>\n    </v-dialog>\n</template>\n\n<script>\n    export default {\n        data() {\n            // define variables available component-wide\n            // (in <template> and component functions)\n            return {\n                transactionId: 0,\n                cbId: 'xyzzz',\n                option: '',\n                options: [],\n                okText: 'OK',\n                showDialog: false,\n                cancelText: 'Cancel',\n                command: 'RemoteStopTransaction'                \n\n            }\n        },\n        mounted() {\n            this.$socket.on('msg-input:' + this.id, (msg) => {\n            \n                if (this.msg.dialog){\n                    let dialog = this.msg.dialog\n                    this.showDialog = dialog.showDialog ?? false\n                    this.okText = dialog.okText ?? \"OK\"\n                    this.cancelText = dialog.cancelText ?? \"Cancel\"\n                }\n                if (this.msg.payload){\n                    this.cbId = this.msg.payload.cbId\n                    this.command = this.msg.payload.command\n\n                }\n             })\n        },\n        methods: {\n            okDialog: function() {\n                this.showDialog = false\n                this.send({\n                    payload: {\n                        cbId: this.cbId,\n                        data: {\n                            transactionId: this.transactionId\n                        },\n                        command: this.command\n                    }\n                })\n\n            },\n            cancelDialog: function() {\n                this.msg.paylaod = {}\n                this.showDialog = false\n                \n            }\n        }\n    }\n</script>\n<style>\n    /* define any styles here - supports raw CSS */\n    .my-class {\n        color: red;\n    }\n</style>",
        "storeOutMessages": true,
        "passthru": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1220,
        "y": 260,
        "wires": [
            [
                "485897ecb288f5b2",
                "99239729a1eceb85"
            ]
        ]
    },
    {
        "id": "b89d3bee61c371a8",
        "type": "change",
        "z": "217382551c48905d",
        "name": "showDialog",
        "rules": [
            {
                "t": "set",
                "p": "dialog.showDialog",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 610,
        "y": 220,
        "wires": [
            [
                "f024c7fc32d8d05e"
            ]
        ]
    },
    {
        "id": "a20667f00c1262ba",
        "type": "link out",
        "z": "217382551c48905d",
        "name": "link out 14",
        "mode": "link",
        "links": [
            "19a1d55d0ad937f5"
        ],
        "x": 1505,
        "y": 480,
        "wires": []
    },
    {
        "id": "c84ee996687096fe",
        "type": "ui-template",
        "z": "217382551c48905d",
        "group": "276c45fccf8e6765",
        "page": "",
        "ui": "",
        "name": "Change Avail",
        "order": 8,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n    <v-dialog width=\"auto\" v-model=\"showDialog\">\n        <v-card color=\"white\" v-click-outside=\"{handler: onClickOutside}\">\n            <v-toolbar color=\"primary\">\n                <v-card-title>\n                    <span>{{ cbId }}: Change Availability</span>\n                </v-card-title>\n            </v-toolbar>\n            <v-container>\n                <v-text-field\n                    v-model=\"connector\"\n                    label=\"Connector ID\"\n                    type=\"number\"\n                    hint=\"Connector ID to unlock\"\n                ></v-text-field>\n                <v-select \n                    v-model=\"option\" \n                    label=\"Availability\"\n                    :items='options'\n                    hint=\"OCPP Trigger Message\">\n                </v-select>            \n            </v-container>\n            <v-card-actions class=\"justify-end\">\n                <v-btn variant=\"elevated\" @click=\"okDialog\">{{ okText }}</v-btn>\n                <v-btn variant=\"elevated\" @click=\"cancelDialog\">{{ cancelText }}</v-btn>\n            </v-card-actions>\n        </v-card>\n    </v-dialog>\n</template>\n\n<script>\n    export default {\n        data() {\n            // define variables available component-wide\n            // (in <template> and component functions)\n            return {\n                connector: 1,\n                cbId: 'xyzzz',\n                option: 'Operative',\n                options: ['Operative','Inoperative'],\n                okText: 'OK',\n                showDialog: false,\n                cancelText: 'Cancel',\n                command: 'ChangeAvailability'\n            }\n        },\n\n        watch: {},\n        mounted() {\n            this.$socket.on('msg-input:' + this.id, (msg) => {\n                if (this.msg.dialog){\n                    let dialog = this.msg.dialog\n                    this.showDialog = dialog.showDialog ?? false\n                    this.okText = dialog.okText ?? \"OK\"\n                    this.cancelText = dialog.cancelText ?? \"Cancel\"\n                }\n                if (this.msg.payload){\n                    this.cbId = this.msg.payload.cbId\n                    this.command = this.msg.payload.command\n\n                }\n            })\n        },\n        methods: {\n            okDialog: function() {\n                this.showDialog = false\n                this.send({\n                    payload: {\n                        cbId: this.cbId,\n                        data: {\n                            connectorId: this.connector,\n                            type: this.option,\n                        },\n                        command: this.command\n                    }\n                })\n\n            },\n            cancelDialog: function() {\n                this.msg.paylaod = {}\n                this.showDialog = false\n                \n            }\n\n        }\n    }\n</script>\n<style>\n    /* define any styles here - supports raw CSS */\n    .my-class {\n        color: red;\n    }\n</style>",
        "storeOutMessages": true,
        "passthru": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1210,
        "y": 160,
        "wires": [
            [
                "f740792ad0c8f5fd"
            ]
        ]
    },
    {
        "id": "c36b63f7c3de6924",
        "type": "ui-template",
        "z": "217382551c48905d",
        "group": "276c45fccf8e6765",
        "page": "",
        "ui": "",
        "name": "Ack Msg Sent",
        "order": 7,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n    <v-dialog width=\"auto\" v-model=\"showDialog\">\n        <v-card color=\"white\" v-click-outside=\"{handler: onClickOutside}\">\n            <v-toolbar color=\"primary\">\n                <v-card-title>\n                    <span>Message Sent: {{ cbId }}:{{command}}</span>\n                </v-card-title>\n            </v-toolbar>\n            <v-container>\n            <v-card-actions>\n                <v-btn variant=\"elevated\" @click=\"okDialog\" block>{{ okText }}</v-btn>\n            </v-card-actions>\n        </v-card>\n    </v-dialog>\n</template>\n\n<script>\n    export default {\n        data() {\n            // define variables available component-wide\n            // (in <template> and component functions)\n            return {\n                cbId: '',\n                okText: 'Close',\n                command: '',\n                showDialog: false,\n            }\n        },\n\n        watch: {},\n        mounted() {\n            this.$socket.on('msg-input:' + this.id, (msg) => {\n                if (this.msg.dialog){\n                    let dialog = this.msg.dialog\n                    this.showDialog = dialog.showDialog ?? false\n                }\n                if (this.msg.payload){\n                    this.cbId = this.msg?.payload?.cbId\n                    this.command = this.msg?.payload?.command ?? 'unknown'\n                }\n            })\n        },\n        methods: {\n            okDialog: function() {\n                this.showDialog = false\n\n            },\n            cancelDialog: function() {\n                this.msg.paylaod = {}\n                this.showDialog = false\n                \n            }\n\n        }\n    }\n</script>\n<style>\n    /* define any styles here - supports raw CSS */\n    .my-class {\n        color: red;\n    }\n</style>",
        "storeOutMessages": true,
        "passthru": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1220,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "9061953296c99fc7",
        "type": "link out",
        "z": "217382551c48905d",
        "name": "link out 18",
        "mode": "link",
        "links": [
            "6ea73070a96d4eeb",
            "9405f117efca5faf"
        ],
        "x": 1665,
        "y": 180,
        "wires": []
    },
    {
        "id": "5e3e9b161183e7fa",
        "type": "debug",
        "z": "217382551c48905d",
        "name": "debug 43",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1200,
        "y": 300,
        "wires": []
    },
    {
        "id": "78ba51776812da90",
        "type": "redis-command",
        "z": "217382551c48905d",
        "server": "0430675ed6c7cd83",
        "command": "KEYS",
        "name": "Get TagInfo",
        "topic": "taginfo:*",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 1210,
        "y": 220,
        "wires": [
            [
                "dee9becc2f4f6552"
            ]
        ]
    },
    {
        "id": "35448e49dfc5fde2",
        "type": "change",
        "z": "217382551c48905d",
        "name": "Protect Payload",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "payload2",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1040,
        "y": 220,
        "wires": [
            [
                "78ba51776812da90"
            ]
        ]
    },
    {
        "id": "dee9becc2f4f6552",
        "type": "change",
        "z": "217382551c48905d",
        "name": "tags",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "tags",
                "tot": "msg"
            },
            {
                "t": "move",
                "p": "payload2",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "tags",
                "pt": "msg",
                "to": "$map(tags,function($v,$i,$a){ $substringAfter($v, \":\")})",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1350,
        "y": 220,
        "wires": [
            [
                "f4550ea4a5f41146"
            ]
        ]
    },
    {
        "id": "3303c9688b7cce62",
        "type": "debug",
        "z": "217382551c48905d",
        "name": "debug 45",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1720,
        "y": 220,
        "wires": []
    },
    {
        "id": "061560f521c54ff7",
        "type": "function",
        "z": "217382551c48905d",
        "name": "function 15",
        "func": "let key = `evse:${msg.payload.cbId}`\nmsg = {}\nmsg.topic = key\nreturn msg\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1870,
        "y": 400,
        "wires": [
            [
                "426241cfa981a02b"
            ]
        ]
    },
    {
        "id": "aadafb1151581c5d",
        "type": "ui-template",
        "z": "217382551c48905d",
        "group": "1723c74d3f81385c",
        "page": "",
        "ui": "",
        "name": "Verify Delete",
        "order": 2,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n    <v-dialog width=\"auto\" v-model=\"showDialog\">\n        <v-card color=\"white\" v-click-outside=\"{handler: onClickOutside}\">\n            <v-toolbar color=\"primary\">\n                <v-card-title>\n                    <span>Delete {{ cbId }}?</span>\n                </v-card-title>\n            </v-toolbar>\n            <v-container>\n                <v-card-actions class=\"justify-end\">\n                    <v-btn variant=\"elevated\" @click=\"okDialog\">{{ okText }}</v-btn>\n                    <v-btn variant=\"elevated\" @click=\"cancelDialog\">{{ cancelText }}</v-btn>\n                </v-card-actions>\n            </v-container>\n        </v-card>\n    </v-dialog>\n</template>\n\n<script>\n    export default {\n        data() {\n            return {\n                okText: 'Delete',\n                cancelText: 'Cancel',\n                showDialog: false,\n                cbId: '<undefined>'\n            }\n        },\n\n        watch: {},\n        \n        mounted() {\n            this.$socket.on('msg-input:' + this.id, (msg) => {\n                if (this.msg.dialog){\n                    let dialog = this.msg.dialog\n                    this.showDialog = dialog.showDialog ?? false\n                    this.okText = dialog?.okText\n                    this.cancelText = dialog?.cancelText\n                }\n                if (this.msg.payload){\n                    let payload = this.msg.payload\n                    this.cbId = payload.cbId\n                }\n            })\n        },\n        methods: {\n            okDialog: function() {\n                this.showDialog = false\n                this.send(this.msg)\n\n            },\n            cancelDialog: function() {\n                this.msg.paylaod = {}\n                this.showDialog = false\n            }\n\n        }\n    }\n</script>\n",
        "storeOutMessages": true,
        "passthru": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1710,
        "y": 400,
        "wires": [
            [
                "061560f521c54ff7"
            ]
        ]
    },
    {
        "id": "d9db7aa7fbab290f",
        "type": "change",
        "z": "217382551c48905d",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "dialog.showDialog",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            },
            {
                "t": "set",
                "p": "dialog.okText",
                "pt": "msg",
                "to": "Delete",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "dialog.cancelText",
                "pt": "msg",
                "to": "Cancel",
                "tot": "str"
            },
            {
                "t": "move",
                "p": "payload[0]",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1540,
        "y": 400,
        "wires": [
            [
                "aadafb1151581c5d",
                "639178f5d96d873a"
            ]
        ]
    },
    {
        "id": "a25df1a5696fa43b",
        "type": "change",
        "z": "217382551c48905d",
        "name": "tags",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$map(payload,function($v,$i,$a){ $substringAfter($v, \":\")})",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "CSMS:EVSEs",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 510,
        "y": 480,
        "wires": [
            [
                "aa90b7e66d3251d1"
            ]
        ]
    },
    {
        "id": "aa90b7e66d3251d1",
        "type": "debug",
        "z": "217382551c48905d",
        "name": "debug 49",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 790,
        "y": 480,
        "wires": []
    },
    {
        "id": "a361a3233397f32f",
        "type": "link out",
        "z": "217382551c48905d",
        "name": "link out 21",
        "mode": "link",
        "links": [
            "fd0ce11a6c04c0f3"
        ],
        "x": 1245,
        "y": 540,
        "wires": []
    },
    {
        "id": "240e92a246471c35",
        "type": "ui-control",
        "z": "217382551c48905d",
        "name": "",
        "ui": "8cdc313c9611f13f",
        "events": "all",
        "x": 560,
        "y": 320,
        "wires": [
            [
                "67e1b0b8d9f9b568"
            ]
        ]
    },
    {
        "id": "67e1b0b8d9f9b568",
        "type": "debug",
        "z": "217382551c48905d",
        "name": "debug 55",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 700,
        "y": 320,
        "wires": []
    },
    {
        "id": "a54b3536ac0b7516",
        "type": "function",
        "z": "217382551c48905d",
        "name": "Hide",
        "func": "msg.payload = {\n    \"groups\": {\n        \"hide\": [\n            \"EVSEs:Hidden\"\n        ]\n    }\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 320,
        "wires": [
            [
                "240e92a246471c35"
            ]
        ]
    },
    {
        "id": "d58c45d08125f791",
        "type": "function",
        "z": "217382551c48905d",
        "name": "Show",
        "func": "msg.payload = {\n    \"groups\": {\n        \"show\": [\n            \"EVSEs:Hidden\"\n        ]\n    }\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 280,
        "wires": [
            [
                "240e92a246471c35"
            ]
        ]
    },
    {
        "id": "9405f117efca5faf",
        "type": "link in",
        "z": "217382551c48905d",
        "name": "Hide Hidden",
        "links": [
            "9061953296c99fc7",
            "82c7dc438bcf613e",
            "c1ed374a1bace4de",
            "485897ecb288f5b2"
        ],
        "x": 105,
        "y": 320,
        "wires": [
            [
                "2360b2b5d9f086ce"
            ]
        ]
    },
    {
        "id": "4accb5be39dab46c",
        "type": "inject",
        "z": "217382551c48905d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 285,
        "y": 360,
        "wires": [
            [
                "a54b3536ac0b7516"
            ]
        ],
        "l": false
    },
    {
        "id": "abd4fc7cece76024",
        "type": "link in",
        "z": "217382551c48905d",
        "name": "Show Hidden",
        "links": [
            "7bc827572072b785",
            "8c62605df95e3ac2"
        ],
        "x": 235,
        "y": 280,
        "wires": [
            [
                "d58c45d08125f791"
            ]
        ]
    },
    {
        "id": "f813f3d81530033f",
        "type": "delay",
        "z": "217382551c48905d",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 110,
        "y": 280,
        "wires": [
            [
                "67831ed4d8bdfde1"
            ]
        ]
    },
    {
        "id": "2360b2b5d9f086ce",
        "type": "delay",
        "z": "217382551c48905d",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 210,
        "y": 320,
        "wires": [
            [
                "a54b3536ac0b7516"
            ]
        ]
    },
    {
        "id": "a15783afb2f690dc",
        "type": "delay",
        "z": "217382551c48905d",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 150,
        "y": 140,
        "wires": [
            [
                "cb4389b379c7a461"
            ]
        ]
    },
    {
        "id": "3cf0aaa06cd6633b",
        "type": "debug",
        "z": "217382551c48905d",
        "name": "debug 65",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1290,
        "y": 660,
        "wires": []
    },
    {
        "id": "485897ecb288f5b2",
        "type": "link out",
        "z": "217382551c48905d",
        "name": "OCPP Cmd Out",
        "mode": "link",
        "links": [
            "6ea73070a96d4eeb",
            "9405f117efca5faf"
        ],
        "x": 1349,
        "y": 258,
        "wires": []
    },
    {
        "id": "99239729a1eceb85",
        "type": "debug",
        "z": "217382551c48905d",
        "name": "debug 1",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1470,
        "y": 280,
        "wires": []
    },
    {
        "id": "250472edd0782156",
        "type": "ui-template",
        "z": "68c0944e7f4deca9",
        "group": "c04aff20955da79f",
        "page": "",
        "ui": "",
        "name": "",
        "order": 2,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n\n    <v-data-table  \n            v-model:search=\"search\" \n            :items=\"msg?.payload?.data?.configurationKey\"\n            :headers=\"headers\"\n            :filter-keys='[\"key\",\"value\"]'\n            >\n      <template v-slot:top>\n        <v-toolbar flat>\n          <v-toolbar-title>\n            <v-icon color=\"medium-emphasis\" icon=\"mdi-cog-transfer\" size=\"x-small\" start></v-icon>\n            EVSE Config\n          </v-toolbar-title>\n          <v-text-field\n            v-model=\"search\"\n            label=\"Search\"\n            prepend-inner-icon=\"mdi-magnify\"\n            clear-icon=\"mdi-close-circle\"\n            variant=\"solo-filled\"\n            density=\"compact\"\n            hide-details\n            single-line\n            clearable\n          ></v-text-field>\n            <v-tooltip text=\"Refresh\" location=\"bottom\">\n                <template v-slot:activator=\"{ props }\">\n                    <v-btn icon v-bind=\"props\" @click=\"refresh\">\n                    <v-icon>mdi-refresh</v-icon>\n                </v-btn>\n                </template>\n            </v-tooltip>\n        </v-toolbar>\n      </template>\n      \n      <template v-slot:item.actions=\"{ item }\">\n        <v-icon v-if=\"!item.readonly\"\n          class=\"me-2\"\n          size=\"small\"\n          @click=\"send({action: 'edit', payload: [item], cbId })\"\n        >\n          mdi-pencil\n        </v-icon>\n        <v-icon v-else\n          class=\"me-2\"\n          size=\"small\"\n          color=\"grey\"\n        >\n          mdi-pencil-off\n        </v-icon>        \n      </template>\n\n    </v-data-table>\n</template>\n\n<script>\n    export default {\n        data() {\n            // define variables available component-wide\n            // (in <template> and component functions)\n            return {\n                search: '',\n                headers: [\n                    { key: 'actions', title: 'Edit', align: 'start', \n                        sortRaw (a,b) {\n                            if (a.readonly && ( b.readonly == false) ) return 1;\n                            if (!a.readonly && b.readonly) return -1;\n                            return 0;\n                                                \n                        }                        \n                    },                    \n                    {title: \"Key\", value: \"key\", sortable: true},\n                    {title: \"Value\", value: \"value\", sortable: true}                ],\n                value: '',\n                cbId: 'unknown'\n            }\n        },\n        watch: {\n            // watch for any changes of \"count\"\n\n        },\n        computed: {\n\n        },\n        methods: {\n            \n        },\n        mounted() {\n            // code here when the component is first loaded\n            this.$socket.on('msg-input:' + this.id, (msg) => {\n                // do stuff with msg\n                // runs only when messages are received\n                //if (this.msg?.payload){\n                //    let payload = this.msg.payload\n                //    this.configKey = payload.key\n                //    this.configValue = payload.value\n                //}\n                if (this.msg?.ocpp) {\n                    this.cbId = this.msg.ocpp?.chargeBoxIdentity ?? \"ERROR\"\n                }\n            })\n        },\n        unmounted() {\n            // code here when the component is removed from the Dashboard\n            // i.e. when the user navigates away from the page\n        }\n    }\n\n//sortRaw: (a, b) {\n//                            if (a.readonly == b.readonly) return 0; \n//                            if (a.readonly > b.readonly) return 1;\n//                            if (a.readonly < b.readonly) return -1;\n//                        }\n\n\n</script>\n<style>\n    /* define any styles here - supports raw CSS */\n    .my-class {\n        color: red;\n    }\n    .headers {\n        font-weight: bold;\n    }\n    .ocppMsgReq {\n        color: blue;\n        font-weight: bold;\n    }\n    .ocppMsgRes {\n        color: blue;\n    }\n    .ocppMsgErr {\n        color: red;\n    }\n    .ocppCmdReq {\n        color: green;\n        font-weight: bold;\n    }\n    .ocppCmdRes {\n        color: DarkCyan;\n    }\n</style>\n\n",
        "storeOutMessages": true,
        "passthru": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 500,
        "y": 160,
        "wires": [
            [
                "a611c369ecc73876"
            ]
        ]
    },
    {
        "id": "6d40c15be6021ad7",
        "type": "link in",
        "z": "68c0944e7f4deca9",
        "name": "GetConfig",
        "links": [
            "b13502a9cfe6c685",
            "5358a0d2bbfaf7b3"
        ],
        "x": 265,
        "y": 160,
        "wires": [
            [
                "250472edd0782156",
                "72ce3ed5698f5660"
            ]
        ]
    },
    {
        "id": "72ce3ed5698f5660",
        "type": "debug",
        "z": "68c0944e7f4deca9",
        "name": "debug 38",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 500,
        "y": 200,
        "wires": []
    },
    {
        "id": "dadfc221f1661483",
        "type": "ui-template",
        "z": "68c0944e7f4deca9",
        "group": "c04aff20955da79f",
        "page": "",
        "ui": "",
        "name": "Edit Form",
        "order": 3,
        "width": "0",
        "height": "0",
        "head": "",
        "format": "<template>\n    <v-dialog width=\"auto\" v-model=\"showDialog\">\n        <v-card color=\"white\" v-click-outside=\"{handler: onClickOutside}\">\n            <v-toolbar color=\"primary\">\n                <v-card-title>\n                    <span>{{ title }} for {{ cbId }}</span>\n                </v-card-title>\n            </v-toolbar>\n            <v-container>\n                <v-text-field\n                    v-model=\"configKey\"\n                    label=\"Key\"\n                    type=\"text\"\n                    disabled\n                    min-width=50em\n                    hint=\"Config Key Name\"\n                ></v-text-field>\n                <v-text-field\n                    v-model=\"configValue\"\n                    label=\"Value\"\n                    type=\"text\"\n                ></v-text-field>\n\n                <v-card-actions class=\"justify-end\">\n                    <v-btn variant=\"elevated\" @click=\"okDialog\">{{ okText }}</v-btn>\n                    <v-btn variant=\"elevated\" @click=\"cancelDialog\">{{ cancelText }}</v-btn>\n                </v-card-actions>\n            </v-container>\n        </v-card>\n    </v-dialog>\n</template>\n\n<script>\n    export default {\n        data() {\n            // define variables available component-wide\n            // (in <template> and component functions)\n            return {\n                configKey: '',\n                configValue: '',\n                cbId: 'ERROR',\n                showDialog: false\n            }\n        },\n        watch: {\n            // watch for any changes of \"count\"\n        },    \n        computed: {\n            // automatically compute this variable\n            // whenever VueJS deems appropriate\n\n        },\n        methods: {\n            // expose a method to our <template> and Vue Application\n            sendconfigdata: function() {\n                this.send({\n                    payload: {\n                        key: this.configKey,\n                        value: this.configValue,\n                        cbId: this.cbId\n                    }\n                })\n            },\n            okDialog: function() {\n                this.sendconfigdata()\n                this.showDialog = false\n            },\n            cancelDialog: function() {\n                this.msg.payload = {}\n                this.showDialog = false\n            },\n            onClickOutside: function() {\n                this.msg.payload = {}\n                this.showDialog = false\n            },\n\n        },\n        mounted() {\n\n            this.$socket.on('msg-input:' + this.id, (msg) => {\n                // do stuff with msg\n                // runs only when messages are received\n                if (this.msg?.payload){\n                    let payload = this.msg.payload\n                    this.configKey = payload.key\n                    this.configValue = payload.value\n                    this.cbId = payload.cbId\n                }\n                if (this.msg?.dialog) {\n                    let dialog = this.msg.dialog\n                    this.okText = dialog.okText ?? \"OK\"\n                    this.cancelText = dialog.cancelText ?? \"Cancel\"\n                    this.showDialog = dialog.showDialog ?? false\n                    this.title = dialog.title ?? \"Edit Config Key\"\n                }\n            })\n                        \n        },\n        unmounted() {}\n   }\n</script>\n",
        "storeOutMessages": true,
        "passthru": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 500,
        "y": 80,
        "wires": [
            [
                "45d4b152cda7914e"
            ]
        ]
    },
    {
        "id": "9a3712f9d4ef4b3c",
        "type": "link in",
        "z": "68c0944e7f4deca9",
        "name": "Edit Config Item",
        "links": [
            "9dc7fde8212f4622"
        ],
        "x": 265,
        "y": 80,
        "wires": [
            [
                "dadfc221f1661483"
            ]
        ]
    },
    {
        "id": "9dc7fde8212f4622",
        "type": "link out",
        "z": "68c0944e7f4deca9",
        "name": "link out 24",
        "mode": "link",
        "links": [
            "9a3712f9d4ef4b3c"
        ],
        "x": 1115,
        "y": 200,
        "wires": []
    },
    {
        "id": "f06a407da6df4ef5",
        "type": "change",
        "z": "68c0944e7f4deca9",
        "name": "Add/Edit Dialog ",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload[0]",
                "tot": "msg"
            },
            {
                "t": "move",
                "p": "cbId",
                "pt": "msg",
                "to": "payload.cbId",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "dialog.showDialog",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            },
            {
                "t": "set",
                "p": "dialog.okText",
                "pt": "msg",
                "to": "Update",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "dialog.cancelText",
                "pt": "msg",
                "to": "Cancel",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "dialog.title",
                "pt": "msg",
                "to": "Edit Configuration",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 920,
        "y": 200,
        "wires": [
            [
                "9dc7fde8212f4622"
            ]
        ]
    },
    {
        "id": "45d4b152cda7914e",
        "type": "change",
        "z": "68c0944e7f4deca9",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "payload.data",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.command",
                "pt": "msg",
                "to": "ChangeConfiguration",
                "tot": "str"
            },
            {
                "t": "move",
                "p": "payload.data.cbId",
                "pt": "msg",
                "to": "payload.cbId",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 680,
        "y": 80,
        "wires": [
            [
                "bf301b6e3cd5b7f3",
                "c333f56bd1abd4ca"
            ]
        ]
    },
    {
        "id": "bf301b6e3cd5b7f3",
        "type": "link out",
        "z": "68c0944e7f4deca9",
        "name": "link out 25",
        "mode": "link",
        "links": [
            "6ea73070a96d4eeb"
        ],
        "x": 1005,
        "y": 80,
        "wires": []
    },
    {
        "id": "16e438b3b8461c0a",
        "type": "function",
        "z": "68c0944e7f4deca9",
        "name": "Refresh GetConfig",
        "func": "let cbId = flow.get('CSMS:GetConfCBID')\n\nmsg.payload = {\n    \"command\": \"GetConfiguration\",\n    cbId,\n    \"data\": {\n        \"key\": []\n    }\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 160,
        "wires": [
            [
                "bf301b6e3cd5b7f3"
            ]
        ]
    },
    {
        "id": "a611c369ecc73876",
        "type": "switch",
        "z": "68c0944e7f4deca9",
        "name": "",
        "property": "action",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "refresh",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 630,
        "y": 160,
        "wires": [
            [
                "16e438b3b8461c0a",
                "6cf5c9be715a7818"
            ],
            [
                "f06a407da6df4ef5"
            ]
        ]
    },
    {
        "id": "c333f56bd1abd4ca",
        "type": "delay",
        "z": "68c0944e7f4deca9",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 750,
        "y": 120,
        "wires": [
            [
                "16e438b3b8461c0a"
            ]
        ]
    },
    {
        "id": "8fd801d05bd71d61",
        "type": "redis-command",
        "z": "68c0944e7f4deca9",
        "server": "0430675ed6c7cd83",
        "command": "KEYS",
        "name": "",
        "topic": "",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 470,
        "y": 400,
        "wires": [
            [
                "be36cf15b35bb259"
            ]
        ]
    },
    {
        "id": "90710dfacc2327b0",
        "type": "function",
        "z": "68c0944e7f4deca9",
        "name": "Scan evse tags",
        "func": "msg = {}\nmsg.payload = \"evse:*\"\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 300,
        "y": 400,
        "wires": [
            [
                "8fd801d05bd71d61"
            ]
        ]
    },
    {
        "id": "a78f4a87347eb493",
        "type": "inject",
        "z": "68c0944e7f4deca9",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "3",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 110,
        "y": 400,
        "wires": [
            [
                "90710dfacc2327b0"
            ]
        ]
    },
    {
        "id": "572385ddb0a2b809",
        "type": "function",
        "z": "68c0944e7f4deca9",
        "name": "Refresh GetConfig",
        "func": "const cbId = msg.payload\n\nmsg.payload = {\n    \"command\": \"GetConfiguration\",\n    \"cbId\": cbId,\n    \"data\": {\n        \"key\": []\n    }\n}\n\nflow.set('CSMS:GetConfCBID',cbId)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 300,
        "wires": [
            [
                "76415b48f89bd6e0",
                "bf301b6e3cd5b7f3"
            ]
        ]
    },
    {
        "id": "76415b48f89bd6e0",
        "type": "debug",
        "z": "68c0944e7f4deca9",
        "name": "debug 58",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 900,
        "y": 300,
        "wires": []
    },
    {
        "id": "8bf08fe2bc5b95ca",
        "type": "redis-command",
        "z": "68c0944e7f4deca9",
        "server": "0430675ed6c7cd83",
        "command": "MGET",
        "name": "",
        "topic": "",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 810,
        "y": 400,
        "wires": [
            [
                "fedaf0f9550a6f4f"
            ]
        ]
    },
    {
        "id": "50b98c854d06dda8",
        "type": "debug",
        "z": "68c0944e7f4deca9",
        "name": "debug 83",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1160,
        "y": 400,
        "wires": []
    },
    {
        "id": "fedaf0f9550a6f4f",
        "type": "function",
        "z": "68c0944e7f4deca9",
        "name": "function 26",
        "func": "let evses = []\nlet evse\nlet hb_int = global.get('CSMS:HeartbeatInterval') || 120\n\nmsg.payload.forEach(function (evse_str) {\n    evse = JSON.parse(evse_str)\n    if (Math.floor((Date.now() - evse.lastcommtime) / 1000) <= hb_int)  {\n        evses.push(evse.cbId)\n    }\n})\n\nevses = evses.sort((a, b) => {\n    const aLower = a.toLowerCase();\n    const bLower = b.toLowerCase();\n\n    if (aLower < bLower) {\n        return -1;\n    }\n    if (aLower > bLower) {\n        return 1;\n    }\n    return 0; // Equal\n});\n\n//msg.payload = evses;\nmsg.ui_update = {\n    options: evses\n}\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 970,
        "y": 400,
        "wires": [
            [
                "50b98c854d06dda8",
                "e009227e88c390b1"
            ]
        ]
    },
    {
        "id": "e009227e88c390b1",
        "type": "ui-dropdown",
        "z": "68c0944e7f4deca9",
        "group": "c04aff20955da79f",
        "name": "",
        "label": "Select EVSE",
        "tooltip": "",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "multiple": false,
        "chips": false,
        "clearable": false,
        "options": [
            {
                "label": "",
                "value": "",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "typeIsComboBox": true,
        "msgTrigger": "onChange",
        "x": 390,
        "y": 260,
        "wires": [
            [
                "572385ddb0a2b809",
                "6cf5c9be715a7818"
            ]
        ]
    },
    {
        "id": "6cf5c9be715a7818",
        "type": "change",
        "z": "68c0944e7f4deca9",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "[]",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 700,
        "y": 240,
        "wires": [
            [
                "5358a0d2bbfaf7b3"
            ]
        ]
    },
    {
        "id": "5358a0d2bbfaf7b3",
        "type": "link out",
        "z": "68c0944e7f4deca9",
        "name": "link out 49",
        "mode": "link",
        "links": [
            "6d40c15be6021ad7"
        ],
        "x": 825,
        "y": 240,
        "wires": []
    },
    {
        "id": "be36cf15b35bb259",
        "type": "function",
        "z": "68c0944e7f4deca9",
        "name": "Check Empty",
        "func": "if ( msg?.payload.length != 0 ){\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 400,
        "wires": [
            [
                "8bf08fe2bc5b95ca"
            ]
        ]
    },
    {
        "id": "49370f62ef275c28",
        "type": "function",
        "z": "92d055a5ecbac90c",
        "name": "function 14",
        "func": "let sess = global.get(\"CSMS:SESSIONS\") || []\nlet heartbeat = global.get(\"CSMS:HeartbeatInterval\") || 300\nlet sess_cbid = sess.map( (x) => x.cbId )\n\nconst COLOROFFLINE = \"#CCCCCC\"\nconst COLORONLINE = \"#33ceff\"\nconst COLORCHARGE = \"#007700\"\n\n\nmsg.payload.forEach(function(evse) {\n    if (evse.lat && evse.lon){\n\n        let iconColor =  (getIsOnline(evse) == true) ? COLORONLINE : COLOROFFLINE\n         \n        iconColor = ( sess_cbid.indexOf(evse.cbId) != -1 ) ? COLORCHARGE : iconColor \n        let msg2 = {\n            payload: {\n                name: evse.cbId,\n                lat: evse.lat,\n                lon: evse.lon,\n                icon: (iconColor == COLORCHARGE) ? \"car\": \"flash\",\n                iconColor\n            }\n        }        \n        node.send(msg2)\n    }\n});\n\n\nfunction getIsOnline(item) {\n    return (Math.floor((Date.now() - item.lastcommtime) / 1000) <= heartbeat)\n}\n\n\n//                 icon: \"https://api.mdisvg.com/v1/i/mdi-ev-station\",",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 290,
        "y": 40,
        "wires": [
            [
                "089bf4f30ca18408"
            ]
        ]
    },
    {
        "id": "089bf4f30ca18408",
        "type": "worldmap",
        "z": "92d055a5ecbac90c",
        "name": "",
        "lat": "",
        "lon": "",
        "zoom": "",
        "layer": "OSMG",
        "cluster": "",
        "maxage": "",
        "usermenu": "show",
        "layers": "show",
        "panit": "false",
        "panlock": "false",
        "zoomlock": "false",
        "hiderightclick": "false",
        "coords": "deg",
        "showgrid": "false",
        "showruler": "false",
        "allowFileDrop": "false",
        "path": "/worldmap",
        "overlist": "DR,CO,TL",
        "maplist": "OSMG,OSMC,EsriC,EsriS,UKOS",
        "mapname": "",
        "mapurl": "",
        "mapopt": "",
        "mapwms": false,
        "x": 540,
        "y": 40,
        "wires": []
    },
    {
        "id": "fd0ce11a6c04c0f3",
        "type": "link in",
        "z": "92d055a5ecbac90c",
        "name": "Map Items",
        "links": [
            "a361a3233397f32f"
        ],
        "x": 165,
        "y": 40,
        "wires": [
            [
                "49370f62ef275c28"
            ]
        ]
    },
    {
        "id": "af38625e0eb46e1a",
        "type": "ui-template",
        "z": "92d055a5ecbac90c",
        "group": "1e933af2c31d3e40",
        "page": "",
        "ui": "",
        "name": "Graphic Banner",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n    <container>\n        <v-img \n            :src=\"this.url\"\n            lazy-src=\"/assets/blue.png\"\n            max-height=\"500\">\n        </v-img>\n    </container>\n</template>\n\n<script>\n    export default {\n\n        data() {\n            // define variables available component-wide\n            // (in <template> and component functions)\n            return {\n                url: \"\",\n                show: false,\n                showx: true\n            }\n        },\n        \n        unmounted() {\n            // code here when the component is removed from the Dashboard\n            // i.e. when the user navigates away from the page\n        },\n        mounted() {\n            this.$socket.on('msg-input:' + this.id, (msg) => {\n                if (this.msg.payload){\n                    let payload = this.msg.payload\n                    this.url = payload.banner_url\n                    this.show = payload.show || true\n                }\n            })\n            this.refresh()\n        },      \n        methods: {\n        },\n    }\n</script>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 600,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "39f51e38c8ce88f2",
        "type": "change",
        "z": "92d055a5ecbac90c",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"currentA\":0,\"time\":\"\"}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "payload.currentA",
                "pt": "msg",
                "to": "SITE:LoadLimit",
                "tot": "global"
            },
            {
                "t": "set",
                "p": "payload.time",
                "pt": "msg",
                "to": "",
                "tot": "date"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "LoadLimit",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 420,
        "y": 940,
        "wires": [
            [
                "d1bc1b3ba06b799a"
            ]
        ]
    },
    {
        "id": "74499b15f0145429",
        "type": "inject",
        "z": "92d055a5ecbac90c",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "3",
        "crontab": "",
        "once": true,
        "onceDelay": "0.5",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 145,
        "y": 940,
        "wires": [
            [
                "39f51e38c8ce88f2",
                "d8769e54fee991f9"
            ]
        ],
        "l": false
    },
    {
        "id": "f3b30d3612e48f36",
        "type": "influxdb in",
        "z": "92d055a5ecbac90c",
        "influxdb": "7cb40fcee206391e",
        "name": "",
        "query": "",
        "rawOutput": false,
        "precision": "",
        "retentionPolicy": "",
        "org": "cipio",
        "x": 660,
        "y": 980,
        "wires": [
            [
                "0f02c20fb2330f7a",
                "825191f59f313cab",
                "19926af6f970a4b9"
            ]
        ]
    },
    {
        "id": "f18b9979d2212d1b",
        "type": "function",
        "z": "92d055a5ecbac90c",
        "name": "FLUX Get raw MV OCPP",
        "func": "// clear out any incoming message for now.\nlet filter_by_tx = \"\";\nlet topic = \"00000000\"\n\n/*\nif (msg.payload.txId) {\n  filter_by_tx = `|> filter(fn: (r) => r[\"transactionId\"] == \"${msg.payload.txId}\")`\n  topic = msg.payload.txId\n}\n*/\n\nmsg = {}\n\nmsg.topic = topic\n\nlet window = global.get(\"CSMS:MVSampleInterval\") || 60\n\nlet measurand = \"CurrentA\"\n\nmsg.query = \n  `from(bucket: \"OCPP\") \n    |> range(start: -1h) \n    |> filter(fn: (r) => r[\"_measurement\"] == \"MeterValues\") \n    |> filter(fn: (r) => r[\"_field\"] == \"${measurand}\")\n    |> aggregateWindow(every: ${window}s, createEmpty: true, fn: mean)\n    |> sort(columns: [\"_time\"])`\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 980,
        "wires": [
            [
                "f3b30d3612e48f36"
            ]
        ]
    },
    {
        "id": "0f02c20fb2330f7a",
        "type": "function",
        "z": "92d055a5ecbac90c",
        "name": "FLUX remove extras",
        "func": "msg.payload.forEach(function(mv) {\n    //delete ocppMsg.result;\n    //delete ocppMsg.table;\n    node.send({ \n        topic: `${mv.cbId}:P${mv.connectorId}`, \n        payload: {\n            currentA: mv._value,\n            time: mv._time \n        } \n    })\n});\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 960,
        "wires": [
            []
        ]
    },
    {
        "id": "825191f59f313cab",
        "type": "debug",
        "z": "92d055a5ecbac90c",
        "name": "debug 62",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 880,
        "y": 920,
        "wires": []
    },
    {
        "id": "d1bc1b3ba06b799a",
        "type": "debug",
        "z": "92d055a5ecbac90c",
        "name": "debug 63",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 600,
        "y": 940,
        "wires": []
    },
    {
        "id": "9ccf03b5bb8eecc2",
        "type": "debug",
        "z": "92d055a5ecbac90c",
        "name": "debug 64",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1080,
        "y": 1000,
        "wires": []
    },
    {
        "id": "19926af6f970a4b9",
        "type": "ui-template",
        "z": "92d055a5ecbac90c",
        "group": "dbf0d787ce369418",
        "page": "",
        "ui": "",
        "name": "ChartJS Current",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n    <canvas ref=\"chart\" />\n</template>\n\n<script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\n\n<script>\n    export default {\n        mounted() {\n            // register a listener for incoming data\n            this.$socket.on('msg-input:' + this.id, this.onInput)\n\n            // check with ChartJS has loaded\n            let interval = setInterval(() => {\n                if (window.Chart) {\n                    // clear the check for ChartJS\n                    clearInterval(interval);\n                    // draw our initial chart\n                    this.draw()\n                }\n            }, 100);\n        },\n        methods: {\n            draw () {\n                // get reference to the <canvas /> element\n                const ctx = this.$refs.chart\n                \n                // Render the chart\n                const chart = new Chart(ctx, {\n                    type: 'line',\n                    data: {\n                        datasets: [{\n                            label: \"\",  // label for the single line we'll render\n                            data: [\n                            ],            // start with no data\n                            fill: 1\n                        }]\n                    },\n                    options: {\n                        animation: false, // don't run the animation for incoming data\n                        responsive: true, // ensure we auto-resize the content\n                        scales: {\n                            x: {\n                                type: 'time' // in this example, we're rendering timestamps\n                            },\n                            y: {\n                                stacked: true\n                            }\n                        },\n                        parsing: {\n                            xAxisKey: 'time', // the property to render on the x-axis\n                            yAxisKey: 'value' // the property to render on the y-axis\n                        },\n                        plugins: {\n                            legend: {\n                                position: 'top',\n                            },\n                            title: {\n                                display: true,\n                                text: 'EVSE Current (Amps)'\n                            }\n                        }   \n                    },\n                });\n                // make this available to all elements of the component\n                this.chart = chart\n            },\n            onInput (msg) {\n                this.chart.data.datasets = []\n                // this.chart.data.datasets[0].data = []\n                this.chart.update()\n             \n\n\n                msg.payload.forEach( ( mvItem ) => {\n                    let label = `${mvItem.cbId}:P${mvItem.connectorId}`\n                    let idx = this.chart.data.datasets.findIndex( (ds) => ds.label == label )\n\n                    if (idx == -1) { \n                        idx = this.chart.data.datasets.push( {label: label, data: [] } ) - 1\n                    }\n                    \n                    this.chart.data.datasets[idx].data.push({time: mvItem._time, value: mvItem._value}) \n                })\n                this.chart.update()  \n            }    \n            \n        }\n    }\n\n</script>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 900,
        "y": 1000,
        "wires": [
            [
                "9ccf03b5bb8eecc2"
            ]
        ]
    },
    {
        "id": "4e88cb3fee82d891",
        "type": "function",
        "z": "92d055a5ecbac90c",
        "name": "Get Tx MeterStart/Stop  ",
        "func": "msg = {}\n\nmsg.query = `\nmeterStart = from(bucket: \"OCPP\")\n  |> range(start: -2d)\n  |> filter(fn: (r) => r[\"_measurement\"] == \"Transaction\")\n  |> filter(fn: (r) => r[\"_field\"] == \"transactionId\" or r[\"_field\"] == \"meterStart\")\n  |> filter(fn: (r) => r.command == \"StartTransaction\")\n  |> pivot(columnKey: [\"_field\"], rowKey: [\"_time\"], valueColumn: \"_value\")\n  |> filter(fn: (r) => r.transactionId != 0)\n  |> drop(columns: [\"_start\",\"_stop\",\"msgFrom\",\"_measurement\"])\n\nmeterStop = from(bucket: \"OCPP\")\n  |> range(start: -2d)\n  |> filter(fn: (r) => r[\"_measurement\"] == \"Transaction\")\n  |> filter(fn: (r) => r[\"_field\"] == \"transactionId\" or r[\"_field\"] == \"meterStop\")\n  |> filter(fn: (r) => r.command == \"StopTransaction\")\n  |> pivot(columnKey: [\"_field\"], rowKey: [\"_time\"], valueColumn: \"_value\")\n  |> filter(fn: (r) => r.transactionId != 0)\n  |> drop(columns: [\"_start\",\"_stop\",\"msgFrom\",\"_measurement\"])\n\njoin(tables: {key1: meterStart, key2: meterStop}, on: [\"transactionId\"], method: \"inner\")\n|> map(fn: (r) => ({ r with totalEnergy: r.meterStop - r.meterStart}))\n|> map(fn: (r) => ({ r with difference_seconds: (uint( v: r._time_key2) - uint( v: r._time_key1)) / uint(v: 1000000000) }))\n\n`\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 440,
        "wires": [
            [
                "e227df7e261ca442"
            ]
        ]
    },
    {
        "id": "e227df7e261ca442",
        "type": "influxdb in",
        "z": "92d055a5ecbac90c",
        "influxdb": "7cb40fcee206391e",
        "name": "",
        "query": "${CIPIO_INFLUX_TOKEN}",
        "rawOutput": false,
        "precision": "",
        "retentionPolicy": "",
        "org": "cipio",
        "x": 570,
        "y": 440,
        "wires": [
            [
                "632ee4461df6dec4"
            ]
        ]
    },
    {
        "id": "f8ba7f2f6416f7ca",
        "type": "inject",
        "z": "92d055a5ecbac90c",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 165,
        "y": 440,
        "wires": [
            [
                "4e88cb3fee82d891"
            ]
        ],
        "l": false
    },
    {
        "id": "632ee4461df6dec4",
        "type": "debug",
        "z": "92d055a5ecbac90c",
        "name": "debug 66",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 800,
        "y": 440,
        "wires": []
    },
    {
        "id": "fc4d9666fe59b41b",
        "type": "ui-text",
        "z": "92d055a5ecbac90c",
        "group": "530fe8d240942ac0",
        "order": 2,
        "width": "2",
        "height": "1",
        "name": "",
        "label": "Tx Today:  ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "style": true,
        "font": "",
        "fontSize": "22",
        "color": "#490481",
        "wrapText": false,
        "className": "",
        "x": 920,
        "y": 620,
        "wires": []
    },
    {
        "id": "86c44caadc208afb",
        "type": "ui-text",
        "z": "92d055a5ecbac90c",
        "group": "530fe8d240942ac0",
        "order": 1,
        "width": "2",
        "height": "1",
        "name": "",
        "label": "Active Tx:  ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "style": true,
        "font": "",
        "fontSize": "22",
        "color": "#490481",
        "wrapText": false,
        "className": "",
        "x": 580,
        "y": 580,
        "wires": []
    },
    {
        "id": "dc8ebffcfc3e5ce0",
        "type": "ui-text",
        "z": "92d055a5ecbac90c",
        "group": "530fe8d240942ac0",
        "order": 4,
        "width": "2",
        "height": "1",
        "name": "",
        "label": "Energy Today:  ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "style": true,
        "font": "",
        "fontSize": "22",
        "color": "#068104",
        "wrapText": false,
        "className": "",
        "x": 940,
        "y": 720,
        "wires": []
    },
    {
        "id": "5b67ef06c0cafdd5",
        "type": "ui-text",
        "z": "92d055a5ecbac90c",
        "group": "530fe8d240942ac0",
        "order": 5,
        "width": "2",
        "height": "1",
        "name": "",
        "label": "Energy (7 Days):  ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "style": true,
        "font": "",
        "fontSize": "22",
        "color": "#068104",
        "wrapText": false,
        "className": "",
        "x": 1070,
        "y": 840,
        "wires": []
    },
    {
        "id": "3c5eb5272e0500f6",
        "type": "ui-text",
        "z": "92d055a5ecbac90c",
        "group": "530fe8d240942ac0",
        "order": 6,
        "width": "2",
        "height": "1",
        "name": "",
        "label": "Limit:  ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "style": true,
        "font": "",
        "fontSize": "22",
        "color": "#068104",
        "wrapText": false,
        "className": "",
        "x": 910,
        "y": 760,
        "wires": []
    },
    {
        "id": "82f2206a8bad6087",
        "type": "ui-text",
        "z": "92d055a5ecbac90c",
        "group": "530fe8d240942ac0",
        "order": 3,
        "width": "2",
        "height": "1",
        "name": "",
        "label": "Tx (7 Days):  ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "style": true,
        "font": "",
        "fontSize": "22",
        "color": "#490481",
        "wrapText": false,
        "className": "",
        "x": 930,
        "y": 660,
        "wires": []
    },
    {
        "id": "67c26650958b4c02",
        "type": "ui-text",
        "z": "92d055a5ecbac90c",
        "d": true,
        "group": "530fe8d240942ac0",
        "order": 7,
        "width": "2",
        "height": "1",
        "name": "",
        "label": "Current Load:  ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "style": true,
        "font": "",
        "fontSize": "22",
        "color": "#068104",
        "wrapText": false,
        "className": "",
        "x": 600,
        "y": 800,
        "wires": []
    },
    {
        "id": "0256c52788664639",
        "type": "ui-notification",
        "z": "92d055a5ecbac90c",
        "ui": "8cdc313c9611f13f",
        "position": "top right",
        "colorDefault": false,
        "color": "#4b24d6",
        "displayTime": "5",
        "showCountdown": true,
        "outputs": 1,
        "allowDismiss": true,
        "dismissText": "Close",
        "allowConfirm": false,
        "confirmText": "Confirm",
        "raw": true,
        "className": "",
        "name": "",
        "x": 390,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "05b1553fcabcbc8b",
        "type": "link in",
        "z": "92d055a5ecbac90c",
        "name": "Tx Notification",
        "links": [
            "dd9016feeab69f8a"
        ],
        "x": 245,
        "y": 540,
        "wires": [
            [
                "0256c52788664639"
            ]
        ]
    },
    {
        "id": "a81b9fb52754cfc9",
        "type": "inject",
        "z": "92d055a5ecbac90c",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "10",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "8",
        "payloadType": "str",
        "x": 230,
        "y": 620,
        "wires": [
            [
                "3c1e11c8ed086779",
                "cae50a9e566c31a2"
            ]
        ]
    },
    {
        "id": "a6da137cccf7aed8",
        "type": "inject",
        "z": "92d055a5ecbac90c",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "2",
        "payloadType": "str",
        "x": 230,
        "y": 580,
        "wires": [
            [
                "f874cc3bd44a0208"
            ]
        ]
    },
    {
        "id": "8dfd14d0c2d79980",
        "type": "inject",
        "z": "92d055a5ecbac90c",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "400 kWh",
        "payloadType": "str",
        "x": 220,
        "y": 720,
        "wires": [
            [
                "60e4d09450fdac13"
            ]
        ]
    },
    {
        "id": "f803a977c0eea8b2",
        "type": "inject",
        "z": "92d055a5ecbac90c",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "3200 kWh",
        "payloadType": "str",
        "x": 200,
        "y": 840,
        "wires": [
            [
                "7bf24886ffe6be85"
            ]
        ]
    },
    {
        "id": "10cd57b6e514e458",
        "type": "inject",
        "z": "92d055a5ecbac90c",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "SITE:LoadLimit",
        "payloadType": "global",
        "x": 250,
        "y": 760,
        "wires": [
            [
                "58602cbda0a10753"
            ]
        ]
    },
    {
        "id": "4d2028a35bb0c9a4",
        "type": "inject",
        "z": "92d055a5ecbac90c",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "40 Amps",
        "payloadType": "str",
        "x": 220,
        "y": 800,
        "wires": [
            [
                "67c26650958b4c02"
            ]
        ]
    },
    {
        "id": "a96ec32fd158cdc3",
        "type": "inject",
        "z": "92d055a5ecbac90c",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": true,
        "onceDelay": "0.5",
        "topic": "",
        "x": 165,
        "y": 240,
        "wires": [
            [
                "445e1fd97be6944e"
            ]
        ],
        "l": false
    },
    {
        "id": "445e1fd97be6944e",
        "type": "change",
        "z": "92d055a5ecbac90c",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "payload.banner_url",
                "pt": "msg",
                "to": "CSMS:BannerURL",
                "tot": "global"
            },
            {
                "t": "set",
                "p": "payload.show",
                "pt": "msg",
                "to": "CSMS:ShowBanner",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 370,
        "y": 240,
        "wires": [
            [
                "af38625e0eb46e1a",
                "b63fd5d1f402a2bf"
            ]
        ]
    },
    {
        "id": "b63fd5d1f402a2bf",
        "type": "debug",
        "z": "92d055a5ecbac90c",
        "name": "debug 75",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 580,
        "y": 280,
        "wires": []
    },
    {
        "id": "f4cb836a36b77b75",
        "type": "link in",
        "z": "92d055a5ecbac90c",
        "name": "Update Banner",
        "links": [
            "4f2eb882456520c0"
        ],
        "x": 185,
        "y": 180,
        "wires": [
            [
                "445e1fd97be6944e",
                "082f57bbbfa35a38"
            ]
        ]
    },
    {
        "id": "f874cc3bd44a0208",
        "type": "function",
        "z": "92d055a5ecbac90c",
        "name": "function 27",
        "func": "let sess = global.get(\"CSMS:SESSIONS\") || []\nmsg = {\n    payload: sess.length\n}\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 580,
        "wires": [
            [
                "86c44caadc208afb"
            ]
        ]
    },
    {
        "id": "3c1e11c8ed086779",
        "type": "function",
        "z": "92d055a5ecbac90c",
        "name": "function 28",
        "func": "function getMidnightISODateInCurrentTimezone() {\n  const now = new Date();\n\n  // Get the year, month, and day in the current timezone\n  const year = now.getFullYear();\n  const month = now.getMonth();\n  const day = now.getDate();\n\n  // Create a new Date object representing midnight in the current timezone\n  const midnight = new Date(year, month, day);\n\n  // Convert to ISO string.  The important part here is using toISOString() which\n  // handles the timezone conversion for you automatically.\n  return midnight.toISOString();\n}\n\nlet start = getMidnightISODateInCurrentTimezone()\nlet query = `\nfrom(bucket: \"OCPP\")\n  |> range(start: ${start} )\n  |> filter(fn: (r) => r[\"_measurement\"] == \"Transaction\")\n  |> filter(fn: (r) => r._field == \"transactionId\" and r._value != 0)\n  |> group()\n  |> count(column: \"_value\")\n`\nmsg = {\n  query\n}\nreturn msg;\n\n\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 620,
        "wires": [
            [
                "cea3bc92b15fb35f"
            ]
        ]
    },
    {
        "id": "cea3bc92b15fb35f",
        "type": "influxdb in",
        "z": "92d055a5ecbac90c",
        "influxdb": "7cb40fcee206391e",
        "name": "",
        "query": "",
        "rawOutput": false,
        "precision": "",
        "retentionPolicy": "",
        "org": "cipio",
        "x": 560,
        "y": 620,
        "wires": [
            [
                "9cb30a86aa7a3db5"
            ]
        ]
    },
    {
        "id": "9cb30a86aa7a3db5",
        "type": "function",
        "z": "92d055a5ecbac90c",
        "name": "function 29",
        "func": "let count = 0\ncount = msg?.payload[0]?._value || 0\n\nmsg = {\n    payload: count\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 620,
        "wires": [
            [
                "fc4d9666fe59b41b"
            ]
        ]
    },
    {
        "id": "cae50a9e566c31a2",
        "type": "function",
        "z": "92d055a5ecbac90c",
        "name": "function 30",
        "func": "function getMidnightISODateSevenDaysAgo() {\n  const now = new Date();\n\n  // Calculate the date 7 days ago\n  const sevenDaysAgo = new Date(now);\n  sevenDaysAgo.setDate(now.getDate() - 7);\n\n  // Extract year, month, and day from the date 7 days ago\n  const year = sevenDaysAgo.getFullYear();\n  const month = sevenDaysAgo.getMonth();\n  const day = sevenDaysAgo.getDate();\n\n  // Create a new Date object representing midnight 7 days ago\n  const midnightSevenDaysAgo = new Date(year, month, day);\n\n  return midnightSevenDaysAgo.toISOString();\n}\n\nlet start = getMidnightISODateSevenDaysAgo()\nlet query = `\nfrom(bucket: \"OCPP\")\n  |> range(start: ${start} )\n  |> filter(fn: (r) => r[\"_measurement\"] == \"Transaction\")\n  |> filter(fn: (r) => r._field == \"transactionId\" and r._value != 0)\n  |> group()\n  |> count(column: \"_value\")\n`\nmsg = {\n  query\n}\nreturn msg;\n\n\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 660,
        "wires": [
            [
                "83c828f165ecf5af"
            ]
        ]
    },
    {
        "id": "83c828f165ecf5af",
        "type": "influxdb in",
        "z": "92d055a5ecbac90c",
        "influxdb": "7cb40fcee206391e",
        "name": "",
        "query": "",
        "rawOutput": false,
        "precision": "",
        "retentionPolicy": "",
        "org": "cipio",
        "x": 560,
        "y": 660,
        "wires": [
            [
                "d56bc41c9ec2b1f8"
            ]
        ]
    },
    {
        "id": "d56bc41c9ec2b1f8",
        "type": "function",
        "z": "92d055a5ecbac90c",
        "name": "function 31",
        "func": "let count = 0\ncount = msg?.payload[0]?._value || 0\n\nmsg = {\n    payload: count\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 660,
        "wires": [
            [
                "82f2206a8bad6087"
            ]
        ]
    },
    {
        "id": "60e4d09450fdac13",
        "type": "function",
        "z": "92d055a5ecbac90c",
        "name": "function 32",
        "func": "function getMidnightISODateInCurrentTimezone() {\n  const now = new Date();\n\n  // Get the year, month, and day in the current timezone\n  const year = now.getFullYear();\n  const month = now.getMonth();\n  const day = now.getDate();\n\n  // Create a new Date object representing midnight in the current timezone\n  const midnight = new Date(year, month, day);\n\n  // Convert to ISO string.  The important part here is using toISOString() which\n  // handles the timezone conversion for you automatically.\n  return midnight.toISOString();\n}\n\nlet start = getMidnightISODateInCurrentTimezone()\n\nlet query = `\nimport \"join\"\n\nstopTx = from(bucket: \"OCPP\")\n  |> range(start: ${start})\n  |> filter(fn: (r) => r[\"_measurement\"] == \"Transaction\")\n  |> filter(fn: (r) => r.command == \"StopTransaction\")\n  |> pivot(columnKey: [\"_field\"], rowKey: [\"_time\"], valueColumn: \"_value\")\n  |> keep(columns: [\"_cbId\", \"meterStop\",\"meterStart\",\"transactionId\"])\n  |> filter(fn: (r) => r.transactionId != 0)\n\nstartTx = from(bucket: \"OCPP\")\n  |> range(start: ${start})\n  |> filter(fn: (r) => r[\"_measurement\"] == \"Transaction\")\n  |> filter(fn: (r) => r.command == \"StartTransaction\")\n  |> pivot(columnKey: [\"_field\"], rowKey: [\"_time\"], valueColumn: \"_value\")\n  |> keep(columns: [\"_cbId\", \"meterStop\",\"meterStart\",\"transactionId\"])\n  |> filter(fn: (r) => r.transactionId != 0)\n\n\njoin.inner(left: stopTx, right: startTx, on: (l, r) => l.transactionId == r.transactionId, as: (l, r) => { return {transactionId: l.transactionId, meterStop: l.meterStop, meterStart: r.meterStart, meter: l.meterStop - r.meterStart}})\n\n`\nmsg = {\n  query\n}\nreturn msg;\n\n\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 720,
        "wires": [
            [
                "e1d6e963d03a9dab"
            ]
        ]
    },
    {
        "id": "e1d6e963d03a9dab",
        "type": "influxdb in",
        "z": "92d055a5ecbac90c",
        "influxdb": "7cb40fcee206391e",
        "name": "",
        "query": "",
        "rawOutput": false,
        "precision": "",
        "retentionPolicy": "",
        "org": "cipio",
        "x": 560,
        "y": 720,
        "wires": [
            [
                "75601251f82f3089"
            ]
        ]
    },
    {
        "id": "75601251f82f3089",
        "type": "function",
        "z": "92d055a5ecbac90c",
        "name": "function 33",
        "func": "const sum = msg.payload.reduce((accumulator, currentValue) => {\n  return accumulator + currentValue.meter;\n}, 0); // 0 is the initial value of the accumulator\n\n\n//let count = 0\n//count = msg?.payload[0]?._value || 0\n\nmsg = {\n    payload: `${sum} Wh`\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 720,
        "wires": [
            [
                "dc8ebffcfc3e5ce0"
            ]
        ]
    },
    {
        "id": "7bf24886ffe6be85",
        "type": "function",
        "z": "92d055a5ecbac90c",
        "name": "function 34",
        "func": "function getMidnightISODateSevenDaysAgo() {\n  const now = new Date();\n\n  // Calculate the date 7 days ago\n  const sevenDaysAgo = new Date(now);\n  sevenDaysAgo.setDate(now.getDate() - 7);\n\n  // Extract year, month, and day from the date 7 days ago\n  const year = sevenDaysAgo.getFullYear();\n  const month = sevenDaysAgo.getMonth();\n  const day = sevenDaysAgo.getDate();\n\n  // Create a new Date object representing midnight 7 days ago\n  const midnightSevenDaysAgo = new Date(year, month, day);\n\n  return midnightSevenDaysAgo.toISOString();\n}\n\nlet start = getMidnightISODateSevenDaysAgo()\n\nlet query = `\nimport \"join\"\n\nstopTx = from(bucket: \"OCPP\")\n  |> range(start: ${start})\n  |> filter(fn: (r) => r[\"_measurement\"] == \"Transaction\")\n  |> filter(fn: (r) => r.command == \"StopTransaction\")\n  |> pivot(columnKey: [\"_field\"], rowKey: [\"_time\"], valueColumn: \"_value\")\n  |> keep(columns: [\"_cbId\", \"meterStop\",\"meterStart\",\"transactionId\"])\n  |> filter(fn: (r) => r.transactionId != 0)\n\nstartTx = from(bucket: \"OCPP\")\n  |> range(start: ${start})\n  |> filter(fn: (r) => r[\"_measurement\"] == \"Transaction\")\n  |> filter(fn: (r) => r.command == \"StartTransaction\")\n  |> pivot(columnKey: [\"_field\"], rowKey: [\"_time\"], valueColumn: \"_value\")\n  |> keep(columns: [\"_cbId\", \"meterStop\",\"meterStart\",\"transactionId\"])\n  |> filter(fn: (r) => r.transactionId != 0)\n\n\njoin.inner(left: stopTx, right: startTx, on: (l, r) => l.transactionId == r.transactionId, as: (l, r) => { return {transactionId: l.transactionId, meterStop: l.meterStop, meterStart: r.meterStart, meter: l.meterStop - r.meterStart}})\n\n  \n`\nmsg = {\n  query\n}\nreturn msg;\n\n\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 840,
        "wires": [
            [
                "5ead2fdeaf4adffc"
            ]
        ]
    },
    {
        "id": "5ead2fdeaf4adffc",
        "type": "influxdb in",
        "z": "92d055a5ecbac90c",
        "influxdb": "7cb40fcee206391e",
        "name": "",
        "query": "",
        "rawOutput": false,
        "precision": "",
        "retentionPolicy": "",
        "org": "cipio",
        "x": 600,
        "y": 840,
        "wires": [
            [
                "bac3ee121d202814"
            ]
        ]
    },
    {
        "id": "bac3ee121d202814",
        "type": "function",
        "z": "92d055a5ecbac90c",
        "name": "function 35",
        "func": "const sum = msg.payload.reduce((accumulator, currentValue) => {\n  return accumulator + currentValue.meter;\n}, 0); // 0 is the initial value of the accumulator\n\n\n//let count = 0\n//count = msg?.payload[0]?._value || 0\n\nmsg = {\n    payload: `${sum} Wh`\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 840,
        "wires": [
            [
                "5b67ef06c0cafdd5"
            ]
        ]
    },
    {
        "id": "58602cbda0a10753",
        "type": "function",
        "z": "92d055a5ecbac90c",
        "name": "function 36",
        "func": "msg.payload = `${msg.payload} Amps`\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 730,
        "y": 760,
        "wires": [
            [
                "3c5eb5272e0500f6"
            ]
        ]
    },
    {
        "id": "c32e966c78977a1f",
        "type": "ui-template",
        "z": "92d055a5ecbac90c",
        "group": "195e75b71683482a",
        "page": "",
        "ui": "",
        "name": "",
        "order": 1,
        "width": "6",
        "height": "8",
        "head": "",
        "format": "<template>\n\n    <div>\n        <iframe src=\"/worldmap\" height=\"100%\" width=\"100%\"></iframe>\n    </div>\n \n</template>\n\n",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 540,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "f15e121d9ddb12b7",
        "type": "ui-control",
        "z": "92d055a5ecbac90c",
        "name": "",
        "ui": "8cdc313c9611f13f",
        "events": "all",
        "x": 720,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "be8623c98e1d303d",
        "type": "link in",
        "z": "92d055a5ecbac90c",
        "name": "CL_Home_UIControl",
        "links": [
            "f9d9242f3c2bf8b4"
        ],
        "x": 605,
        "y": 180,
        "wires": [
            [
                "f15e121d9ddb12b7"
            ]
        ]
    },
    {
        "id": "082f57bbbfa35a38",
        "type": "function",
        "z": "92d055a5ecbac90c",
        "name": "Show/Hide Map/Banner",
        "func": "let showMap = global.get(\"CSMS:ShowMap\")\nlet showBanner = global.get(\"CSMS:ShowBanner\")\nlet showPwrGraph = global.get(\"CSMS:ShowPowerGraph\")\nlet showCntGraph = global.get(\"CSMS:ShowCurrentGraph\")\n\n// This set a boolean default if global context is undefined\nshowMap = (showMap === undefined) ? true : showMap\nshowBanner = (showBanner === undefined) ? true : showBanner\nshowPwrGraph = (showPwrGraph === undefined) ? true : showPwrGraph\nshowCntGraph = (showCntGraph === undefined) ? true : showCntGraph\n\nlet display = {\n    \"groups\": {\n        \"hide\": [\n        ],\n        \"show\": [\n        ]\n    }\n}\n\nif (showMap) {\n    display.groups.show.push(\"Home:Map\")\n}\nelse {\n    display.groups.hide.push(\"Home:Map\")\n}\n\nif (showBanner) {\n    display.groups.show.push(\"Home:Banner\")\n}\nelse {\n    display.groups.hide.push(\"Home:Banner\")\n}\n\nif (showCntGraph) {\n    display.groups.show.push(\"Home:Current Graph\")\n}\nelse {\n    display.groups.hide.push(\"Home:Current Graph\")\n}\n\nif (showPwrGraph) {\n    display.groups.show.push(\"Home:Power Graph\")\n}\nelse {\n    display.groups.hide.push(\"Home:Power Graph\")\n}\nmsg = {}\nmsg.payload = display\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 180,
        "wires": [
            [
                "f9d9242f3c2bf8b4",
                "219975580bbca010"
            ]
        ]
    },
    {
        "id": "f9d9242f3c2bf8b4",
        "type": "link out",
        "z": "92d055a5ecbac90c",
        "name": "link out 40",
        "mode": "link",
        "links": [
            "be8623c98e1d303d"
        ],
        "x": 545,
        "y": 180,
        "wires": []
    },
    {
        "id": "eae926fb8f46e23c",
        "type": "inject",
        "z": "92d055a5ecbac90c",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "3",
        "crontab": "",
        "once": true,
        "onceDelay": "0.5",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 155,
        "y": 1100,
        "wires": [
            [
                "a6e5cdd91da413a1"
            ]
        ],
        "l": false
    },
    {
        "id": "b1d8871ec67a310f",
        "type": "influxdb in",
        "z": "92d055a5ecbac90c",
        "influxdb": "7cb40fcee206391e",
        "name": "",
        "query": "",
        "rawOutput": false,
        "precision": "",
        "retentionPolicy": "",
        "org": "cipio",
        "x": 640,
        "y": 1100,
        "wires": [
            [
                "25ff9cd1197d0a85"
            ]
        ]
    },
    {
        "id": "89ae70ba92a6beec",
        "type": "function",
        "z": "92d055a5ecbac90c",
        "name": "FLUX Get raw MV OCPP",
        "func": "// clear out any incoming message for now.\nlet filter_by_tx = \"\";\nlet topic = \"00000000\"\n\n/*\nif (msg.payload.txId) {\n  filter_by_tx = `|> filter(fn: (r) => r[\"transactionId\"] == \"${msg.payload.txId}\")`\n  topic = msg.payload.txId\n}\n*/\n\nmsg = {}\n\nmsg.topic = topic\n\nlet window = global.get(\"CSMS:MVSampleInterval\") || 60\nlet measurand = \"PowerkW\"\n\nmsg.query = \n  `from(bucket: \"OCPP\") \n    |> range(start: -1h) \n    |> filter(fn: (r) => r[\"_measurement\"] == \"MeterValues\") \n    |> filter(fn: (r) => r[\"_field\"] == \"${measurand}\")\n    |> aggregateWindow(every: ${window}s, createEmpty: true, fn: mean)\n    |> sort(columns: [\"_time\"])`\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 1100,
        "wires": [
            [
                "b1d8871ec67a310f"
            ]
        ]
    },
    {
        "id": "0e5f5ef4d59a290f",
        "type": "debug",
        "z": "92d055a5ecbac90c",
        "name": "debug 5",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1000,
        "y": 1100,
        "wires": []
    },
    {
        "id": "25ff9cd1197d0a85",
        "type": "ui-template",
        "z": "92d055a5ecbac90c",
        "group": "588463f4dbc60e20",
        "page": "",
        "ui": "",
        "name": "ChartJS Power",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n    <canvas ref=\"chart\" />\n</template>\n\n<script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\n\n<script>\n    export default {\n        mounted() {\n            // register a listener for incoming data\n            this.$socket.on('msg-input:' + this.id, this.onInput)\n\n            // check with ChartJS has loaded\n            let interval = setInterval(() => {\n                if (window.Chart) {\n                    // clear the check for ChartJS\n                    clearInterval(interval);\n                    // draw our initial chart\n                    this.draw()\n                }\n            }, 100);\n        },\n        methods: {\n            draw () {\n                // get reference to the <canvas /> element\n                const ctx = this.$refs.chart\n                \n                // Render the chart\n                const chart = new Chart(ctx, {\n                    type: 'line',\n                    data: {\n                        datasets: [{\n                            label: \"\",  // label for the single line we'll render\n                            data: [\n                            ],            // start with no data\n                            fill: 1\n                        }]\n                    },\n                    options: {\n                        animation: false, // don't run the animation for incoming data\n                        responsive: true, // ensure we auto-resize the content\n                        scales: {\n                            x: {\n                                type: 'time' // in this example, we're rendering timestamps\n                            },\n                            y: {\n                                stacked: true\n                            }\n                        },\n                        parsing: {\n                            xAxisKey: 'time', // the property to render on the x-axis\n                            yAxisKey: 'value' // the property to render on the y-axis\n                        },\n                        plugins: {\n                            legend: {\n                                position: 'top',\n                            },\n                            title: {\n                                display: true,\n                                text: 'EVSE Power (kW)'\n                            }\n                        }   \n                    },\n                });\n                // make this available to all elements of the component\n                this.chart = chart\n            },\n            onInput (msg) {\n                this.chart.data.datasets = []\n                // this.chart.data.datasets[0].data = []\n                this.chart.update()\n             \n\n\n                msg.payload.forEach( ( mvItem ) => {\n                    let label = `${mvItem.cbId}:P${mvItem.connectorId}`\n                    let idx = this.chart.data.datasets.findIndex( (ds) => ds.label == label )\n\n                    if (idx == -1) { \n                        idx = this.chart.data.datasets.push( {label: label, data: [] } ) - 1\n                    }\n                    \n                    this.chart.data.datasets[idx].data.push({time: mvItem._time, value: mvItem._value}) \n                })\n                this.chart.update()  \n            }    \n            \n        }\n    }\n\n</script>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 820,
        "y": 1100,
        "wires": [
            [
                "0e5f5ef4d59a290f"
            ]
        ]
    },
    {
        "id": "219975580bbca010",
        "type": "debug",
        "z": "92d055a5ecbac90c",
        "name": "debug 3",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 570,
        "y": 140,
        "wires": []
    },
    {
        "id": "d8769e54fee991f9",
        "type": "switch",
        "z": "92d055a5ecbac90c",
        "name": "",
        "property": "CSMS:ShowCurrentGraph",
        "propertyType": "global",
        "rules": [
            {
                "t": "false"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 250,
        "y": 980,
        "wires": [
            [],
            [
                "f18b9979d2212d1b"
            ]
        ]
    },
    {
        "id": "a6e5cdd91da413a1",
        "type": "switch",
        "z": "92d055a5ecbac90c",
        "name": "",
        "property": "CSMS:ShowPowerGraph",
        "propertyType": "global",
        "rules": [
            {
                "t": "false"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 250,
        "y": 1100,
        "wires": [
            [],
            [
                "89ae70ba92a6beec"
            ]
        ]
    },
    {
        "id": "6e251da731f92cf5",
        "type": "ui-template",
        "z": "c40c5bcee8c850c1",
        "group": "605f98a93d6b516d",
        "page": "",
        "ui": "",
        "name": "Version",
        "order": 1,
        "width": "0",
        "height": "0",
        "head": "",
        "format": "<template>\n    <div>\n        <span class=\"ver\">{{ msg.payload }}</span>\n    </div>\n    \n</template>\n\n\n<style>\n    /* define any styles here - supports raw CSS */\n    .ver {\n        color: black;\n        font-size: 24pt;\n        font-weight: bold;\n    }\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 600,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "c9ffbdc573846444",
        "type": "ui-template",
        "z": "c40c5bcee8c850c1",
        "group": "ac3370e3a654aa16",
        "page": "",
        "ui": "",
        "name": "CSMS URL",
        "order": 1,
        "width": "0",
        "height": "0",
        "head": "",
        "format": "<template>\n    <p> Use the following path information to configure your Charge Point (EVSE) to this CIP.io-Link CSMS.</p>\n\n    <div class=\"url-div\">\n        <span class=\"url_protocol\">{{ protocol }}://</span><span class=\"url_host\">{{ host }}</span><span class=\"url_port\">:{{ port }}</span><span class=\"url_path\">{{ path }}</span>`\n    </div>\n\n    <i><span class=\"pn\">NOTE:</span>\n        <div  class=\"note-list\"> \n        <ul>\n            <li>Some EVSEs require that the charge point units name be appended to the URL. Some do this for you.</li>\n            <li>The IP address in the URL above was our best approximation of your host IP address. You may need want to verify the \n            correct IP address that is open to outside clients.</li>\n        </ul>\n        </div>\n</template>\n\n<script>\n    export default {\n        data() {\n            // define variables available component-wide\n            // (in <template> and component functions)\n            return {\n                port: '0000',\n                path: '/',\n                host: '<host ip address>',\n                protocol: 'ws'\n            }\n        },\n        computed: {\n            // automatically compute this variable\n            // whenever VueJS deems appropriate\n        },\n\n        mounted() {\n            this.$socket.on('msg-input:' + this.id, (msg) => {\n                if (this.msg.payload){\n                let payload = this.msg.payload\n                this.protocol = payload?.protocol\n                this.port = payload?.port\n                this.path = payload?.path\n                this.host = payload?.host\n                }\n                \n            })\n        },\n        unmounted() {\n            // code here when the component is removed from the Dashboard\n            // i.e. when the user navigates away from the page\n        }\n    }\n</script>\n<style>\n    /* define any styles here - supports raw CSS */\n    .my-class {\n        color: black;\n        font-weight: bold;\n        font-size: 12pt;\n    }\n    .url_port {\n        color: blue;\n        font-weight: bold;\n        font-size: 24pt;\n    }\n    .url_path {\n        color: green;\n        font-weight: bold;\n        font-size: 24pt;\n    }\n    .url_protocol {\n        color: black;\n        font-weight: bold;\n        font-size: 24pt;\n    }\n    .url_host {\n        color: gray;\n        font-weight: bold;\n        font-size: 24pt;\n    }\n    .url-div {\n        border-top: 2px dotted;\n        border-bottom: 2px dotted;\n        margin-bottom: 10px;\n        margin-top: 10px;\n    }\n    .note-list {\n        padding-left: 20px;\n    }\n    .pn {\n        background-color: #dddddd\n    }\n\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 610,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "65df7b6a49d5365f",
        "type": "ui-markdown",
        "z": "c40c5bcee8c850c1",
        "group": "2ce6757429420e3d",
        "name": "",
        "order": 1,
        "width": 0,
        "height": 0,
        "content": "# CIPio Link\n\n\n## Helpful Links\n\n[CIP.io-Link on Github.com](https://github.com/Argonne-National-Laboratory/CIP.io-Link)\n\n[Argonne National Laboratory](https://www.anl.gov/)\n\n[OCA - Open Charge Alliance](https://openchargealliance.org/)\n",
        "className": "",
        "x": 610,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "fc0e5b809ecb5458",
        "type": "function",
        "z": "c40c5bcee8c850c1",
        "name": "function 2",
        "func": "msg.payload = {\n    \"port\": env.get(\"CIPIO_CSMS_PORT\"),\n    \"path\": env.get(\"CIPIO_CSMS_PATH\"),\n    \"host\": env.get(\"CIPIO_LINK_HOST\"),\n    \"protocol\": \"ws\"\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 220,
        "wires": [
            [
                "c9ffbdc573846444"
            ]
        ]
    },
    {
        "id": "c288d79126df3afb",
        "type": "inject",
        "z": "c40c5bcee8c850c1",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 215,
        "y": 220,
        "wires": [
            [
                "fc0e5b809ecb5458"
            ]
        ],
        "l": false
    },
    {
        "id": "a6dfb0b3e19d4835",
        "type": "inject",
        "z": "c40c5bcee8c850c1",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "CIPIO_LINK_VER",
        "payloadType": "env",
        "x": 215,
        "y": 160,
        "wires": [
            [
                "6e251da731f92cf5"
            ]
        ],
        "l": false
    },
    {
        "id": "2bfb78731c486437",
        "type": "function",
        "z": "c40c5bcee8c850c1",
        "name": "function 4",
        "func": "let host_ip = env.get(\"CIPIO_LINK_HOST\")\nmsg.payload = host_ip\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 120,
        "wires": [
            [
                "6dc6cfc72601d0ca"
            ]
        ]
    },
    {
        "id": "f296120e9fb674ea",
        "type": "inject",
        "z": "c40c5bcee8c850c1",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 250,
        "y": 120,
        "wires": [
            [
                "2bfb78731c486437"
            ]
        ]
    },
    {
        "id": "6dc6cfc72601d0ca",
        "type": "ui-template",
        "z": "c40c5bcee8c850c1",
        "group": "2ce6757429420e3d",
        "page": "",
        "ui": "",
        "name": "OtherURLs",
        "order": 2,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n    <div>\n        <h2>Other useful local links</h2>\n        <a :href=\"getURL(3000)\" target=\"_blank\">Grafana</a></br>\n        <a :href=\"getURL(8086)\" target=\"_blank\">Influx DB2 </a></br>\n        <a :href=\"getURL(9000)\" target=\"_blank\">Portainer</a></br>\n    </div>\n</template>\n\n<script>\n    export default {\n        data() {\n            // define variables available component-wide\n            // (in <template> and component functions)\n            return {\n                host: \"127.0.0.1\"\n            }\n        },\n        methods: {\n            getURL: function(port){\n                return `http://192.168.1.119:${port}`\n            }\n        },\n        mounted() {\n            this.$socket.on('msg-input:' + this.id, (msg) => {\n                if (this.msg.payload){\n                    this.host = this.msg.payload\n                }\n            })\n        },\n    }\n</script>\n<style>\n    /* define any styles here - supports raw CSS */\n    .my-class {\n        color: red;\n    }\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 610,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "30a87203640f65e9",
        "type": "change",
        "z": "bc469b88bbf8641e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "ui_update.label",
                "pt": "msg",
                "to": "Power",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "ui_update.units",
                "pt": "msg",
                "to": "payload.unit",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.value",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 410,
        "y": 180,
        "wires": [
            [
                "052b63807c6f06f5",
                "ebe2dabbd7922b2f"
            ]
        ]
    },
    {
        "id": "052b63807c6f06f5",
        "type": "ui-gauge",
        "z": "bc469b88bbf8641e",
        "name": "Power",
        "group": "6e1897c297826e17",
        "order": 3,
        "width": "2",
        "height": "2",
        "gtype": "gauge-half",
        "gstyle": "needle",
        "title": "gauge",
        "units": "units",
        "icon": "",
        "prefix": "",
        "suffix": "",
        "segments": [
            {
                "from": "0",
                "color": "#5cd65c"
            },
            {
                "from": "40",
                "color": "#ffc800"
            },
            {
                "from": "70",
                "color": "#ea5353"
            }
        ],
        "min": 0,
        "max": "100",
        "sizeThickness": 16,
        "sizeGap": 4,
        "sizeKeyThickness": 8,
        "styleRounded": true,
        "styleGlow": false,
        "className": "",
        "x": 600,
        "y": 180,
        "wires": []
    },
    {
        "id": "a23af9c49881279b",
        "type": "change",
        "z": "bc469b88bbf8641e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "ui_update.label",
                "pt": "msg",
                "to": "Current Avg",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "ui_update.units",
                "pt": "msg",
                "to": "payload.unit",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.value",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 410,
        "y": 240,
        "wires": [
            [
                "5e0ec18b139b701f",
                "8bd9e69af9df8320"
            ]
        ]
    },
    {
        "id": "5e0ec18b139b701f",
        "type": "ui-gauge",
        "z": "bc469b88bbf8641e",
        "name": "Current",
        "group": "6e1897c297826e17",
        "order": 2,
        "width": "2",
        "height": "2",
        "gtype": "gauge-half",
        "gstyle": "needle",
        "title": "gauge",
        "units": "units",
        "icon": "",
        "prefix": "",
        "suffix": "",
        "segments": [
            {
                "from": "0",
                "color": "#5cd65c"
            },
            {
                "from": "40",
                "color": "#ffc800"
            },
            {
                "from": "70",
                "color": "#ea5353"
            }
        ],
        "min": 0,
        "max": "100",
        "sizeThickness": 16,
        "sizeGap": 4,
        "sizeKeyThickness": 8,
        "styleRounded": true,
        "styleGlow": false,
        "className": "",
        "x": 610,
        "y": 260,
        "wires": []
    },
    {
        "id": "6b4469eeb0dfb68f",
        "type": "change",
        "z": "bc469b88bbf8641e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "ui_update.label",
                "pt": "msg",
                "to": "Energy",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "ui_update.units",
                "pt": "msg",
                "to": "payload.unit",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.value",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 410,
        "y": 360,
        "wires": [
            [
                "28c268ce8dcb9f74"
            ]
        ]
    },
    {
        "id": "b73ef1d774d2eacb",
        "type": "change",
        "z": "bc469b88bbf8641e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "ui_update.label",
                "pt": "msg",
                "to": "Voltage",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "ui_update.units",
                "pt": "msg",
                "to": "payload.unit",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.value",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 410,
        "y": 300,
        "wires": [
            [
                "ec562e26d7d3039f"
            ]
        ]
    },
    {
        "id": "ec562e26d7d3039f",
        "type": "ui-gauge",
        "z": "bc469b88bbf8641e",
        "name": "Voltage",
        "group": "6e1897c297826e17",
        "order": 1,
        "width": "2",
        "height": "2",
        "gtype": "gauge-half",
        "gstyle": "needle",
        "title": "gauge",
        "units": "units",
        "icon": "",
        "prefix": "",
        "suffix": "",
        "segments": [
            {
                "from": "0",
                "color": "#5cd65c"
            },
            {
                "from": "120",
                "color": "#ffae00"
            },
            {
                "from": "240",
                "color": "#09a8ec"
            },
            {
                "from": "1000",
                "color": "#eb04fb"
            }
        ],
        "min": 0,
        "max": "1000",
        "sizeThickness": 16,
        "sizeGap": 4,
        "sizeKeyThickness": 8,
        "styleRounded": true,
        "styleGlow": false,
        "className": "",
        "x": 610,
        "y": 300,
        "wires": []
    },
    {
        "id": "28c268ce8dcb9f74",
        "type": "ui-chart",
        "z": "bc469b88bbf8641e",
        "group": "6e1897c297826e17",
        "name": "Energy",
        "label": "chart",
        "order": 4,
        "chartType": "line",
        "category": "topic",
        "categoryType": "msg",
        "xAxisLabel": "",
        "xAxisProperty": "",
        "xAxisPropertyType": "timestamp",
        "xAxisType": "time",
        "xAxisFormat": "",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "kWh",
        "yAxisProperty": "payload",
        "yAxisPropertyType": "msg",
        "ymin": "",
        "ymax": "",
        "bins": 10,
        "action": "append",
        "stackSeries": false,
        "pointShape": "circle",
        "pointRadius": 4,
        "showLegend": true,
        "removeOlder": 1,
        "removeOlderUnit": "3600",
        "removeOlderPoints": "",
        "colors": [
            "#0095ff",
            "#ff0000",
            "#ff7f0e",
            "#2ca02c",
            "#a347e1",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#e5e5e5"
        ],
        "gridColorDefault": true,
        "width": "2",
        "height": "6",
        "className": "",
        "interpolation": "linear",
        "x": 610,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "ebe2dabbd7922b2f",
        "type": "ui-chart",
        "z": "bc469b88bbf8641e",
        "group": "6e1897c297826e17",
        "name": "Power",
        "label": "chart",
        "order": 6,
        "chartType": "line",
        "category": "topic",
        "categoryType": "msg",
        "xAxisLabel": "",
        "xAxisProperty": "",
        "xAxisPropertyType": "timestamp",
        "xAxisType": "time",
        "xAxisFormat": "",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "kWh",
        "yAxisProperty": "payload",
        "yAxisPropertyType": "msg",
        "ymin": "",
        "ymax": "",
        "bins": 10,
        "action": "append",
        "stackSeries": false,
        "pointShape": "circle",
        "pointRadius": 4,
        "showLegend": true,
        "removeOlder": 1,
        "removeOlderUnit": "3600",
        "removeOlderPoints": "",
        "colors": [
            "#0095ff",
            "#ff0000",
            "#ff7f0e",
            "#2ca02c",
            "#a347e1",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#e5e5e5"
        ],
        "gridColorDefault": true,
        "width": "2",
        "height": "6",
        "className": "",
        "interpolation": "linear",
        "x": 600,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "8bd9e69af9df8320",
        "type": "ui-chart",
        "z": "bc469b88bbf8641e",
        "group": "6e1897c297826e17",
        "name": "Current",
        "label": "chart",
        "order": 5,
        "chartType": "line",
        "category": "topic",
        "categoryType": "msg",
        "xAxisLabel": "",
        "xAxisProperty": "",
        "xAxisPropertyType": "timestamp",
        "xAxisType": "time",
        "xAxisFormat": "",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "kWh",
        "yAxisProperty": "payload",
        "yAxisPropertyType": "msg",
        "ymin": "",
        "ymax": "",
        "bins": 10,
        "action": "append",
        "stackSeries": false,
        "pointShape": "circle",
        "pointRadius": 4,
        "showLegend": true,
        "removeOlder": 1,
        "removeOlderUnit": "3600",
        "removeOlderPoints": "",
        "colors": [
            "#0095ff",
            "#ff0000",
            "#ff7f0e",
            "#2ca02c",
            "#a347e1",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#e5e5e5"
        ],
        "gridColorDefault": true,
        "width": "2",
        "height": "6",
        "className": "",
        "interpolation": "linear",
        "x": 610,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "93a107ec6406b8d5",
        "type": "comment",
        "z": "bc469b88bbf8641e",
        "name": "Click on me and see information in the [i] Info tab on the right",
        "info": "# Feeding the Meters Graphs \n\nThere are 3 meter graphs: **Power, Current, Voltage, and Energy**\nEach input expects an object that contains:\n```javascript\nmsg.payload = { unit: \"xyz\", value: 123 }\n```\n\nThe link-in nodes are as follows:\n\nPower = **CL_Meters_Power**\n\nEnergy = **CL_Meters_Current**\n\nVoltage = **CL_Meters_Voltage**\n\nEnergy = **CL_Meters_Energy**\n\nFeed the input from a Link-Out node on an editable flow of your own.",
        "x": 280,
        "y": 60,
        "wires": []
    },
    {
        "id": "9dfc8b6ab6145a89",
        "type": "link in",
        "z": "bc469b88bbf8641e",
        "name": "CL_Meters_Power",
        "links": [],
        "x": 170,
        "y": 180,
        "wires": [
            [
                "30a87203640f65e9"
            ]
        ],
        "l": true
    },
    {
        "id": "cb82afdd25e47653",
        "type": "link in",
        "z": "bc469b88bbf8641e",
        "name": "CL_Meters_Current",
        "links": [],
        "x": 170,
        "y": 240,
        "wires": [
            [
                "a23af9c49881279b"
            ]
        ],
        "l": true
    },
    {
        "id": "1014b40867ed836c",
        "type": "link in",
        "z": "bc469b88bbf8641e",
        "name": "CL_Meters_Voltage",
        "links": [],
        "x": 170,
        "y": 300,
        "wires": [
            [
                "b73ef1d774d2eacb"
            ]
        ],
        "l": true
    },
    {
        "id": "06f8927e12a27f82",
        "type": "link in",
        "z": "bc469b88bbf8641e",
        "name": "CL_Meters_Energy",
        "links": [],
        "x": 170,
        "y": 360,
        "wires": [
            [
                "6b4469eeb0dfb68f"
            ]
        ],
        "l": true
    },
    {
        "id": "beada0a7e53cb46a",
        "type": "link in",
        "z": "294f3520d49a4f00",
        "name": "log_ocpp",
        "links": [
            "846c6af009c205bd"
        ],
        "x": 135,
        "y": 160,
        "wires": [
            [
                "82c6ee1e7ebdc068",
                "05ced04ece9fd092"
            ]
        ]
    },
    {
        "id": "966a08ec9fe96bbc",
        "type": "influxdb out",
        "z": "294f3520d49a4f00",
        "influxdb": "7cb40fcee206391e",
        "name": "OCPP Log",
        "measurement": "",
        "precision": "",
        "retentionPolicy": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "cipio",
        "bucket": "ocpp_log",
        "x": 850,
        "y": 160,
        "wires": []
    },
    {
        "id": "82c6ee1e7ebdc068",
        "type": "function",
        "z": "294f3520d49a4f00",
        "name": "cmd, <res>, or error",
        "func": "\nlet influxTags = {\n    cbId: msg.cbId,\n    msgFrom: msg.msgFrom,\n}\n\nif (msg.payload[0] == 2){\n    influxTags.command = msg.payload[2]\n} else if (msg.payload[0] == 3) {\n    influxTags.command = '<response>'\n} else if (msg.payload[0] == 4) {\n    influxTags.command = '<ERROR>'\n}\n\nlet influxFields = {\n    time: new Date(msg.timestamp),\n    ocppMsg: JSON.stringify(msg.payload),\n    msgId: msg.payload[1]\n}\n\nmsg.measurement = 'ocpplog';\nmsg.payload = [influxFields,influxTags];\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 300,
        "y": 160,
        "wires": [
            [
                "ba42612f57a44fd4"
            ]
        ]
    },
    {
        "id": "4599c18a0badb5ba",
        "type": "debug",
        "z": "294f3520d49a4f00",
        "name": "debug 26",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload[2]",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 400,
        "y": 220,
        "wires": []
    },
    {
        "id": "258d81071dbe8925",
        "type": "debug",
        "z": "294f3520d49a4f00",
        "name": "debug 27",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 720,
        "y": 260,
        "wires": []
    },
    {
        "id": "22f189e825d297fe",
        "type": "influxdb in",
        "z": "294f3520d49a4f00",
        "influxdb": "7cb40fcee206391e",
        "name": "",
        "query": "",
        "rawOutput": false,
        "precision": "",
        "retentionPolicy": "",
        "org": "cipio",
        "x": 500,
        "y": 340,
        "wires": [
            [
                "61d8e489a269e5c7"
            ]
        ]
    },
    {
        "id": "f8c6aff29ab8c9df",
        "type": "debug",
        "z": "294f3520d49a4f00",
        "name": "debug 28",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 920,
        "y": 300,
        "wires": []
    },
    {
        "id": "09b04c7f9641599a",
        "type": "function",
        "z": "294f3520d49a4f00",
        "name": "FLUX Get raw OCPP",
        "func": "// clear out any incoming message for now.\n//msg = {}\n\nlet options = flow.get(\"options\") ?? {}\nlet showResp = options?.showResp ?? true \nlet showHB = options?.showHB ?? true\nlet start = options?.start ?? '-1h'\n\nmsg = {}\n\nlet showRespQry = (showResp == false) ? '|> filter(fn: (r) => r.command != \"<response>\")' : \"\"\nlet showHBQry = (showHB == false) ?  '|> filter(fn: (r) => r.command != \"Heartbeat\")' : \"\"\n\nmsg.showRespQry = showRespQry\nmsg.showResp = showResp\n\nmsg.query = \n  `from(bucket: \"ocpp_log\")\n    |> range(start: ${start})\n    |> filter(fn: (r) => r[\"_measurement\"] == \"ocpplog\")\n    |> pivot(columnKey: [\"_field\"], rowKey: [\"_time\"], valueColumn: \"_value\")\n    ${showRespQry}\n    ${showHBQry}\n    |> drop(columns: [\"_start\",\"_stop\",\"_mesaurement\"])\n    |> group(columns: [\"msgId\"])\n    |> sort(columns: [\"_time\"])`\n\n/*\n    `from(bucket: \"ocpp_log\")\n      |> range(start: -4d)\n      |> limit(n: 500)\n      |> filter(fn: (r) => r[\"_measurement\"] == \"ocpplog\")\n      |> filter(fn: (r) => r[\"_field\"] == \"ocppMsg\")\n      |> group()\n      |> sort(columns: [\"_time\"])\n      |> drop(columns: [\"table\",\"Result\",\"_measurement\",\"_stop\",\"_start\",\"_field\"])`\n*/\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 300,
        "y": 340,
        "wires": [
            [
                "22f189e825d297fe",
                "9625a45bb4b8737d"
            ]
        ]
    },
    {
        "id": "8aa8700b2f7344e6",
        "type": "inject",
        "z": "294f3520d49a4f00",
        "name": "Init Log",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 200,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "7d1c0e100d38e388",
        "type": "ui-template",
        "z": "294f3520d49a4f00",
        "group": "c187df53e1cacaad",
        "page": "",
        "ui": "",
        "name": "Log Table",
        "order": 2,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n    <v-text-field\n        v-model=\"search\"\n        label=\"Search\"\n        prepend-inner-icon=\"mdi-magnify\"\n        variant=\"outlined\"\n        clearable\n        hide-details\n        single-line\n        fixed-header\n      ></v-text-field>\n\n    <v-data-table  \n            v-model:search=\"search\"\n            v-model:sort-by=\"sortBy\"\n            :items=\"msg?.payload\"\n            :headers=\"headers\"\n            density=\"compact\"\n            :filter-keys='[\"command\",\"msgFrom\",\"cbId\",\"ocppMsg\"]'\n            >\n\n        <template v-slot:header._time>\n            <div class=\"headers\">Time</div>\n        </template>\n        <template v-slot:header.cbId>\n            <div class=\"headers\">CS</div>\n        </template>\n        <template v-slot:header.msgFrom>\n            <div class=\"headers\">Origin</div>\n        </template>\n        <template v-slot:header.command>\n            <div class=\"text-center headers\">CMD</div>\n        </template>\n        <!--template v-slot:header._value>\n            <div class=\"text-center headers\">OCPP Message</div>\n        </template -->\n\n        <template v-slot:item._time=\"{ item }\">\n            <div>{{ getLocalTimeString(item._time) }}</div>\n        </template>\n        <template v-slot:item.command=\"{ item }\">\n            <div :class=\"getOCPPCmdClass(item.command)\">{{ item.command }}</div>\n        </template>\n        <template v-slot:item.ocppMsg=\"{ item }\">\n            <div :class=\"getOCPPMsgClass(item.ocppMsg)\">{{ item.ocppMsg }}</div>\n        </template>\n    </v-data-table>\n</template>\n\n<script>\n    export default {\n        data() {\n            // define variables available component-wide\n            // (in <template> and component functions)\n            return {\n                search: '',\n                sortBy: [{ key: '_time', order: 'asc' }],\n                headers: [\n                    {title: \"Time\", value: \"_time\"},\n                    {title: \"Origin\", key: \"msgFrom\", sortable: false},\n                    {title: \"EVSE\", key: \"cbId\", sortable: false},\n                    {title: \"CMD\", key: \"command\", sortable: false},\n                    {title: \"OCPP Message\", key: \"ocppMsg\", sortable: false}\n                ]\n            }\n        },\n        watch: {\n            // watch for any changes of \"count\"\n\n        },\n        computed: {\n\n        },\n        methods: {\n            // expose a method to our <template> and Vue Application\n            getLocalTimeString: function (isoTime){\n                const date = new Date(isoTime)\n                const options = { \n                    year: '2-digit', \n                    month: '2-digit', \n                    day: '2-digit', \n                    hour: '2-digit', \n                    minute: '2-digit', \n                    second: '2-digit', \n                    millisecond: '3-digit',\n                    hour12: false \n                    }\n                return date.toLocaleString('en-US', options)\n            },\n            getOCPPMsgClass: function (item) {\n                let obj = JSON.parse(item);\n                return \"ocppMsgErr\";\n                if ( obj[0] == 2) {\n                    return \"ocppMsgReq\";\n                }\n                else if ( obj[0] == 3) {\n                    if ( Object.hasOwn(obj[2],\"status\")){\n                        return \"ocppMsgErr\";\n                    }\n                    return \"ocppMsgErr\";\n                }\n                else {\n                    return \"ocppMsgErr\";\n                }\n            },\n            getOCPPCmdClass: function (item) {\n                if (item.startsWith(\"<res\")) {\n                    return \"ocppCmdRes\";\n                }\n                else {\n                    return \"ocppCmdReq\";\n                }\n            }\n        },\n        mounted() {\n            // code here when the component is first loaded\n        },\n        unmounted() {\n            // code here when the component is removed from the Dashboard\n            // i.e. when the user navigates away from the page\n        }\n    }\n</script>\n<style>\n    /* define any styles here - supports raw CSS */\n    .my-class {\n        color: red;\n    }\n    .headers {\n        font-weight: bold;\n    }\n    .ocppMsgReq {\n        color: blue;\n        font-weight: bold;\n    }\n    .ocppMsgRes {\n        color: blue;\n    }\n    .ocppMsgErr {\n        color: red;\n    }\n    .ocppCmdReq {\n        color: green;\n        font-weight: bold;\n    }\n    .ocppCmdRes {\n        color: DarkCyan;\n    }\n</style>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 920,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "61d8e489a269e5c7",
        "type": "function",
        "z": "294f3520d49a4f00",
        "name": "FLUX remove extras",
        "func": "msg.payload.forEach(function(ocppMsg) {\n    delete ocppMsg.result;\n    delete ocppMsg.table;\n});\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 340,
        "wires": [
            [
                "7d1c0e100d38e388",
                "f8c6aff29ab8c9df"
            ]
        ]
    },
    {
        "id": "a032c7f04398d7d4",
        "type": "delay",
        "z": "294f3520d49a4f00",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 600,
        "y": 200,
        "wires": [
            [
                "fca2ef466dd35c31"
            ]
        ]
    },
    {
        "id": "24ec176038fe713d",
        "type": "influxdb out",
        "z": "294f3520d49a4f00",
        "influxdb": "7cb40fcee206391e",
        "name": "OCPP Bucket",
        "measurement": "",
        "precision": "",
        "retentionPolicy": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "cipio",
        "bucket": "OCPP",
        "x": 1340,
        "y": 120,
        "wires": []
    },
    {
        "id": "f3e1c99425a9c103",
        "type": "function",
        "z": "294f3520d49a4f00",
        "name": "Convert to Influx TS data",
        "func": "//TODO: Account for error type messages\n//\n\n// This copies the data portion of an OCPP message based on\n// the message type. A request has its data in the array at the\n// 4th position, so zero based that's [3]. We just calculate\n// that position based on the message type subtracted from 5.\n//\nconst measurements = {\n    BootNotification: \"BootNotification\",\n    StatusNotification: \"StatusNotification\",\n    Authorize: \"Authorize\",\n    StartTransactionEnhanced: \"Transaction\",\n    StopTransaction: \"Transaction\",\n    RemoteStartTransaction: \"Transaction\",\n    RemoteStopTransaction: \"Transaction\",\n    MeterValues: \"MeterValues\",\n    SetChargingProfile: \"ChargingProfile\"\n}\n\nif (!Object.hasOwn(measurements,msg.payload[1].command)) return\n\nlet idx = 5 - (JSON.parse(msg.payload[0]?.ocppMsg)[0])\n\nif (idx != 3) return;\n\nlet ocppJson = JSON.parse(msg.payload[0]?.ocppMsg)[idx]\ndelete msg.payload[0].ocppMsg\n\nmsg.measurement = measurements[msg.payload[1].command]\n\nif (msg.payload[1].command === \"StartTransactionEnhanced\"){\n    msg.payload[1].command = \"StartTransaction\"\n}\n\nlet merged = {...msg.payload[0],...ocppJson }\nmsg.payload[0] = merged\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 100,
        "wires": [
            [
                "96fa7c9ac4acc47f",
                "0fcf5938cf680373"
            ]
        ]
    },
    {
        "id": "687284eeeefc6094",
        "type": "switch",
        "z": "294f3520d49a4f00",
        "name": "Filter StartTxEnhanced",
        "property": "ocpp.command",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "StartTransactionEnhanced",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 640,
        "y": 160,
        "wires": [
            [
                "966a08ec9fe96bbc"
            ]
        ]
    },
    {
        "id": "6ec7f5c8fa255cf6",
        "type": "link in",
        "z": "294f3520d49a4f00",
        "name": "Refresh Log",
        "links": [
            "fca2ef466dd35c31"
        ],
        "x": 105,
        "y": 340,
        "wires": [
            [
                "09b04c7f9641599a"
            ]
        ]
    },
    {
        "id": "fca2ef466dd35c31",
        "type": "link out",
        "z": "294f3520d49a4f00",
        "name": "link out 19",
        "mode": "link",
        "links": [
            "6ec7f5c8fa255cf6"
        ],
        "x": 715,
        "y": 200,
        "wires": []
    },
    {
        "id": "96fa7c9ac4acc47f",
        "type": "debug",
        "z": "294f3520d49a4f00",
        "name": "debug 50",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 890,
        "y": 40,
        "wires": []
    },
    {
        "id": "05ced04ece9fd092",
        "type": "switch",
        "z": "294f3520d49a4f00",
        "name": "",
        "property": "msgFrom",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "CS",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 230,
        "y": 220,
        "wires": [
            [
                "4599c18a0badb5ba",
                "a17aef1dc7d51ba8"
            ]
        ]
    },
    {
        "id": "e7de0b7ea1e77e8e",
        "type": "switch",
        "z": "294f3520d49a4f00",
        "name": "",
        "property": "payload[1].command",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "MeterValues",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 590,
        "y": 260,
        "wires": [
            [
                "258d81071dbe8925"
            ]
        ]
    },
    {
        "id": "670bbc7e0e5a3e30",
        "type": "function",
        "z": "294f3520d49a4f00",
        "name": "MeterValues to Influx",
        "func": "let txid = msg.payload[0].transactionId || 0;\n\n// Some OCPP implementations continue to send M/V after a session has ended.\nif (txid === 0) return;\n\nmsg.measurement = 'MeterValues';\n\nlet influxFields = {};\n\nlet influxTags = { \n    connectorId: msg.payload[0].connectorId,\n    transactionId: msg.payload[0].transactionId,\n    cbId: msg.cbId,\n}\n\n// This will calculate the RMS value for multi-phase (or even a single phase)\n// current and voltage returns\n//\nfunction getRMSValue(measurementArray) {\n    let rtnVal = 0;\n    if (measurementArray.length > 0) {\n        let count = measurementArray.length;\n        let value = 0;\n        measurementArray.forEach(function (x) {\n            value += x ** 2;\n        });\n        rtnVal = Math.sqrt((value / count));\n    }\n    return rtnVal;\n}\n\nif (Array.isArray(msg.payload[0].meterValue)){\n    msg.payload[0].meterValue.forEach(doMeterValues);\n}\nelse {\n    doMeterValues(msg.payload[0].meterValue);\n}\n\nfunction doMeterValues(mv){\n    if (mv.hasOwnProperty('timestamp')){\n        influxFields.time = new Date(mv.timestamp);\n    } \n    // Use this for multiple phase units\n    let CurrentArray = [];\n    let VoltageArray = [];\n\n    mv.sampledValue.forEach(sv => {\n        let value = Number(sv.value);\n        let unit = sv.unit;\n        switch (sv.measurand){\n            case 'Energy.Active.Import.Register':\n                value = (unit[0] == 'k')? value : value / 1000;\n                influxFields.EnergykWh = Math.round(value * 100) / 100;\n                break;\n            case 'Energy.Active.Export.Register':\n                value = (unit[0] == 'k') ? value : value / 1000;\n                influxFields.EnergyExportkWh = Math.round(value * 100) / 100;\n                break;\n            case 'Power.Active.Import':\n                value = (unit[0] == 'k')? value : value / 1000;\n                influxFields.PowerkW = Math.round(value * 100) / 100;\n                break;\n            case 'Power.Active.Export':\n                value = (unit[0] == 'k') ? value : value / 1000;\n                influxFields.PowerExportkW = Math.round(value * 100) / 100;\n                break;\n            case 'Current.Import':\n                // Only add value to array if it isn't zero\n                if (value != 0) { CurrentArray.push(value); }\n                if (Object.hasOwn(sv,\"phase\")) {\n                    let prop = `CurrentA_${sv.phase}`;\n                    influxFields[prop] = value;\n                }\n                break;\n            case 'Current.Offered':\n                influxFields.CurrentOfferedA = value;\n                break;\n            case 'Current.Export':\n                    influxFields.CurrentExportA = value;\n                    break;\n            case 'Voltage':\n                if (value != 0) { VoltageArray.push(value); }\n                if (Object.hasOwn(sv, \"phase\")) {\n                    let prop = `VoltageV_${sv.phase}`;\n                    influxFields[prop] = value;\n                }\n                break;\n            case 'SoC':\n                influxFields.SoC = value;\n                break;\n            case 'RPM':\n                influxFields.RPM = value;\n            case 'Temperature':\n                influxFields.Temperature = value;\n            default:\n                break;\n        }\n    });\n\n    //This calculates the current RMS for multiple phases\n    influxFields.CurrentA = getRMSValue(CurrentArray);\n    influxFields.VoltageV = getRMSValue(VoltageArray);\n\n}\n\n// Next we verify that we have a power value since some (LiteOn/EVOCharge) EVSEs don't bother\n// to supply one. \nif (influxFields.hasOwnProperty('PowerkW') != true){\n    if (influxFields.hasOwnProperty('VoltageV') && influxFields.hasOwnProperty('CurrentA')){\n        influxFields.PowerkW = ((influxFields.VoltageV * influxFields.CurrentA / 1000) * 100) / 100;\n    }\n}\n\n\nmsg.payload = [influxFields, influxTags];\n\nreturn msg;\n\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 80,
        "wires": [
            [
                "24ec176038fe713d"
            ]
        ]
    },
    {
        "id": "0fcf5938cf680373",
        "type": "switch",
        "z": "294f3520d49a4f00",
        "name": "",
        "property": "measurement",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "MeterValues",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 910,
        "y": 100,
        "wires": [
            [
                "670bbc7e0e5a3e30",
                "5afb9cd944ed3a2a"
            ],
            [
                "24ec176038fe713d",
                "c8de40583c78dc49",
                "51d80e171b2eadaf"
            ]
        ]
    },
    {
        "id": "5afb9cd944ed3a2a",
        "type": "debug",
        "z": "294f3520d49a4f00",
        "name": "debug 53",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1070,
        "y": 40,
        "wires": []
    },
    {
        "id": "c8de40583c78dc49",
        "type": "switch",
        "z": "294f3520d49a4f00",
        "name": "",
        "property": "measurement",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Transaction",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "MeterValues",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "BootNotification",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Authorize",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 1140,
        "y": 220,
        "wires": [
            [
                "7a8e05f5d5a2e926"
            ],
            [
                "b30433a611efd29c"
            ],
            [],
            []
        ]
    },
    {
        "id": "7a8e05f5d5a2e926",
        "type": "link out",
        "z": "294f3520d49a4f00",
        "name": "link out 22",
        "mode": "link",
        "links": [
            "22993ff229d6db8d"
        ],
        "x": 1325,
        "y": 200,
        "wires": []
    },
    {
        "id": "b30433a611efd29c",
        "type": "link out",
        "z": "294f3520d49a4f00",
        "name": "link out 23",
        "mode": "link",
        "links": [
            "aa18045a070128d9"
        ],
        "x": 1325,
        "y": 240,
        "wires": []
    },
    {
        "id": "5fcf104321bf3b9e",
        "type": "function",
        "z": "294f3520d49a4f00",
        "name": "function 17",
        "func": "msg = {}\n\nmsg.query = `from(bucket: \"ocpp_log\") \\ \n    |> range(start: -1h) \\ \n    |> filter(fn: (r) => r[\"_measurement\"] == \"ocpplog\") \\\n    |> filter(fn: (r) => r[\"_field\"] == \"msgId\" or r[\"_field\"] == \"ocppMsg\") \\\n    |> group(columns: [\"_value\"]) \\\n    |> keep(columns: [\"_time\",\"cbId\",\"command\",\"msgFrom\",\"_value\"]) \\\n    |> sort(columns: [\"command\"], desc: true)`\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 680,
        "wires": [
            [
                "6d6e838673636f47"
            ]
        ]
    },
    {
        "id": "916e9cd9c4f8a11b",
        "type": "debug",
        "z": "294f3520d49a4f00",
        "name": "debug 54",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 680,
        "y": 680,
        "wires": []
    },
    {
        "id": "13437f1913f23438",
        "type": "inject",
        "z": "294f3520d49a4f00",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 140,
        "y": 680,
        "wires": [
            [
                "5fcf104321bf3b9e"
            ]
        ]
    },
    {
        "id": "6d6e838673636f47",
        "type": "influxdb in",
        "z": "294f3520d49a4f00",
        "influxdb": "7cb40fcee206391e",
        "name": "",
        "query": "",
        "rawOutput": false,
        "precision": "",
        "retentionPolicy": "",
        "org": "cipio",
        "x": 500,
        "y": 680,
        "wires": [
            [
                "916e9cd9c4f8a11b"
            ]
        ]
    },
    {
        "id": "29b7f0d602a2187a",
        "type": "debug",
        "z": "294f3520d49a4f00",
        "name": "debug 72",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 480,
        "y": 460,
        "wires": []
    },
    {
        "id": "fc974c9c771a2596",
        "type": "ui-template",
        "z": "294f3520d49a4f00",
        "group": "c187df53e1cacaad",
        "page": "",
        "ui": "",
        "name": "Log Options",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n\n      <v-toolbar flat>\n        \n        <v-toolbar-title class=\"text-grey\">\n            Options\n        </v-toolbar-title>\n\n        <v-spacer></v-spacer>\n            <v-template>\n            <v-switch \n                v-model=\"showResp\" \n                label=\"Responses\" \n                color=\"primary\"\n                >\n            </v-switch>\n            </v-template>\n            <v-spacer></v-spacer>\n            <v-template>\n            <v-switch \n                v-model=\"showHB\" \n                label=\"Heartbeats\" \n                color=\"primary\"\n                >\n            </v-switch>\n            </v-template>\n            <v-spacer></v-spacer>\n            <v-template>\n            <v-select\n                v-model=\"select\"\n                :items=\"startTimes\"\n                item-title=\"title\"\n                item-value=\"value\"\n                >\n            </v-select>\n            </v-template>\n\n      </v-toolbar>\n</template>\n\n<script>\n    export default {\n        data() {\n            // define variables available component-wide\n            // (in <template> and component functions)\n            return {\n                showResp: true,\n                showHB: true,\n                select: { title: \"past 5m\", value: '-5m'},\n                startTimes: [\n                    { title: \"past 1m\", value: '-1m'},\n                    { title: \"past 5m\", value: '-5m'},\n                    { title: \"past 15m\", value: '-15m'},\n                    { title: \"past 1h\", value: '-1h'},\n                    { title: \"past 3h\", value: '-3h'},\n                    { title: \"past 6h\", value: '-6h'},\n                    { title: \"past 12h\", value: '-12h'},\n                    { title: \"past 24h\", value: '-24h'},\n                    { title: \"past 2d\", value: '-2d'},\n                    { title: \"past 7d\", value: '-7d'},\n                    { title: \"past 30d\", value: '-30d'},\n                    { title: \"custom\", value: 'custom'}\n                    ]\n            }\n        },\n        watch: {\n            showHB(newValue) {\n                this.sendOptions()\n            },\n            showResp(newValue) {\n                this.sendOptions()\n            },\n            select(newValue) {\n                this.sendOptions()\n            }\n        },\n        methods: {\n            // expose a method to our <template> and Vue Application\n            sendOptions: function() {\n                this.send({ \n                    options: {\n                        showResp: this.showResp, \n                        showHB: this.showHB,\n                        start: this.select \n                    }\n                })\n            }\n        },\n        mounted() {\n            // code here when the component is first loaded\n        },\n        unmounted() {\n            // code here when the component is removed from the Dashboard\n            // i.e. when the user navigates away from the page\n        }\n    }\n</script>\n<style>\n    /* define any styles here - supports raw CSS */\n    .my-class {\n        color: red;\n    }\n</style>",
        "storeOutMessages": true,
        "passthru": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 270,
        "y": 460,
        "wires": [
            [
                "29b7f0d602a2187a",
                "05a3a30ace8bde17"
            ]
        ]
    },
    {
        "id": "9625a45bb4b8737d",
        "type": "debug",
        "z": "294f3520d49a4f00",
        "name": "debug 73",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 490,
        "y": 400,
        "wires": []
    },
    {
        "id": "05a3a30ace8bde17",
        "type": "change",
        "z": "294f3520d49a4f00",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "options",
                "pt": "flow",
                "to": "options",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 280,
        "y": 400,
        "wires": [
            [
                "09b04c7f9641599a"
            ]
        ]
    },
    {
        "id": "f5ee21688de2721a",
        "type": "inject",
        "z": "294f3520d49a4f00",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 580,
        "wires": [
            [
                "6721711cb29da7b6"
            ]
        ]
    },
    {
        "id": "6721711cb29da7b6",
        "type": "change",
        "z": "294f3520d49a4f00",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "options",
                "pt": "flow",
                "to": "{}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 310,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "a17aef1dc7d51ba8",
        "type": "switch",
        "z": "294f3520d49a4f00",
        "name": "",
        "property": "payload[2]",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "StartTransaction",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "StartTransactionEnhanced",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "StopTransaction",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 320,
        "y": 280,
        "wires": [
            [
                "0f4685282fcb972d"
            ],
            [
                "0f4685282fcb972d"
            ],
            [
                "0f4685282fcb972d"
            ]
        ]
    },
    {
        "id": "0f4685282fcb972d",
        "type": "debug",
        "z": "294f3520d49a4f00",
        "name": "debug 86",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 460,
        "y": 280,
        "wires": []
    },
    {
        "id": "93076343d978982d",
        "type": "debug",
        "z": "294f3520d49a4f00",
        "name": "debug 87",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1580,
        "y": 180,
        "wires": []
    },
    {
        "id": "51d80e171b2eadaf",
        "type": "switch",
        "z": "294f3520d49a4f00",
        "name": "",
        "property": "payload[1].command",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "StartTransaction",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "StopTransaction",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1410,
        "y": 180,
        "wires": [
            [
                "93076343d978982d"
            ],
            [
                "93076343d978982d"
            ]
        ]
    },
    {
        "id": "898f5d33416b458c",
        "type": "ui-number-input",
        "z": "c4f677cd277b409d",
        "group": "ace44af4012c4fc1",
        "name": "Heartbeat",
        "label": "Heartbeat Rate (seconds)",
        "order": 1,
        "width": 0,
        "height": 0,
        "topic": "heartbeat",
        "topicType": "msg",
        "min": 0,
        "max": "86400",
        "step": 1,
        "tooltip": "",
        "passthru": true,
        "sendOnBlur": true,
        "sendOnEnter": true,
        "className": "",
        "clearable": false,
        "icon": "mdi-heart-pulse",
        "iconPosition": "left",
        "iconInnerPosition": "inside",
        "spinner": "default",
        "x": 620,
        "y": 160,
        "wires": [
            [
                "ac08ee5853b84129"
            ]
        ]
    },
    {
        "id": "242a9e9f7655ccdb",
        "type": "redis-command",
        "z": "c4f677cd277b409d",
        "server": "0430675ed6c7cd83",
        "command": "SET",
        "name": "set heartbeat rate",
        "topic": "settings:evse:heartbeat_rate",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 1270,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "ac08ee5853b84129",
        "type": "function",
        "z": "c4f677cd277b409d",
        "name": "num2str",
        "func": "global.set(\"CSMS:HeartbeatInterval\", msg.payload)\nmsg.payload = `${msg.payload}`\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 160,
        "wires": [
            [
                "242a9e9f7655ccdb"
            ]
        ]
    },
    {
        "id": "7000f9956b23dcde",
        "type": "ui-number-input",
        "z": "c4f677cd277b409d",
        "group": "c48e064d37e64bbf",
        "name": "Site LoadLimit",
        "label": "Max Load Limit (Amps)",
        "order": 7,
        "width": 0,
        "height": 0,
        "topic": "heartbeat",
        "topicType": "msg",
        "min": 0,
        "max": "86400",
        "step": 1,
        "tooltip": "Set the maximum amperage limit to maintain for your all your EVSEs (adjusted for 20% under rating if necessary)",
        "passthru": true,
        "sendOnBlur": true,
        "sendOnEnter": true,
        "className": "",
        "clearable": false,
        "icon": "mdi-meter-electric-outline",
        "iconPosition": "left",
        "iconInnerPosition": "inside",
        "spinner": "default",
        "x": 640,
        "y": 220,
        "wires": [
            [
                "20dc0388748792d5"
            ]
        ]
    },
    {
        "id": "1e9fb8f4a3750ee5",
        "type": "redis-command",
        "z": "c4f677cd277b409d",
        "server": "0430675ed6c7cd83",
        "command": "SET",
        "name": "set site load limit",
        "topic": "settings:site:load_limit",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 1260,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "20dc0388748792d5",
        "type": "function",
        "z": "c4f677cd277b409d",
        "name": "num2str",
        "func": "global.set(\"SITE:LoadLimit\", msg.payload)\nmsg.payload = `${msg.payload}`\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 220,
        "wires": [
            [
                "1e9fb8f4a3750ee5"
            ]
        ]
    },
    {
        "id": "d59fede572569ae8",
        "type": "ui-switch",
        "z": "c4f677cd277b409d",
        "name": "FreeVend",
        "label": "FreeVend Mode",
        "group": "ace44af4012c4fc1",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": false,
        "topic": "topic",
        "topicType": "msg",
        "style": "",
        "className": "",
        "layout": "row-left-swapped",
        "clickableArea": "line",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "x": 620,
        "y": 280,
        "wires": [
            [
                "22b6392a92b7af5a"
            ]
        ]
    },
    {
        "id": "22b6392a92b7af5a",
        "type": "change",
        "z": "c4f677cd277b409d",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "CSMS:FreeVend",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 840,
        "y": 280,
        "wires": [
            [
                "119bc57be0dace1a"
            ]
        ]
    },
    {
        "id": "d7539d9175e7a289",
        "type": "redis-command",
        "z": "c4f677cd277b409d",
        "server": "0430675ed6c7cd83",
        "command": "SET",
        "name": "set FreeVend",
        "topic": "settings:site:free_vend",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 1250,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "119bc57be0dace1a",
        "type": "function",
        "z": "c4f677cd277b409d",
        "name": "bool2str",
        "func": "msg.payload = `${msg.payload}`\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 280,
        "wires": [
            [
                "d7539d9175e7a289"
            ]
        ]
    },
    {
        "id": "754e5e01d72b3fbd",
        "type": "redis-command",
        "z": "c4f677cd277b409d",
        "server": "0430675ed6c7cd83",
        "command": "GET",
        "name": "get heartbeat rate",
        "topic": "settings:evse:heartbeat_rate",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 290,
        "y": 160,
        "wires": [
            [
                "73913870b6bbee44"
            ]
        ]
    },
    {
        "id": "73913870b6bbee44",
        "type": "function",
        "z": "c4f677cd277b409d",
        "name": "str2num",
        "func": "if (msg?.payload){\n    msg.payload = Number(msg.payload)\n}\nelse {\n    msg.payload = 120\n}\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 160,
        "wires": [
            [
                "898f5d33416b458c"
            ]
        ]
    },
    {
        "id": "a7fd3a800d49469d",
        "type": "redis-command",
        "z": "c4f677cd277b409d",
        "server": "0430675ed6c7cd83",
        "command": "GET",
        "name": "set site load limit",
        "topic": "settings:site:load_limit",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 280,
        "y": 220,
        "wires": [
            [
                "d6ed3f773625f10c"
            ]
        ]
    },
    {
        "id": "d6ed3f773625f10c",
        "type": "function",
        "z": "c4f677cd277b409d",
        "name": "str2num",
        "func": "if (msg?.payload){\n    msg.payload = Number(msg.payload)\n}\nelse {\n    msg.payload = 100\n}\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 220,
        "wires": [
            [
                "7000f9956b23dcde"
            ]
        ]
    },
    {
        "id": "9a553400c62662a4",
        "type": "redis-command",
        "z": "c4f677cd277b409d",
        "server": "0430675ed6c7cd83",
        "command": "GET",
        "name": "get FreeVend",
        "topic": "settings:site:free_vend",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 280,
        "y": 280,
        "wires": [
            [
                "2b07e761244ab2ed"
            ]
        ]
    },
    {
        "id": "2b07e761244ab2ed",
        "type": "function",
        "z": "c4f677cd277b409d",
        "name": "str2bool",
        "func": "if (msg?.payload){\n    msg.payload = msg.payload == \"true\"\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 280,
        "wires": [
            [
                "d59fede572569ae8"
            ]
        ]
    },
    {
        "id": "47c4718f596acff4",
        "type": "inject",
        "z": "c4f677cd277b409d",
        "name": "Prime",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 250,
        "y": 100,
        "wires": [
            [
                "9460a6cb7347f787"
            ]
        ]
    },
    {
        "id": "fcba4c1e92563751",
        "type": "link in",
        "z": "c4f677cd277b409d",
        "name": "link in 1",
        "links": [
            "9460a6cb7347f787"
        ],
        "x": 65,
        "y": 300,
        "wires": [
            [
                "7738416e1b659cd6"
            ]
        ]
    },
    {
        "id": "9460a6cb7347f787",
        "type": "link out",
        "z": "c4f677cd277b409d",
        "name": "link out 20",
        "mode": "link",
        "links": [
            "fcba4c1e92563751"
        ],
        "x": 345,
        "y": 100,
        "wires": []
    },
    {
        "id": "6bdcde6369d7a4b4",
        "type": "redis-command",
        "z": "c4f677cd277b409d",
        "server": "0430675ed6c7cd83",
        "command": "GET",
        "name": "get ShowBanner",
        "topic": "settings:site:show_banner",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 290,
        "y": 340,
        "wires": [
            [
                "d9da991ba26f4cb9"
            ]
        ]
    },
    {
        "id": "d9da991ba26f4cb9",
        "type": "function",
        "z": "c4f677cd277b409d",
        "name": "str2bool",
        "func": "msg.payload = (msg?.payload?.toLowerCase() === 'true');\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 340,
        "wires": [
            [
                "e5c9c7caaa758ba6"
            ]
        ]
    },
    {
        "id": "e5c9c7caaa758ba6",
        "type": "ui-switch",
        "z": "c4f677cd277b409d",
        "name": "ShowBanner",
        "label": "Show Home Page Banner",
        "group": "c48e064d37e64bbf",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": false,
        "topic": "topic",
        "topicType": "msg",
        "style": "",
        "className": "",
        "layout": "row-left-swapped",
        "clickableArea": "line",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "x": 630,
        "y": 340,
        "wires": [
            [
                "9b3d26af73349aa3"
            ]
        ]
    },
    {
        "id": "9b3d26af73349aa3",
        "type": "change",
        "z": "c4f677cd277b409d",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "CSMS:ShowBanner",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 850,
        "y": 340,
        "wires": [
            [
                "2f5b237b308259e4",
                "4f2eb882456520c0"
            ]
        ]
    },
    {
        "id": "2f5b237b308259e4",
        "type": "function",
        "z": "c4f677cd277b409d",
        "name": "bool2str",
        "func": "msg.payload = `${msg.payload}`\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 340,
        "wires": [
            [
                "cdc21d885376925c"
            ]
        ]
    },
    {
        "id": "cdc21d885376925c",
        "type": "redis-command",
        "z": "c4f677cd277b409d",
        "server": "0430675ed6c7cd83",
        "command": "SET",
        "name": "set ShowBanner",
        "topic": "settings:site:show_banner",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 1260,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "2865264d3a083b92",
        "type": "ui-text-input",
        "z": "c4f677cd277b409d",
        "group": "c48e064d37e64bbf",
        "name": "",
        "label": "Banner URL:",
        "order": 6,
        "width": 0,
        "height": 0,
        "topic": "topic",
        "topicType": "msg",
        "mode": "text",
        "tooltip": "",
        "delay": 300,
        "passthru": true,
        "sendOnDelay": false,
        "sendOnBlur": true,
        "sendOnEnter": true,
        "className": "",
        "clearable": false,
        "sendOnClear": false,
        "icon": "",
        "iconPosition": "left",
        "iconInnerPosition": "inside",
        "x": 630,
        "y": 400,
        "wires": [
            [
                "3be95eeae5f0a952"
            ]
        ]
    },
    {
        "id": "039d0809d7c54de3",
        "type": "redis-command",
        "z": "c4f677cd277b409d",
        "server": "0430675ed6c7cd83",
        "command": "GET",
        "name": "get BannerURL",
        "topic": "settings:site:banner_url",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 280,
        "y": 400,
        "wires": [
            [
                "2865264d3a083b92"
            ]
        ]
    },
    {
        "id": "effb1e3caf4af0f1",
        "type": "change",
        "z": "c4f677cd277b409d",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "CSMS:BannerURL",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1040,
        "y": 400,
        "wires": [
            [
                "032974aac4851b85",
                "4f2eb882456520c0"
            ]
        ]
    },
    {
        "id": "032974aac4851b85",
        "type": "redis-command",
        "z": "c4f677cd277b409d",
        "server": "0430675ed6c7cd83",
        "command": "SET",
        "name": "set BannerURL",
        "topic": "settings:site:banner_url",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 1260,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "75b51ecec0628924",
        "type": "redis-command",
        "z": "c4f677cd277b409d",
        "server": "0430675ed6c7cd83",
        "command": "GET",
        "name": "get MVSampleRate",
        "topic": "settings:evse:mvsampleinterval",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 290,
        "y": 460,
        "wires": [
            [
                "be79b6ceff0f3e99"
            ]
        ]
    },
    {
        "id": "be79b6ceff0f3e99",
        "type": "function",
        "z": "c4f677cd277b409d",
        "name": "str2num",
        "func": "if (msg?.payload){\n    msg.payload = Number(msg.payload)\n}\nelse {\n    msg.payload = 60\n}\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 460,
        "wires": [
            [
                "10d82e3acebc28c9"
            ]
        ]
    },
    {
        "id": "10d82e3acebc28c9",
        "type": "ui-number-input",
        "z": "c4f677cd277b409d",
        "group": "ace44af4012c4fc1",
        "name": "MV Interval",
        "label": "Meter Value Sample Interval (seconds)",
        "order": 2,
        "width": 0,
        "height": 0,
        "topic": "heartbeat",
        "topicType": "msg",
        "min": 0,
        "max": "86400",
        "step": 1,
        "tooltip": "",
        "passthru": true,
        "sendOnBlur": true,
        "sendOnEnter": true,
        "className": "",
        "clearable": false,
        "icon": "mdi-view-week",
        "iconPosition": "left",
        "iconInnerPosition": "inside",
        "spinner": "default",
        "x": 630,
        "y": 460,
        "wires": [
            [
                "1749deab15469733"
            ]
        ]
    },
    {
        "id": "1749deab15469733",
        "type": "function",
        "z": "c4f677cd277b409d",
        "name": "num2str",
        "func": "global.set(\"CSMS:MVSampleInterval\", msg.payload)\nmsg.payload = `${msg.payload}`\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 460,
        "wires": [
            [
                "fb57c8aef67fde6a"
            ]
        ]
    },
    {
        "id": "fb57c8aef67fde6a",
        "type": "redis-command",
        "z": "c4f677cd277b409d",
        "server": "0430675ed6c7cd83",
        "command": "SET",
        "name": "set MVSampleRate",
        "topic": "settings:evse:mvsampleinterval",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 1270,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "4f2eb882456520c0",
        "type": "link out",
        "z": "c4f677cd277b409d",
        "name": "link out 50",
        "mode": "link",
        "links": [
            "f4cb836a36b77b75"
        ],
        "x": 1525,
        "y": 400,
        "wires": []
    },
    {
        "id": "fb0a4e143e0f32de",
        "type": "redis-command",
        "z": "c4f677cd277b409d",
        "server": "0430675ed6c7cd83",
        "command": "GET",
        "name": "get ShowMeters",
        "topic": "settings:site:show_meters",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 280,
        "y": 520,
        "wires": [
            [
                "f751c51525b9a588"
            ]
        ]
    },
    {
        "id": "f751c51525b9a588",
        "type": "function",
        "z": "c4f677cd277b409d",
        "name": "str2bool",
        "func": "msg.payload = (msg?.payload?.toLowerCase() === 'true');\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 520,
        "wires": [
            [
                "3e51ec5aad79e4b4"
            ]
        ]
    },
    {
        "id": "3e51ec5aad79e4b4",
        "type": "ui-switch",
        "z": "c4f677cd277b409d",
        "name": "ShowMeters",
        "label": "Show Meters Page",
        "group": "c48e064d37e64bbf",
        "order": 5,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": false,
        "topic": "topic",
        "topicType": "msg",
        "style": "",
        "className": "",
        "layout": "row-left-swapped",
        "clickableArea": "line",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "x": 630,
        "y": 520,
        "wires": [
            [
                "44c6f7b6e8c6c2c0"
            ]
        ]
    },
    {
        "id": "44c6f7b6e8c6c2c0",
        "type": "change",
        "z": "c4f677cd277b409d",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "CSMS:ShowMeters",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 850,
        "y": 520,
        "wires": [
            [
                "885b6e8bcbe1d24b",
                "6987223118a808f4"
            ]
        ]
    },
    {
        "id": "885b6e8bcbe1d24b",
        "type": "function",
        "z": "c4f677cd277b409d",
        "name": "bool2str",
        "func": "msg.payload = `${msg.payload}`\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 520,
        "wires": [
            [
                "323c7dc47a709281"
            ]
        ]
    },
    {
        "id": "323c7dc47a709281",
        "type": "redis-command",
        "z": "c4f677cd277b409d",
        "server": "0430675ed6c7cd83",
        "command": "SET",
        "name": "set ShowMeters",
        "topic": "settings:site:show_meters",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 1260,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "6987223118a808f4",
        "type": "function",
        "z": "c4f677cd277b409d",
        "name": "show/hide Meters Page",
        "func": "let x = msg.payload\n\nmsg = {}\n\nif (x == true){\n    msg.payload = {\n        pages: { show: [\"Meters\"]}\n    }\n}\nelse {\n    msg.payload = {\n        pages: { hide: [\"Meters\"]}\n    }\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1110,
        "y": 580,
        "wires": [
            [
                "667eb387ade36ccc"
            ]
        ]
    },
    {
        "id": "667eb387ade36ccc",
        "type": "ui-control",
        "z": "c4f677cd277b409d",
        "name": "",
        "ui": "8cdc313c9611f13f",
        "events": "all",
        "x": 1300,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "dfe32902741b4462",
        "type": "redis-command",
        "z": "c4f677cd277b409d",
        "server": "0430675ed6c7cd83",
        "command": "GET",
        "name": "get ShowMap",
        "topic": "settings:site:show_map",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 300,
        "y": 660,
        "wires": [
            [
                "1b555c160e8aa0eb"
            ]
        ]
    },
    {
        "id": "1b555c160e8aa0eb",
        "type": "function",
        "z": "c4f677cd277b409d",
        "name": "str2bool",
        "func": "msg.payload = (msg?.payload?.toLowerCase() === 'true');\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 660,
        "wires": [
            [
                "2d740621d91ae205"
            ]
        ]
    },
    {
        "id": "2d740621d91ae205",
        "type": "ui-switch",
        "z": "c4f677cd277b409d",
        "name": "ShowMap",
        "label": "Show Home Page Map",
        "group": "c48e064d37e64bbf",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": false,
        "topic": "topic",
        "topicType": "msg",
        "style": "",
        "className": "",
        "layout": "row-left-swapped",
        "clickableArea": "line",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "x": 640,
        "y": 660,
        "wires": [
            [
                "c30ab1f3c6b40614"
            ]
        ]
    },
    {
        "id": "c30ab1f3c6b40614",
        "type": "change",
        "z": "c4f677cd277b409d",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "CSMS:ShowMap",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 860,
        "y": 660,
        "wires": [
            [
                "a34826a6ffc61fbc",
                "4f2eb882456520c0"
            ]
        ]
    },
    {
        "id": "a34826a6ffc61fbc",
        "type": "function",
        "z": "c4f677cd277b409d",
        "name": "bool2str",
        "func": "msg.payload = `${msg.payload}`\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1100,
        "y": 660,
        "wires": [
            [
                "fee4aff2afcaa058"
            ]
        ]
    },
    {
        "id": "fee4aff2afcaa058",
        "type": "redis-command",
        "z": "c4f677cd277b409d",
        "server": "0430675ed6c7cd83",
        "command": "SET",
        "name": "set ShowMap",
        "topic": "settings:site:show_map",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 1280,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "18e6c9e77140a8fc",
        "type": "redis-command",
        "z": "c4f677cd277b409d",
        "server": "0430675ed6c7cd83",
        "command": "GET",
        "name": "get ShowGraphCnt",
        "topic": "settings:site:show_graph_cnt",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 310,
        "y": 720,
        "wires": [
            [
                "edfdfd830d98ce95"
            ]
        ]
    },
    {
        "id": "edfdfd830d98ce95",
        "type": "function",
        "z": "c4f677cd277b409d",
        "name": "str2bool",
        "func": "msg.payload = (msg?.payload?.toLowerCase() === 'true');\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 720,
        "wires": [
            [
                "8ee3142b6bad2847"
            ]
        ]
    },
    {
        "id": "8ee3142b6bad2847",
        "type": "ui-switch",
        "z": "c4f677cd277b409d",
        "name": "ShowCurrentGraph",
        "label": "Show Home Page Current Graph",
        "group": "c48e064d37e64bbf",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": false,
        "topic": "topic",
        "topicType": "msg",
        "style": "",
        "className": "",
        "layout": "row-left-swapped",
        "clickableArea": "line",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "x": 650,
        "y": 720,
        "wires": [
            [
                "53c569268ad4fd09"
            ]
        ]
    },
    {
        "id": "53c569268ad4fd09",
        "type": "change",
        "z": "c4f677cd277b409d",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "CSMS:ShowCurrentGraph",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 910,
        "y": 720,
        "wires": [
            [
                "142237413ab57822",
                "4f2eb882456520c0"
            ]
        ]
    },
    {
        "id": "142237413ab57822",
        "type": "function",
        "z": "c4f677cd277b409d",
        "name": "bool2str",
        "func": "msg.payload = `${msg.payload}`\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1140,
        "y": 720,
        "wires": [
            [
                "4994f3046c39b821"
            ]
        ]
    },
    {
        "id": "4994f3046c39b821",
        "type": "redis-command",
        "z": "c4f677cd277b409d",
        "server": "0430675ed6c7cd83",
        "command": "SET",
        "name": "set ShowGraphCnt",
        "topic": "settings:site:show_graph_cnt",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 1310,
        "y": 720,
        "wires": [
            []
        ]
    },
    {
        "id": "c10702a72a0cb5b0",
        "type": "redis-command",
        "z": "c4f677cd277b409d",
        "server": "0430675ed6c7cd83",
        "command": "GET",
        "name": "get ShowGraphCnt",
        "topic": "settings:site:show_graph_pwr",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 310,
        "y": 780,
        "wires": [
            [
                "16163f173f4ddae5"
            ]
        ]
    },
    {
        "id": "16163f173f4ddae5",
        "type": "function",
        "z": "c4f677cd277b409d",
        "name": "str2bool",
        "func": "msg.payload = (msg?.payload?.toLowerCase() === 'true');\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 780,
        "wires": [
            [
                "0ebeed67fd27c4bf"
            ]
        ]
    },
    {
        "id": "0ebeed67fd27c4bf",
        "type": "ui-switch",
        "z": "c4f677cd277b409d",
        "name": "ShowPowerGraph",
        "label": "Show Home Page Power Graph",
        "group": "c48e064d37e64bbf",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": false,
        "topic": "topic",
        "topicType": "msg",
        "style": "",
        "className": "",
        "layout": "row-left-swapped",
        "clickableArea": "line",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "x": 650,
        "y": 780,
        "wires": [
            [
                "d7d6bc36a2c985ee"
            ]
        ]
    },
    {
        "id": "d7d6bc36a2c985ee",
        "type": "change",
        "z": "c4f677cd277b409d",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "CSMS:ShowPowerGraph",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 900,
        "y": 780,
        "wires": [
            [
                "45a7caf34a0aa0a9",
                "4f2eb882456520c0"
            ]
        ]
    },
    {
        "id": "45a7caf34a0aa0a9",
        "type": "function",
        "z": "c4f677cd277b409d",
        "name": "bool2str",
        "func": "msg.payload = `${msg.payload}`\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 780,
        "wires": [
            [
                "72b9e3775f903266"
            ]
        ]
    },
    {
        "id": "72b9e3775f903266",
        "type": "redis-command",
        "z": "c4f677cd277b409d",
        "server": "0430675ed6c7cd83",
        "command": "SET",
        "name": "set ShowGraphCnt",
        "topic": "settings:site:show_graph_pwr",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 1310,
        "y": 780,
        "wires": [
            []
        ]
    },
    {
        "id": "3be95eeae5f0a952",
        "type": "function",
        "z": "c4f677cd277b409d",
        "name": "function 8",
        "func": "if (!msg?.payload) msg.payload = \"/assets/cl3.png\"\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 400,
        "wires": [
            [
                "effb1e3caf4af0f1"
            ]
        ]
    },
    {
        "id": "b05ce5e13a571231",
        "type": "redis-command",
        "z": "55e67bd3e4f94c9a",
        "server": "0430675ed6c7cd83",
        "command": "SET",
        "name": "",
        "topic": "",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 530,
        "y": 260,
        "wires": [
            [
                "570c8d913eb44546"
            ]
        ]
    },
    {
        "id": "a08dc1fc37195f4c",
        "type": "json",
        "z": "55e67bd3e4f94c9a",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": true,
        "x": 370,
        "y": 260,
        "wires": [
            [
                "b05ce5e13a571231"
            ]
        ]
    },
    {
        "id": "e0a2ea21b99cf98c",
        "type": "redis-command",
        "z": "55e67bd3e4f94c9a",
        "server": "0430675ed6c7cd83",
        "command": "KEYS",
        "name": "",
        "topic": "",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 370,
        "y": 360,
        "wires": [
            [
                "c343b3129ff33360"
            ]
        ]
    },
    {
        "id": "c343b3129ff33360",
        "type": "json",
        "z": "55e67bd3e4f94c9a",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": true,
        "x": 510,
        "y": 360,
        "wires": [
            [
                "34c26ee02aa060fb"
            ]
        ]
    },
    {
        "id": "21dc022ed140a1bc",
        "type": "inject",
        "z": "55e67bd3e4f94c9a",
        "name": "Inject List at Startup",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "0",
        "x": 180,
        "y": 100,
        "wires": [
            [
                "76941cfcbf239f3e"
            ]
        ]
    },
    {
        "id": "34c26ee02aa060fb",
        "type": "json",
        "z": "55e67bd3e4f94c9a",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 630,
        "y": 360,
        "wires": [
            [
                "d7d05de12e3a6bb1"
            ]
        ]
    },
    {
        "id": "75aa14505ccda591",
        "type": "redis-command",
        "z": "55e67bd3e4f94c9a",
        "server": "0430675ed6c7cd83",
        "command": "MGET",
        "name": "",
        "topic": "",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 430,
        "y": 440,
        "wires": [
            [
                "bee3f345890bdc32"
            ]
        ]
    },
    {
        "id": "a10ea6afabaa98a1",
        "type": "redis-command",
        "z": "55e67bd3e4f94c9a",
        "server": "0430675ed6c7cd83",
        "command": "DEL",
        "name": "",
        "topic": "",
        "params": "",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 1480,
        "y": 440,
        "wires": [
            [
                "478df7cbfd677ac8"
            ]
        ]
    },
    {
        "id": "d7d05de12e3a6bb1",
        "type": "change",
        "z": "55e67bd3e4f94c9a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "gettags",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 230,
        "y": 440,
        "wires": [
            [
                "75aa14505ccda591"
            ]
        ]
    },
    {
        "id": "bee3f345890bdc32",
        "type": "function",
        "z": "55e67bd3e4f94c9a",
        "name": "function 5",
        "func": "let evse\nlet tagInfo\nlet tags = []\n\nmsg.payload.splice(0,1)\n\nmsg.payload.forEach(function(tagItem) {\n    tagInfo = JSON.parse(tagItem)\n    tags.push(tagInfo)\n})\n\n/*\nmsg.headers = [\n    { key: 'name', title: 'Name', align: 'start'},\n    { key: 'tagId', title: \"Tag\"}, // title: 'Tag ID', value: 'item.tagId'},\n    { key: 'expdate', title: 'Expires'},\n    { key: 'enabled', title: 'Enabled'},\n    { key: 'lasttxdate', title: 'Last Tx'},\n    { key: 'actions', title: 'Action',align: 'end', sortable: false} \n]\n*/\n\nglobal.set(\"CSMS:Tags\",tags)\nmsg.payload = tags\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 440,
        "wires": [
            [
                "7c94e421f65d1c9e",
                "5a2226d788de7cae"
            ]
        ]
    },
    {
        "id": "e3a6be6f872e5ee3",
        "type": "function",
        "z": "55e67bd3e4f94c9a",
        "name": "Create taginfo:",
        "func": "let key = `taginfo:${msg.payload.tagId}`\nmsg.topic = key\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 220,
        "y": 260,
        "wires": [
            [
                "a08dc1fc37195f4c"
            ]
        ]
    },
    {
        "id": "7c94e421f65d1c9e",
        "type": "ui-template",
        "z": "55e67bd3e4f94c9a",
        "group": "447b58f3ddb86ab6",
        "page": "",
        "ui": "",
        "name": "Drivers Table",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n\n    <!--v-toolbar flat>\n      <v-toolbar-title class=\"text-grey\">\n        Actions\n      </v-toolbar-title>\n\n      <v-spacer></v-spacer>\n           <v-tooltip text=\"Refresh\" location=\"bottom\">\n        <template v-slot:activator=\"{ props }\">\n          <v-btn icon v-bind=\"props\" @click=\"refresh\">\n            <v-icon>mdi-refresh</v-icon>\n          </v-btn>\n        </template>\n      </v-tooltip>\n      <v-tooltip text=\"New\" location=\"bottom\">\n        <template v-slot:activator=\"{ props }\">\n          <v-btn icon v-bind=\"props\" @click=\"addNew\">\n            <v-icon>mdi-card-account-details-outline</v-icon>\n          </v-btn>\n        </template>\n      </v-tooltip>\n\n    </v-toolbar>\n\n      <v-text-field\n        v-model=\"search\"\n        label=\"Search\"\n        prepend-inner-icon=\"mdi-magnify\"\n        variant=\"outlined\"\n        clearable\n        hide-details\n        single-line\n      ></v-text-field -->\n\n    \n    <v-data-table  \n        :search=\"search\" \n        :items=\"msg?.payload\"\n        :headers=\"headers\"\n        v-model=\"selected\"\n        item-selectable=\"selectable\"\n        select-strategy=\"all\"\n        hide-select    \n        return-object>\n      <template v-slot:top>\n        <v-toolbar flat>\n          <v-toolbar-title>\n            <v-icon color=\"medium-emphasis\" icon=\"mdi-card-account-details\" size=\"x-small\" start></v-icon>\n            Tag Info\n          </v-toolbar-title>\n          <v-text-field\n            v-model=\"search\"\n            label=\"Search\"\n            prepend-inner-icon=\"mdi-magnify\"\n            clear-icon=\"mdi-close-circle\"\n            variant=\"solo-filled\"\n            density=\"compact\"\n            hide-details\n            single-line\n            clearable\n          ></v-text-field>\n                <v-tooltip text=\"Refresh\" location=\"bottom\">\n        <template v-slot:activator=\"{ props }\">\n          <v-btn icon v-bind=\"props\" @click=\"refresh\">\n            <v-icon>mdi-refresh</v-icon>\n          </v-btn>\n        </template>\n      </v-tooltip>\n\n      <v-tooltip text=\"New\" location=\"bottom\">\n        <template v-slot:activator=\"{ props }\">\n          <v-btn icon v-bind=\"props\" @click=\"addNew\">\n            <v-icon>mdi-card-account-details-outline</v-icon>\n          </v-btn>\n        </template>\n      </v-tooltip>\n        </v-toolbar>\n      </template>\n      <template v-slot:header.lasttxdate>\n        <div><v-icon icon=\"mdi-calendar\" class=\"text-center\"></div>\n      </template>\n\n      <template v-slot:item.name=\"{ item }\">\n        <div :class=\"statusClass(item)\">\n          <v-text>{{ item.name }}</v-text>\n      </template>\n\n      <template v-slot:item.tagId=\"{ item }\">\n        <div :class=\"statusClass(item)\">\n          <v-text>{{ item.tagId }}</v-text>\n      </template>\n      \n\n      <template v-slot:item.expdate=\"{ item }\">\n        <div :class=\"statusClass(item)\">\n          <v-text>{{ item.expdate }}</v-text>\n      </template>\n\n      \n      <template v-slot:item.enabled=\"{ item }\">\n        <div class=\"text-center\">\n          <v-icon v-if=\"item.enabled\" color=\"green\" icon=\"mdi-checkbox-outline\"></v-icon>\n          <v-icon v-else color=\"red\" icon=\"mdi-minus-box-outline\"></v-icon>\n        </div>\n      </template>\n\n      <template v-slot:item.actions=\"{ item }\">\n        <v-icon\n          class=\"me-2\"\n          size=\"small\"\n          @click=\"send({action: 'edit', payload: [item]})\"\n        >\n          mdi-pencil\n        </v-icon>\n        <v-icon\n          size=\"small\"\n          @click=\"send({action: 'delete', payload: [item]})\"\n        >\n          mdi-delete\n        </v-icon>\n      </template>\n\n    </v-data-table>\n\n</template>\n\n<script>\n    export default {\n    data () {\n      return {\n        selected: [],\n        search: '',\n        multiSelected: 0,\n        heartbeat: 30,\n        headers: [\n            { key: 'name', title: 'Name', align: 'start'},\n            { key: 'tagId', title: \"Tag\"},\n            { key: 'expdate', title: 'Expires'},\n            { key: 'enabled', title: 'Enabled', align: 'center'},\n            //{ key: 'lasttxdate', title: 'Last Tx'},\n            { key: 'actions', title: 'Action',align: 'end', sortable: false} \n        ]\n      }\n    },\n    watch: {\n        selected: function() {\n          this.multiSelected = this.selected.length\n        }\n    },\n    methods: {\n      // expose a method to our <template> and Vue Application\n      addNew() {\n        this.send({action: 'add', payload: [{ cbId: ''}]});\n        this.selected = [];\n        this.multiSelected = 0;\n      },\n      statusClass(item) {\n        if (item.expdate){ \n            let expDate = new Date(item.expdate)\n            expDate.setHours(23, 59, 59, 999); // Set to the end of the day\n            let currentDate = new Date()\n\n            if (currentDate > expDate){\n              return \"disabled\"\n            }\n        }\n\n          return (item.enabled)? \"enabled\" : \"disabled\"\n      }\n    }  \n  }\n</script>\n\n<style>\n  .disabled {\n    color: red;\n    text-decoration: line-through;\n  }\n  .enabled {\n    color: darkgreen;\n    font-weight: bold;\n  }\n</style>",
        "storeOutMessages": true,
        "passthru": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 730,
        "y": 440,
        "wires": [
            [
                "7bf0c2f4c53b878c"
            ]
        ]
    },
    {
        "id": "9cfd6611eb504813",
        "type": "ui-template",
        "z": "55e67bd3e4f94c9a",
        "group": "447b58f3ddb86ab6",
        "page": "",
        "ui": "",
        "name": "Edit Form",
        "order": 2,
        "width": "0",
        "height": "0",
        "head": "",
        "format": "<template>\n    <v-dialog width=\"auto\" v-model=\"showDialog\">\n        <v-card color=\"white\" v-click-outside=\"{handler: onDoNothing}\">\n            <v-toolbar color=\"primary\">\n                <v-card-title>\n                    <span>{{ title }}</span>\n                </v-card-title>\n            </v-toolbar>\n            <v-container>\n                <v-text-field\n                    v-model=\"name\"\n                    label=\"Account Name\"\n                    type=\"text\"\n                    min-width=25em\n                    hint=\"Name for this account (user, company etc.)\"\n                ></v-text-field>\n                <v-text-field\n                    v-model=\"tagId\"\n                    label=\"Tag ID\"\n                    type=\"text\"\n                ></v-text-field>\n                <v-text-field\n                    v-model=\"expdate\"\n                    label=\"Expiration\"\n                    type=\"date\"\n                    hint=\"\"\n                ></v-text-field>\n                <v-checkbox\n                    v-model=\"enabled\"\n                    label=\"Enabled\"\n                    type=\"checkbox\"\n                ></v-checkbox>\n                <!-- v-text-field\n                    v-model=\"lasttxdate\"\n                    label=\"Last Tx\"\n                    type=\"number\"\n                    placeholder=\"<optional>\"\n                ></v-text-field -->\n\n                <v-card-actions class=\"justify-end\">\n                    <v-btn variant=\"elevated\" @click=\"okDialog\">{{ okText }}</v-btn>\n                    <v-btn variant=\"elevated\" @click=\"cancelDialog\">{{ cancelText }}</v-btn>\n                </v-card-actions>\n            </v-container>\n        </v-card>\n    </v-dialog>\n</template>\n\n<script>\n    export default {\n        data() {\n            // define variables available component-wide\n            // (in <template> and component functions)\n            return {\n                name: '',\n                tagId: '',\n                expdate: Date.now(),\n                enabled: false,\n                lasttxdate: Date.now(),\n                showDialog: false\n            }\n        },\n        watch: {\n            // watch for any changes of \"count\"\n        },    \n        computed: {\n            // automatically compute this variable\n            // whenever VueJS deems appropriate\n\n        },\n        methods: {\n            // expose a method to our <template> and Vue Application\n            sendtagiddata: function() {\n                this.send({\n                    payload: {\n                        name: this.name,\n                        tagId: this.tagId,\n                        expdate: this.expdate,\n                        enabled: this.enabled,\n                        lasttxdate: this.lasttxdate\n                    }\n                })\n            },\n            okDialog: function() {\n                this.sendtagiddata()\n                this.showDialog = false\n            },\n            cancelDialog: function() {\n                this.msg.payload = {}\n                this.showDialog = false\n            },\n            onClickOutside: function() {\n                this.msg.payload = {}\n                this.showDialog = false\n            },\n            onDoNothing: function() { this.showDialog = true},\n            getReadOnly: function() {\n                return (this.newEdit == \"New\") ? false : true\n            }\n\n        },\n        mounted() {\n\n            this.$socket.on('msg-input:' + this.id, (msg) => {\n                // do stuff with msg\n                // runs only when messages are received\n                if (this.msg?.payload){\n                    let payload = this.msg.payload\n                    this.name = payload.name ?? ''\n                    this.tagId = payload.tagId ?? ''\n                    this.expdate = payload.expdate ?? null\n                    this.enabled = payload.enabled ?? false\n                    this.lasttxdate = payload.lasttxdate ?? null\n                }\n                if (this.msg?.dialog) {\n                    let dialog = this.msg.dialog\n                    this.okText = dialog.okText ?? \"OK\"\n                    this.cancelText = dialog.cancelText ?? \"Cancel\"\n                    this.showDialog = dialog.showDialog ?? false\n                    this.title = dialog.title ?? \"Tag Info\"\n                    this.newEdit = dialog.newEdit ?? \"New\"\n                }\n            })\n                        \n        },\n        unmounted() {}\n   }\n</script>\n",
        "storeOutMessages": true,
        "passthru": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 220,
        "y": 180,
        "wires": [
            [
                "c0bcd5f7e0d961d1"
            ]
        ]
    },
    {
        "id": "c0bcd5f7e0d961d1",
        "type": "link out",
        "z": "55e67bd3e4f94c9a",
        "name": "link out 4",
        "mode": "link",
        "links": [
            "b3e37204b499ad30"
        ],
        "x": 405,
        "y": 180,
        "wires": []
    },
    {
        "id": "b3e37204b499ad30",
        "type": "link in",
        "z": "55e67bd3e4f94c9a",
        "name": "Set TagInfo",
        "links": [
            "c0bcd5f7e0d961d1"
        ],
        "x": 85,
        "y": 260,
        "wires": [
            [
                "e3a6be6f872e5ee3"
            ]
        ]
    },
    {
        "id": "db0ee15864de99ca",
        "type": "link in",
        "z": "55e67bd3e4f94c9a",
        "name": "RefreshTaginfo List",
        "links": [
            "478df7cbfd677ac8",
            "570c8d913eb44546",
            "76941cfcbf239f3e",
            "cf180dbcd550b118"
        ],
        "x": 85,
        "y": 360,
        "wires": [
            [
                "c7703b48d88b3bdd"
            ]
        ]
    },
    {
        "id": "570c8d913eb44546",
        "type": "link out",
        "z": "55e67bd3e4f94c9a",
        "name": "link out 5",
        "mode": "link",
        "links": [
            "db0ee15864de99ca"
        ],
        "x": 635,
        "y": 260,
        "wires": []
    },
    {
        "id": "7bf0c2f4c53b878c",
        "type": "switch",
        "z": "55e67bd3e4f94c9a",
        "name": "",
        "property": "action",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "add",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "edit",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "delete",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "refresh",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 870,
        "y": 440,
        "wires": [
            [
                "f3dd4285d1436aac"
            ],
            [
                "f3dd4285d1436aac"
            ],
            [
                "25e25012a3dc58c5"
            ],
            [
                "cf180dbcd550b118"
            ]
        ]
    },
    {
        "id": "733e64a4e54121b8",
        "type": "function",
        "z": "55e67bd3e4f94c9a",
        "name": "function 7",
        "func": "let key = `taginfo:${msg.payload.tagId}`\nmsg = {}\nmsg.topic = key\nreturn msg\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1340,
        "y": 440,
        "wires": [
            [
                "a10ea6afabaa98a1"
            ]
        ]
    },
    {
        "id": "478df7cbfd677ac8",
        "type": "link out",
        "z": "55e67bd3e4f94c9a",
        "name": "link out 6",
        "mode": "link",
        "links": [
            "db0ee15864de99ca"
        ],
        "x": 1575,
        "y": 440,
        "wires": []
    },
    {
        "id": "f3dd4285d1436aac",
        "type": "change",
        "z": "55e67bd3e4f94c9a",
        "name": "Add/Edit Dialog ",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload[0]",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "dialog.showDialog",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            },
            {
                "t": "set",
                "p": "dialog.okText",
                "pt": "msg",
                "to": "Ok",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "dialog.cancelText",
                "pt": "msg",
                "to": "Cancel",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "dialog.title",
                "pt": "msg",
                "to": "TagInfo",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1040,
        "y": 400,
        "wires": [
            [
                "bf8f0dfada9e7ff4"
            ]
        ]
    },
    {
        "id": "c7703b48d88b3bdd",
        "type": "function",
        "z": "55e67bd3e4f94c9a",
        "name": "Scan taginfo:",
        "func": "msg = {}\nmsg.payload = \"taginfo:*\"\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 210,
        "y": 360,
        "wires": [
            [
                "e0a2ea21b99cf98c"
            ]
        ]
    },
    {
        "id": "afcd44d6a459fb11",
        "type": "link in",
        "z": "55e67bd3e4f94c9a",
        "name": "TagInfo Edit Form",
        "links": [
            "bf8f0dfada9e7ff4"
        ],
        "x": 85,
        "y": 180,
        "wires": [
            [
                "9cfd6611eb504813"
            ]
        ]
    },
    {
        "id": "bf8f0dfada9e7ff4",
        "type": "link out",
        "z": "55e67bd3e4f94c9a",
        "name": "link out 9",
        "mode": "link",
        "links": [
            "afcd44d6a459fb11"
        ],
        "x": 1165,
        "y": 400,
        "wires": []
    },
    {
        "id": "76941cfcbf239f3e",
        "type": "link out",
        "z": "55e67bd3e4f94c9a",
        "name": "link out 10",
        "mode": "link",
        "links": [
            "db0ee15864de99ca"
        ],
        "x": 325,
        "y": 100,
        "wires": []
    },
    {
        "id": "cf180dbcd550b118",
        "type": "link out",
        "z": "55e67bd3e4f94c9a",
        "name": "link out 15",
        "mode": "link",
        "links": [
            "db0ee15864de99ca"
        ],
        "x": 985,
        "y": 480,
        "wires": []
    },
    {
        "id": "95f17244a08397ca",
        "type": "ui-template",
        "z": "55e67bd3e4f94c9a",
        "group": "447b58f3ddb86ab6",
        "page": "",
        "ui": "",
        "name": "Verify Delete",
        "order": 3,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n    <v-dialog width=\"auto\" v-model=\"showDialog\">\n        <v-card color=\"white\" v-click-outside=\"{handler: onClickOutside}\">\n            <v-toolbar color=\"primary\">\n                <v-card-title>\n                    <span>Delete {{ name }}:{{tagId}}?</span>\n                </v-card-title>\n            </v-toolbar>\n            <v-container>\n                <v-card-actions class=\"justify-end\">\n                    <v-btn variant=\"elevated\" @click=\"okDialog\">{{ okText }}</v-btn>\n                    <v-btn variant=\"elevated\" @click=\"cancelDialog\">{{ cancelText }}</v-btn>\n                </v-card-actions>\n            </v-container>\n        </v-card>\n    </v-dialog>\n</template>\n\n<script>\n    export default {\n        data() {\n            return {\n                okText: 'Delete',\n                cancelText: 'Cancel',\n                showDialog: false,\n                name: '<undefined>',\n                tagId: '<undefined>'\n            }\n        },\n\n        watch: {},\n        \n        mounted() {\n            this.$socket.on('msg-input:' + this.id, (msg) => {\n                if (this.msg.dialog){\n                    let dialog = this.msg.dialog\n                    this.showDialog = dialog.showDialog ?? false\n                    this.okText = dialog?.okText\n                    this.cancelText = dialog?.cancelText\n                }\n                if (this.msg.payload){\n                    let payload = this.msg.payload\n                    this.name = payload.name\n                    this.tagId = payload.tagId\n                }\n            })\n        },\n        methods: {\n            okDialog: function() {\n                this.showDialog = false\n                this.send(this.msg)\n\n            },\n            cancelDialog: function() {\n                this.msg.paylaod = {}\n                this.showDialog = false\n            }\n\n        }\n    }\n</script>\n",
        "storeOutMessages": true,
        "passthru": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1190,
        "y": 440,
        "wires": [
            [
                "733e64a4e54121b8"
            ]
        ]
    },
    {
        "id": "25e25012a3dc58c5",
        "type": "change",
        "z": "55e67bd3e4f94c9a",
        "name": "Delete Verify",
        "rules": [
            {
                "t": "set",
                "p": "dialog.showDialog",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            },
            {
                "t": "set",
                "p": "dialog.okText",
                "pt": "msg",
                "to": "Delete",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "dialog.cancelText",
                "pt": "msg",
                "to": "Cancel",
                "tot": "str"
            },
            {
                "t": "move",
                "p": "payload[0]",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1030,
        "y": 440,
        "wires": [
            [
                "95f17244a08397ca"
            ]
        ]
    },
    {
        "id": "5a2226d788de7cae",
        "type": "debug",
        "z": "55e67bd3e4f94c9a",
        "name": "debug 56",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 730,
        "y": 580,
        "wires": []
    },
    {
        "id": "e3912322d07af67d",
        "type": "ui-template",
        "z": "daf7a59ca2ce18df",
        "group": "17fb40c0e949759b",
        "page": "",
        "ui": "",
        "name": "Tx List",
        "order": 1,
        "width": "0",
        "height": "0",
        "head": "",
        "format": "<template>\n    <v-text-field\n        v-model=\"search\"\n        label=\"Search\"\n        prepend-inner-icon=\"mdi-magnify\"\n        variant=\"outlined\"\n        clearable\n        hide-details\n        single-line\n      ></v-text-field>\n\n    <v-data-table  \n            v-model:search=\"search\" \n            :headers=\"headers\"\n            :items=\"msg?.payload\"\n            :filter-keys='[\"transactionId\",\"cbId\",\"_value\"]'\n            >\n      <template v-slot:item.meter=\"{ item }\">\n        <div>\n          <v-text>{{ item.meterStart }}{{item.meterStop}}</v-text>\n      </template>\n        <template v-slot:item._time=\"{ item }\">\n            <div>{{ getLocalTimeString(item._time) }}</div>\n        </template>\n      <template v-slot:item.actions=\"{ item }\">\n        <v-icon\n          class=\"me-2\"\n          size=\"small\"\n          @click=\"send({payload: { txId: item.transactionId}})\"\n        >\n          mdi-eye\n        </v-icon>\n      </template>\n            \n    </v-data-table>\n</template>\n\n<script>\n    export default {\n        data() {\n            // define variables available component-wide\n            // (in <template> and component functions)\n            return {\n                search: '',\n                headers: [\n                    { value: \"_time\", title: \"Time\"},\n                    { value: \"command\", title: \"Command\"},\n                    { value: \"transactionId\", title: \"TxId\"},\n                    { value: \"cbId\", title: \"EVSE\"},\n                    { value: \"connectorId\", title: \"Conn\"},\n                    //{ value: \"meterStart\", title: \"Start\"},\n                    //{ value: \"meterStop\", title: \"Stop\"},\n                    { key: \"meter\", title: \"Meter\"},\n                    { key: \"actions\", title: \"View\", sortable: false},\n                ]\n            }\n        },\n        watch: {\n            // watch for any changes of \"count\"\n\n        },\n        computed: {\n\n        },\n        methods: {\n            // expose a method to our <template> and Vue Application\n            getLocalTimeString: function (isoTime){\n                const date = new Date(isoTime)\n                const options = { \n                    year: '2-digit', \n                    month: '2-digit', \n                    day: '2-digit', \n                    hour: '2-digit', \n                    minute: '2-digit', \n                    second: '2-digit', \n                    millisecond: '3-digit',\n                    hour12: false \n                    }\n                return date.toLocaleString('en-US', options)\n            },\n        },\n        mounted() {\n            // code here when the component is first loaded\n        },\n        unmounted() {\n            // code here when the component is removed from the Dashboard\n            // i.e. when the user navigates away from the page\n        }\n    }\n</script>\n<style>\n    /* define any styles here - supports raw CSS */\n    .my-class {\n        color: red;\n    }\n    .headers {\n        font-weight: bold;\n    }\n    .ocppMsgReq {\n        color: blue;\n        font-weight: bold;\n    }\n    .ocppMsgRes {\n        color: blue;\n    }\n    .ocppMsgErr {\n        color: red;\n    }\n</style>",
        "storeOutMessages": true,
        "passthru": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1190,
        "y": 520,
        "wires": [
            [
                "c4b73cd2d6f1efbb",
                "c006c2c3567e7ee6",
                "2807de6096eb9e1f"
            ]
        ]
    },
    {
        "id": "0380a90af6da220b",
        "type": "influxdb in",
        "z": "daf7a59ca2ce18df",
        "influxdb": "7cb40fcee206391e",
        "name": "",
        "query": "",
        "rawOutput": false,
        "precision": "",
        "retentionPolicy": "",
        "org": "argonne",
        "x": 540,
        "y": 120,
        "wires": [
            [
                "879a60905f018737"
            ]
        ]
    },
    {
        "id": "72d6a88d845b6b48",
        "type": "function",
        "z": "daf7a59ca2ce18df",
        "name": "function 16",
        "func": "// clear out any incoming message for now.\nmsg = {}\n\nmsg.query = \n    'from(bucket: \"OCPP\") \\\n      |> range(start: -1d) \\\n      |> filter(fn: (r) => r[\"_measurement\"] == \"Transaction\") \\\n      //|> filter(fn: (r) => r[\"_field\"] == \"ocppMsg\") \\\n      //|> group() \\\n      //|> sort(columns: [\"_time\"]) \\\n      |> drop(columns: [\"table\",\"Result\",\"_measurement\",\"_stop\",\"_start\",\"_field\"]) \\\n      //|> keep(columns: [\"_time\",\"cbId\",\"command\",\"msgFrom\",\"_value\"]) \\\n      |> limit(n: 500)'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 120,
        "wires": [
            [
                "0380a90af6da220b"
            ]
        ]
    },
    {
        "id": "879a60905f018737",
        "type": "debug",
        "z": "daf7a59ca2ce18df",
        "name": "debug 48",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 700,
        "y": 120,
        "wires": []
    },
    {
        "id": "6f06af534fd6202b",
        "type": "inject",
        "z": "daf7a59ca2ce18df",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 200,
        "y": 120,
        "wires": [
            [
                "72d6a88d845b6b48"
            ]
        ]
    },
    {
        "id": "c4b73cd2d6f1efbb",
        "type": "function",
        "z": "daf7a59ca2ce18df",
        "name": "FLUX Get raw MV OCPP",
        "func": "// clear out any incoming message for now.\nlet filter_by_tx = \"\";\nlet topic = \"00000000\"\nif (msg.payload.txId) {\n  filter_by_tx = `|> filter(fn: (r) => r[\"transactionId\"] == \"${msg.payload.txId}\")`\n  topic = msg.payload.txId\n}\n\nmsg = {}\n\nmsg.topic = topic\n\nmsg.query = `from(bucket: \"OCPP\") \\\n  |> range(start: -365d) \\\n  |> filter(fn: (r) => r[\"_measurement\"] == \"MeterValues\") \\\n  ${filter_by_tx} \\\n  |> pivot(columnKey: [\"_field\"], rowKey: [\"_time\"], valueColumn: \"_value\") \\\n  |> drop(columns: [\"_start\",\"_stop\",\"_measurement\",\"cbId\",\"connectorId\",\"transactionId\"]) \\\n  |> sort(columns: [\"_time\"])`\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 460,
        "wires": [
            [
                "7d7516052c9c7a0a",
                "02ea19c5e98fd683"
            ]
        ]
    },
    {
        "id": "47ec7b659bf636da",
        "type": "function",
        "z": "daf7a59ca2ce18df",
        "name": "FLUX Get raw Tx OCPP",
        "func": "// clear out any incoming message for now.\nmsg = {}\n\nmsg.query = `from(bucket: \"OCPP\")\n  |> range( start: -20d)\n  |> filter(fn: (r) => r[\"_measurement\"] == \"Transaction\")\n  |> pivot(columnKey: [\"_field\"], rowKey: [\"_time\"], valueColumn: \"_value\")\n  |> drop(columns: [\"_start\",\"_stop\",\"_measurement\"])\n  |> group(columns: [\"transactionId\"])\n  |> sort(columns: [\"_time\"])`\n\n\nmsg.query = `\nfrom(bucket: \"OCPP\")\n  |> range(start: -2d)\n  |> filter(fn: (r) => r[\"_measurement\"] == \"Transaction\")\n  |> filter(fn: (r) => r[\"_field\"] == \"meterStart\" or r[\"_field\"] == \"meterStop\" or r[\"_field\"] == \"transactionId\" or r[\"_field\"] == \"timestamp\" or r[\"_field\"] == \"idTag\" or r[\"_field\"] == \"connectorId\" )\n  |> pivot(columnKey: [\"_field\"], rowKey: [\"_time\"], valueColumn: \"_value\")\n  |> filter(fn: (r) => r.transactionId != 0)\n  |> drop(columns: [\"_start\",\"_stop\",\"_measurement\",\"msgFrom\"])\n  |> group()\n  |> sort(columns: [\"_time\"])\n`\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 520,
        "wires": [
            [
                "3b309fbf5a5e9349"
            ]
        ]
    },
    {
        "id": "32233b212a66cfcb",
        "type": "debug",
        "z": "daf7a59ca2ce18df",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1355,
        "y": 500,
        "wires": [],
        "l": false
    },
    {
        "id": "3b309fbf5a5e9349",
        "type": "influxdb in",
        "z": "daf7a59ca2ce18df",
        "influxdb": "7cb40fcee206391e",
        "name": "",
        "query": "",
        "rawOutput": false,
        "precision": "",
        "retentionPolicy": "",
        "org": "cipio",
        "x": 820,
        "y": 520,
        "wires": [
            [
                "c5cd7189e5cb3f54"
            ]
        ]
    },
    {
        "id": "1380888fab8c8636",
        "type": "inject",
        "z": "daf7a59ca2ce18df",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 305,
        "y": 580,
        "wires": [
            [
                "47ec7b659bf636da"
            ]
        ],
        "l": false
    },
    {
        "id": "c5cd7189e5cb3f54",
        "type": "function",
        "z": "daf7a59ca2ce18df",
        "name": "FLUX remove extras",
        "func": "msg.payload.forEach(function(ocppMsg) {\n    delete ocppMsg.result;\n    delete ocppMsg.table;\n});\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 520,
        "wires": [
            [
                "e3912322d07af67d",
                "aef68b6786e5c5a7"
            ]
        ]
    },
    {
        "id": "aa18045a070128d9",
        "type": "link in",
        "z": "daf7a59ca2ce18df",
        "name": "MV Refresh",
        "links": [
            "b30433a611efd29c"
        ],
        "x": 145,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "22993ff229d6db8d",
        "type": "link in",
        "z": "daf7a59ca2ce18df",
        "name": "Transaction Refreh",
        "links": [
            "7a8e05f5d5a2e926"
        ],
        "x": 145,
        "y": 520,
        "wires": [
            [
                "47ec7b659bf636da"
            ]
        ]
    },
    {
        "id": "70f90fb397f12726",
        "type": "ui-template",
        "z": "daf7a59ca2ce18df",
        "group": "750f030497b122aa",
        "page": "",
        "ui": "",
        "name": "MV by TxId",
        "order": 9,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n    <!-- v-text-field\n        v-model=\"search\"\n        label=\"Search\"\n        prepend-inner-icon=\"mdi-magnify\"\n        variant=\"outlined\"\n        clearable\n        hide-details\n        single-line\n      ></v-text-field -->\n\n    <v-data-table  \n        :headers=\"headers\"\n        :items=\"msg.payload\"\n        :filter-keys='[\"CurrentA\",\"VoltageV\",\"EnergykWh\"]'\n    >\n        <template v-slot:header._time>\n            <div class=\"headers\">Time</div>\n        </template>\n        <template v-slot:header.VoltageV>\n            <div class=\"headers\">Volts</div>\n        </template>\n\n        <template v-slot:item._time=\"{ item }\">\n            <div>{{ getLocalTimeString(item._time) }}</div>\n        </template>\n    </v-data-table>\n</template>\n\n<script>\n    export default {\n        data() {\n            // define variables available component-wide\n            // (in <template> and component functions)\n            return {\n                search: '',\n                headers: [\n                    { title: \"Time\", key: \"_time\"},\n                    { title: \"Current(A)\", key: \"CurrentA\", value: item => this.getTruncated(item.CurrentA, 3)},\n                    { title: \"Volts(V)\", key: \"VoltageV\", value: item => this.getTruncated(item.VoltageV, 3)},\n                    { title: \"Power(kW)\", key: \"PowerkW\", value: item => this.getTruncated(item.PowerkW, 3)},\n                    { title: \"Energy(kWh)\", key: \"EnergykWh\", value: item => this.getTruncated(item.EnergykWh, 3)},\n                    { title: \"SoC (%)\", key: \"SoC\"}\n                ]\n\n            }\n        },\n        watch: {\n            // watch for any changes of \"count\"\n\n        },\n        computed: {\n\n        },\n        methods: {\n            // expose a method to our <template> and Vue Application\n            getLocalTimeString: function (isoTime){\n                const date = new Date(isoTime)\n                const options = { \n                    year: '2-digit', \n                    month: '2-digit', \n                    day: '2-digit', \n                    hour: '2-digit', \n                    minute: '2-digit', \n                    second: '2-digit', \n                    millisecond: '3-digit',\n                    hour12: false \n                    }\n                return date.toLocaleString('en-US', options)\n            },\n            getTruncated: function(value,decimals){\n                const factor = Math.pow(10, decimals);\n                return Math.floor(value * factor) / factor;\n            }\n        },\n        mounted() {\n            // code here when the component is first loaded\n        },\n        unmounted() {\n            // code here when the component is removed from the Dashboard\n            // i.e. when the user navigates away from the page\n        }\n    }\n</script>\n<style>\n    /* define any styles here - supports raw CSS */\n    .headers {\n        font-weight: bold;\n        color: green;\n    }\n\n</style>",
        "storeOutMessages": true,
        "passthru": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1410,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "7d7516052c9c7a0a",
        "type": "influxdb in",
        "z": "daf7a59ca2ce18df",
        "influxdb": "7cb40fcee206391e",
        "name": "",
        "query": "",
        "rawOutput": false,
        "precision": "",
        "retentionPolicy": "",
        "org": "cipio",
        "x": 900,
        "y": 460,
        "wires": [
            [
                "20adfc41cd29af1b"
            ]
        ]
    },
    {
        "id": "20adfc41cd29af1b",
        "type": "function",
        "z": "daf7a59ca2ce18df",
        "name": "FLUX remove extras",
        "func": "msg.payload.forEach(function(ocppMsg) {\n    delete ocppMsg.result;\n    delete ocppMsg.table;\n});\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1100,
        "y": 460,
        "wires": [
            [
                "70f90fb397f12726",
                "32233b212a66cfcb",
                "bb739222584f69de"
            ]
        ]
    },
    {
        "id": "afc97f6be14c06af",
        "type": "debug",
        "z": "daf7a59ca2ce18df",
        "name": "debug 60",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1080,
        "y": 280,
        "wires": []
    },
    {
        "id": "e721721ffe065303",
        "type": "debug",
        "z": "daf7a59ca2ce18df",
        "name": "debug 61",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 740,
        "y": 700,
        "wires": []
    },
    {
        "id": "e5cf1fe4522628ee",
        "type": "ui-control",
        "z": "daf7a59ca2ce18df",
        "name": "",
        "ui": "8cdc313c9611f13f",
        "events": "all",
        "x": 600,
        "y": 700,
        "wires": [
            [
                "e721721ffe065303"
            ]
        ]
    },
    {
        "id": "add76386e6a46f5d",
        "type": "function",
        "z": "daf7a59ca2ce18df",
        "name": "Show TX",
        "func": "msg.payload = {\n    \"groups\": {\n        \"show\": [\n            \"Transactions:Transactions\"\n        ],\n        \"hide\": [\n            \"Transactions:Meter Values\"\n        ]\n    }\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 660,
        "wires": [
            [
                "e5cf1fe4522628ee",
                "47ec7b659bf636da"
            ]
        ]
    },
    {
        "id": "c006c2c3567e7ee6",
        "type": "function",
        "z": "daf7a59ca2ce18df",
        "name": "Show MV",
        "func": "msg.payload = {\n    \"groups\": {\n        \"hide\": [\n            \"Transactions:Transactions\"\n        ],\n        \"show\": [\n            \"Transactions:Meter Values\"\n        ]\n    }\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 700,
        "wires": [
            [
                "e5cf1fe4522628ee"
            ]
        ]
    },
    {
        "id": "5df3e99944651698",
        "type": "inject",
        "z": "daf7a59ca2ce18df",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 265,
        "y": 660,
        "wires": [
            [
                "add76386e6a46f5d"
            ]
        ],
        "l": false
    },
    {
        "id": "7ad34b56292f573d",
        "type": "inject",
        "z": "daf7a59ca2ce18df",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 265,
        "y": 700,
        "wires": [
            [
                "c006c2c3567e7ee6"
            ]
        ],
        "l": false
    },
    {
        "id": "c3993a72f3c63028",
        "type": "ui-button",
        "z": "daf7a59ca2ce18df",
        "group": "750f030497b122aa",
        "name": "",
        "label": "Return to Transaction List",
        "order": 1,
        "width": "0",
        "height": "0",
        "emulateClick": false,
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "block",
        "icon": "mdi-keyboard-return",
        "iconPosition": "left",
        "payload": "{\"target\":\"Transactions\"}",
        "payloadType": "json",
        "topic": "topic",
        "topicType": "msg",
        "buttonColor": "",
        "textColor": "",
        "iconColor": "yellow",
        "enableClick": true,
        "enablePointerdown": false,
        "pointerdownPayload": "",
        "pointerdownPayloadType": "str",
        "enablePointerup": false,
        "pointerupPayload": "",
        "pointerupPayloadType": "str",
        "x": 150,
        "y": 620,
        "wires": [
            [
                "add76386e6a46f5d"
            ]
        ]
    },
    {
        "id": "bc6bb2f523b00fa9",
        "type": "ui-chart",
        "z": "daf7a59ca2ce18df",
        "group": "750f030497b122aa",
        "name": "Energy",
        "label": "Energy",
        "order": 13,
        "chartType": "line",
        "category": "",
        "categoryType": "none",
        "xAxisLabel": "",
        "xAxisProperty": "payload._time",
        "xAxisPropertyType": "msg",
        "xAxisType": "time",
        "xAxisFormat": "",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "kWh",
        "yAxisProperty": "payload.EnergykWh",
        "yAxisPropertyType": "msg",
        "ymin": "",
        "ymax": "",
        "bins": 10,
        "action": "append",
        "stackSeries": false,
        "pointShape": "circle",
        "pointRadius": 4,
        "showLegend": true,
        "removeOlder": 1,
        "removeOlderUnit": "3600",
        "removeOlderPoints": "",
        "colors": [
            "#ffa200",
            "#ff0000",
            "#ff7f0e",
            "#2ca02c",
            "#a347e1",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#e5e5e5"
        ],
        "gridColorDefault": true,
        "width": "3",
        "height": "8",
        "className": "",
        "interpolation": "linear",
        "x": 1480,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "a39145869b71df51",
        "type": "ui-chart",
        "z": "daf7a59ca2ce18df",
        "group": "750f030497b122aa",
        "name": "Power",
        "label": "Power",
        "order": 12,
        "chartType": "line",
        "category": "",
        "categoryType": "none",
        "xAxisLabel": "",
        "xAxisProperty": "payload._time",
        "xAxisPropertyType": "msg",
        "xAxisType": "time",
        "xAxisFormat": "",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "kW",
        "yAxisProperty": "payload.PowerkW",
        "yAxisPropertyType": "msg",
        "ymin": "",
        "ymax": "",
        "bins": 10,
        "action": "append",
        "stackSeries": false,
        "pointShape": "circle",
        "pointRadius": 4,
        "showLegend": true,
        "removeOlder": 1,
        "removeOlderUnit": "3600",
        "removeOlderPoints": "",
        "colors": [
            "#96e407",
            "#ff0000",
            "#ff7f0e",
            "#2ca02c",
            "#a347e1",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#e5e5e5"
        ],
        "gridColorDefault": true,
        "width": "3",
        "height": "8",
        "className": "",
        "interpolation": "linear",
        "x": 1470,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "2ef7f596c72004a1",
        "type": "ui-chart",
        "z": "daf7a59ca2ce18df",
        "group": "750f030497b122aa",
        "name": "SOC",
        "label": "SOC",
        "order": 14,
        "chartType": "line",
        "category": "",
        "categoryType": "none",
        "xAxisLabel": "",
        "xAxisProperty": "payload._time",
        "xAxisPropertyType": "msg",
        "xAxisType": "time",
        "xAxisFormat": "",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "%",
        "yAxisProperty": "payload.SoC",
        "yAxisPropertyType": "msg",
        "ymin": "",
        "ymax": "",
        "bins": 10,
        "action": "append",
        "stackSeries": false,
        "pointShape": "circle",
        "pointRadius": 4,
        "showLegend": true,
        "removeOlder": 1,
        "removeOlderUnit": "3600",
        "removeOlderPoints": "",
        "colors": [
            "#ae00ff",
            "#ff0000",
            "#ff7f0e",
            "#2ca02c",
            "#a347e1",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#e5e5e5"
        ],
        "gridColorDefault": true,
        "width": "3",
        "height": "8",
        "className": "",
        "interpolation": "linear",
        "x": 1470,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "bb739222584f69de",
        "type": "function",
        "z": "daf7a59ca2ce18df",
        "name": "function 18",
        "func": "// Start off by clearing all the charts\nnode.send({payload: []})\n\n//Take the array and send as individual payloads to the \n// charts\n \nmsg.payload.forEach(function(mv) {\n    let msg2 = {}\n    msg2.payload = mv\n    //msg2.payload.timestamp = new Date(mv._time).getTime()\n    node.send(msg2)\n});\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 240,
        "wires": [
            [
                "b790fef9f4f7de2c"
            ]
        ]
    },
    {
        "id": "6c36ced9caa73c04",
        "type": "debug",
        "z": "daf7a59ca2ce18df",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1055,
        "y": 360,
        "wires": [],
        "l": false
    },
    {
        "id": "11ee4d2550f2e6b1",
        "type": "ui-chart",
        "z": "daf7a59ca2ce18df",
        "group": "750f030497b122aa",
        "name": "Current",
        "label": "Current",
        "order": 11,
        "chartType": "line",
        "category": "",
        "categoryType": "none",
        "xAxisLabel": "",
        "xAxisProperty": "payload._time",
        "xAxisPropertyType": "msg",
        "xAxisType": "time",
        "xAxisFormat": "",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "Amps",
        "yAxisProperty": "payload.CurrentA",
        "yAxisPropertyType": "msg",
        "ymin": "",
        "ymax": "",
        "bins": 10,
        "action": "append",
        "stackSeries": false,
        "pointShape": "circle",
        "pointRadius": 4,
        "showLegend": true,
        "removeOlder": 1,
        "removeOlderUnit": "3600",
        "removeOlderPoints": "",
        "colors": [
            "#6600ff",
            "#ff0000",
            "#ff7f0e",
            "#2ca02c",
            "#a347e1",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#e5e5e5"
        ],
        "gridColorDefault": true,
        "width": "3",
        "height": "8",
        "className": "",
        "interpolation": "linear",
        "x": 1481,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "bae6fc11c3f77385",
        "type": "ui-chart",
        "z": "daf7a59ca2ce18df",
        "group": "750f030497b122aa",
        "name": "Voltage",
        "label": "Voltage",
        "order": 10,
        "chartType": "line",
        "category": "",
        "categoryType": "none",
        "xAxisLabel": "",
        "xAxisProperty": "payload._time",
        "xAxisPropertyType": "msg",
        "xAxisType": "time",
        "xAxisFormat": "",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "Volts",
        "yAxisProperty": "payload.VoltageV",
        "yAxisPropertyType": "msg",
        "ymin": "",
        "ymax": "",
        "bins": 10,
        "action": "append",
        "stackSeries": false,
        "pointShape": "circle",
        "pointRadius": 4,
        "showLegend": true,
        "removeOlder": 1,
        "removeOlderUnit": "3600",
        "removeOlderPoints": "",
        "colors": [
            "#05ff71",
            "#ff0000",
            "#ff7f0e",
            "#2ca02c",
            "#a347e1",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#e5e5e5"
        ],
        "gridColorDefault": true,
        "width": "3",
        "height": 8,
        "className": "",
        "interpolation": "linear",
        "x": 1480,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "83b842273e7bfae5",
        "type": "ui-text",
        "z": "daf7a59ca2ce18df",
        "group": "750f030497b122aa",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Transaction ID: ",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "style": true,
        "font": "",
        "fontSize": "30",
        "color": "#500ced",
        "wrapText": false,
        "className": "",
        "x": 1120,
        "y": 400,
        "wires": []
    },
    {
        "id": "02ea19c5e98fd683",
        "type": "change",
        "z": "daf7a59ca2ce18df",
        "name": "",
        "rules": [
            {
                "t": "delete",
                "p": "query",
                "pt": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "topic",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 900,
        "y": 360,
        "wires": [
            [
                "83b842273e7bfae5",
                "6c36ced9caa73c04",
                "9cec406f120e7d5d"
            ]
        ]
    },
    {
        "id": "2807de6096eb9e1f",
        "type": "function",
        "z": "daf7a59ca2ce18df",
        "name": "FLUX Get raw None-MV OCPP",
        "func": "// clear out any incoming message for now.\nlet filter_by_tx = \"\";\nlet topic = \"00000000\"\nif (msg.payload.txId) {\n  filter_by_tx = `|> filter(fn: (r) => r[\"transactionId\"] == ${msg.payload.txId})`\n  topic = msg.payload.txId\n}\n\nmsg = {}\n\nmsg.topic = topic\n\nmsg.query = `from(bucket: \"OCPP\") \\\n  |> range( start: -365d) \\\n  |> filter(fn: (r) => r[\"_measurement\"] == \"Transaction\") \\\n  |> pivot(columnKey: [\"_field\"], rowKey: [\"_time\"], valueColumn: \"_value\") \\\n  ${filter_by_tx} \\\n  |> filter(fn: (r) => r[\"command\"] == \"StartTransaction\") \\\n  |> drop(columns: [\"_start\",\"_stop\",\"_measurement\"]) \\\n  |> group(columns: [\"transactionId\"]) \\\n  |> sort(columns: [\"_time\"])`\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 280,
        "wires": [
            [
                "cad0c9ccd4a89916"
            ]
        ]
    },
    {
        "id": "cad0c9ccd4a89916",
        "type": "influxdb in",
        "z": "daf7a59ca2ce18df",
        "influxdb": "7cb40fcee206391e",
        "name": "",
        "query": "",
        "rawOutput": false,
        "precision": "",
        "retentionPolicy": "",
        "org": "cipio",
        "x": 920,
        "y": 280,
        "wires": [
            [
                "afc97f6be14c06af"
            ]
        ]
    },
    {
        "id": "aef68b6786e5c5a7",
        "type": "debug",
        "z": "daf7a59ca2ce18df",
        "name": "debug 67",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1200,
        "y": 580,
        "wires": []
    },
    {
        "id": "a54940f160f7f0db",
        "type": "ui-text",
        "z": "daf7a59ca2ce18df",
        "group": "750f030497b122aa",
        "order": 3,
        "width": "2",
        "height": "1",
        "name": "",
        "label": "ChargeBoxID:",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "style": true,
        "font": "",
        "fontSize": 16,
        "color": "#aa14e1",
        "wrapText": false,
        "className": "",
        "x": 1220,
        "y": 840,
        "wires": []
    },
    {
        "id": "0cfe76cf25b87178",
        "type": "ui-text",
        "z": "daf7a59ca2ce18df",
        "group": "750f030497b122aa",
        "order": 4,
        "width": "2",
        "height": "1",
        "name": "",
        "label": "Connector:  ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "style": true,
        "font": "",
        "fontSize": 16,
        "color": "#0db1f8",
        "wrapText": false,
        "className": "",
        "x": 1210,
        "y": 880,
        "wires": []
    },
    {
        "id": "d301de1fbbac9723",
        "type": "ui-text",
        "z": "daf7a59ca2ce18df",
        "group": "750f030497b122aa",
        "order": 8,
        "width": "2",
        "height": "1",
        "name": "",
        "label": "Client:  ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "style": true,
        "font": "",
        "fontSize": 16,
        "color": "#ff8d0a",
        "wrapText": false,
        "className": "",
        "x": 1190,
        "y": 920,
        "wires": []
    },
    {
        "id": "33e220dd106839f5",
        "type": "ui-text",
        "z": "daf7a59ca2ce18df",
        "group": "750f030497b122aa",
        "order": 5,
        "width": "2",
        "height": "1",
        "name": "",
        "label": "Start MV:  ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "style": true,
        "font": "",
        "fontSize": 16,
        "color": "#0e6735",
        "wrapText": false,
        "className": "",
        "x": 1200,
        "y": 960,
        "wires": []
    },
    {
        "id": "306d784e407efc57",
        "type": "ui-text",
        "z": "daf7a59ca2ce18df",
        "group": "750f030497b122aa",
        "order": 6,
        "width": "2",
        "height": "1",
        "name": "",
        "label": "End MV:  ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "style": true,
        "font": "",
        "fontSize": 16,
        "color": "#0e6735",
        "wrapText": false,
        "className": "",
        "x": 1200,
        "y": 1000,
        "wires": []
    },
    {
        "id": "5aed68d7dac2c043",
        "type": "ui-text",
        "z": "daf7a59ca2ce18df",
        "group": "750f030497b122aa",
        "order": 7,
        "width": "2",
        "height": "1",
        "name": "",
        "label": "Total kWh:  ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "style": true,
        "font": "",
        "fontSize": 16,
        "color": "#0e6735",
        "wrapText": false,
        "className": "",
        "x": 1210,
        "y": 1040,
        "wires": []
    },
    {
        "id": "9cec406f120e7d5d",
        "type": "function",
        "z": "daf7a59ca2ce18df",
        "name": "Get Tx MeterStart/Stop  ",
        "func": "let TxId = msg.payload\nmsg = {}\n\nmsg.query = `\nmeterStart = from(bucket: \"OCPP\")\n  |> range(start: -2d)\n  |> filter(fn: (r) => r[\"_measurement\"] == \"Transaction\")\n  |> filter(fn: (r) => r[\"_field\"] == \"transactionId\" or r[\"_field\"] == \"meterStart\" or r[\"_field\"] == \"idTag\" or r[\"_field\"] == \"connectorId\")\n  |> filter(fn: (r) => r.command == \"StartTransaction\")\n  |> pivot(columnKey: [\"_field\"], rowKey: [\"_time\"], valueColumn: \"_value\")\n  |> filter(fn: (r) => r.transactionId != 0)\n  |> drop(columns: [\"_start\",\"_stop\",\"msgFrom\",\"_measurement\"])\n\nmeterStop = from(bucket: \"OCPP\")\n  |> range(start: -2d)\n  |> filter(fn: (r) => r[\"_measurement\"] == \"Transaction\")\n  |> filter(fn: (r) => r[\"_field\"] == \"transactionId\" or r[\"_field\"] == \"meterStop\")\n  |> filter(fn: (r) => r.command == \"StopTransaction\")\n  |> pivot(columnKey: [\"_field\"], rowKey: [\"_time\"], valueColumn: \"_value\")\n  |> filter(fn: (r) => r.transactionId != 0)\n  |> drop(columns: [\"_start\",\"_stop\",\"msgFrom\",\"_measurement\"])\n\njoin(tables: {key1: meterStart, key2: meterStop}, on: [\"transactionId\"], method: \"inner\")\n|> map(fn: (r) => ({ r with totalEnergy: r.meterStop - r.meterStart}))\n|> map(fn: (r) => ({ r with difference_seconds: (uint( v: r._time_key2) - uint( v: r._time_key1)) / uint(v: 1000000000) }))\n|> filter(fn: (r) => r.transactionId == ${TxId})\n\n`\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 800,
        "wires": [
            [
                "54ff26bff532c2d5"
            ]
        ]
    },
    {
        "id": "54ff26bff532c2d5",
        "type": "influxdb in",
        "z": "daf7a59ca2ce18df",
        "influxdb": "7cb40fcee206391e",
        "name": "",
        "query": "",
        "rawOutput": false,
        "precision": "",
        "retentionPolicy": "",
        "org": "cipio",
        "x": 600,
        "y": 800,
        "wires": [
            [
                "a6b605ca949e5de8",
                "4cc7f71877e27f96"
            ]
        ]
    },
    {
        "id": "a6b605ca949e5de8",
        "type": "debug",
        "z": "daf7a59ca2ce18df",
        "name": "debug 68",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1230,
        "y": 800,
        "wires": []
    },
    {
        "id": "5cc51912a700cb47",
        "type": "inject",
        "z": "daf7a59ca2ce18df",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "1736982609",
        "payloadType": "num",
        "x": 130,
        "y": 800,
        "wires": [
            [
                "9cec406f120e7d5d"
            ]
        ]
    },
    {
        "id": "b2ad490ff03c2c97",
        "type": "change",
        "z": "daf7a59ca2ce18df",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload[0].cbId_key1",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 980,
        "y": 840,
        "wires": [
            [
                "a54940f160f7f0db"
            ]
        ]
    },
    {
        "id": "2a2eb5a77e70df62",
        "type": "change",
        "z": "daf7a59ca2ce18df",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload[0].connectorId",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 980,
        "y": 880,
        "wires": [
            [
                "0cfe76cf25b87178"
            ]
        ]
    },
    {
        "id": "9214f5879d50fbe0",
        "type": "change",
        "z": "daf7a59ca2ce18df",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload[0].idTag",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 980,
        "y": 920,
        "wires": [
            [
                "d301de1fbbac9723"
            ]
        ]
    },
    {
        "id": "e5e3bc3824864970",
        "type": "change",
        "z": "daf7a59ca2ce18df",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload[0].meterStart",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 980,
        "y": 960,
        "wires": [
            [
                "33e220dd106839f5"
            ]
        ]
    },
    {
        "id": "4a191fd359629475",
        "type": "change",
        "z": "daf7a59ca2ce18df",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload[0].meterStop",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 980,
        "y": 1000,
        "wires": [
            [
                "306d784e407efc57"
            ]
        ]
    },
    {
        "id": "a6948cd72ae1a796",
        "type": "change",
        "z": "daf7a59ca2ce18df",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload[0].totalEnergy",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 980,
        "y": 1040,
        "wires": [
            [
                "5aed68d7dac2c043"
            ]
        ]
    },
    {
        "id": "14a6b84982d9d4ad",
        "type": "function",
        "z": "be6953c0e3c70845",
        "name": "ReqMap",
        "func": "let reqMap = global.get('CSMS:Req_Map') || new Map()\n\nreqMap.set('StatusNotification', 'my_SN')\nreqMap.set('SCM', 'my_SCM')\n\nglobal.set('CSMS:Req_Map', reqMap)\nreturn",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "6735aefe1e53050f",
        "type": "inject",
        "z": "be6953c0e3c70845",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "3",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 450,
        "y": 340,
        "wires": [
            [
                "14a6b84982d9d4ad"
            ]
        ]
    },
    {
        "id": "3e5be358a0c06a10",
        "type": "function",
        "z": "be6953c0e3c70845",
        "name": "ClearChargingProfile",
        "func": "let connectorId = 1\nlet cbId = 'L2410002F01040833A02'\n    \nmsg.payload = {\n    command: \"ClearChargingProfile\",\n    cbId,\n    data: {\n        id: 1,\n        chargingProfilePurpose: \"TxDefaultProfile\",\n    }\n}\n\nreturn msg\n\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 160,
        "wires": [
            [
                "647ae537e6cb80bc"
            ]
        ]
    },
    {
        "id": "2673488a3facfce7",
        "type": "inject",
        "z": "be6953c0e3c70845",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "5",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 470,
        "y": 160,
        "wires": [
            [
                "3e5be358a0c06a10"
            ]
        ]
    },
    {
        "id": "28ed0ee4580e427f",
        "type": "link in",
        "z": "be6953c0e3c70845",
        "name": "my_SN",
        "links": [],
        "x": 525,
        "y": 560,
        "wires": [
            [
                "95e87dbab5f2da34"
            ]
        ]
    },
    {
        "id": "ea596a5b57cd92ae",
        "type": "link in",
        "z": "be6953c0e3c70845",
        "name": "my_SCM",
        "links": [],
        "x": 535,
        "y": 680,
        "wires": [
            [
                "b06129c20bb66adc"
            ]
        ]
    },
    {
        "id": "b06129c20bb66adc",
        "type": "link out",
        "z": "be6953c0e3c70845",
        "name": "link out 42",
        "mode": "return",
        "links": [],
        "x": 725,
        "y": 680,
        "wires": []
    },
    {
        "id": "95e87dbab5f2da34",
        "type": "change",
        "z": "be6953c0e3c70845",
        "name": "Generic Return",
        "rules": [
            {
                "t": "set",
                "p": "ocpp.data",
                "pt": "msg",
                "to": "payload.data",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 680,
        "y": 560,
        "wires": [
            [
                "ee872121139b19d6"
            ]
        ]
    },
    {
        "id": "ee872121139b19d6",
        "type": "link out",
        "z": "be6953c0e3c70845",
        "name": "link out 38",
        "mode": "return",
        "links": [],
        "x": 835,
        "y": 560,
        "wires": []
    },
    {
        "id": "647ae537e6cb80bc",
        "type": "link out",
        "z": "be6953c0e3c70845",
        "name": "link out 43",
        "mode": "link",
        "links": [
            "6ea73070a96d4eeb"
        ],
        "x": 865,
        "y": 160,
        "wires": []
    },
    {
        "id": "139500cb73933ae5",
        "type": "function",
        "z": "be6953c0e3c70845",
        "name": "ClearChargingProfile",
        "func": "let connectorId = 1\nlet cbId = 'L2410002F01040833A02'\n    \nmsg.payload = {\n    command: \"ClearChargingProfile\",\n    cbId,\n    data: {\n        id: 1,\n        chargingProfilePurpose: \"TxProfile\",\n    }\n}\n\nreturn msg\n\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 240,
        "wires": [
            [
                "e762dccd76164608"
            ]
        ]
    },
    {
        "id": "92bf539f09fad5fc",
        "type": "inject",
        "z": "be6953c0e3c70845",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "4",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 470,
        "y": 240,
        "wires": [
            [
                "139500cb73933ae5"
            ]
        ]
    },
    {
        "id": "e762dccd76164608",
        "type": "link out",
        "z": "be6953c0e3c70845",
        "name": "link out 44",
        "mode": "link",
        "links": [
            "6ea73070a96d4eeb"
        ],
        "x": 865,
        "y": 240,
        "wires": []
    },
    {
        "id": "ba16c53b2a962377",
        "type": "function",
        "z": "be6953c0e3c70845",
        "name": "Clear ReqMap",
        "func": "let reqMap = new Map()\n\n//reqMap.set('StatusNotification', 'my_SN')\n//reqMap.set('SCM', 'my_SCM')\n\nglobal.set('CSMS:Req_Map', reqMap)\nreturn",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "c515882adfa185e1",
        "type": "inject",
        "z": "be6953c0e3c70845",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "3",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 430,
        "y": 420,
        "wires": [
            [
                "ba16c53b2a962377"
            ]
        ]
    },
    {
        "id": "d87d1230d7f4c458",
        "type": "function",
        "z": "be6953c0e3c70845",
        "g": "ceb6cf36b4dceec8",
        "name": "Auth/Start Tx",
        "func": "// function handles both Authorize and StartTransaction\n// This generate a unique TxId, as long as the function doesn't get called twice\n// within the same millisecond\n\n\n// defaults\nconst ACCEPTED = \"Accepted\"\nlet status = ACCEPTED\nlet tags = []\n\n// copy message for the enhanced message with TxId\nlet msg2 = RED.util.cloneMessage(msg)\n\nmsg2.payload = {\n    idTagInfo: {\n        status\n    }\n}\n\nif (msg.ocpp.command === \"StartTransaction\"){\n    msg2.payload.transactionId = generateUniqueId()\n    msg.ocpp.command = 'StartTransactionEnhanced'\n    msg.payload.command = msg.ocpp.command\n    msg2.ocpp.connectorId = msg.payload.data.connectorId || 1\n}\n\n\nlet freeVend = global.get(\"CSMS:FreeVend\") \n    \nif (! freeVend ){\n    tags = global.get(\"CSMS:Tags\")\n\n    const result = tags.find((tag) => tag.tagId === msg.payload.data.idTag)\n\n    if (result){\n        if (!result.enabled){\n            msg2.payload.idTagInfo.status = \"Blocked\"\n        }\n        else if (result.expdate){\n            let expDate = new Date(result.expdate)\n            expDate.setHours(23, 59, 59, 999); // Set to the end of the day\n            let currentDate = new Date()\n\n            if (currentDate > expDate){\n                msg2.payload.idTagInfo.status = \"Expired\"\n            }\n            else {\n                msg2.payload.idTagInfo.expiryDate = expDate.toISOString()\n            }\n        } \n    }\n    else {\n        msg2.payload.idTagInfo.status = \"Invalid\"\n    }\n\n    if (msg2.payload.idTagInfo.status !== ACCEPTED){\n        msg2.payload.transactionId = 0\n    }\n\n}\n\nlet data\n\nif(msg.ocpp.command == \"StartTransaction\"){\n    data = msg.payload.data\n    data.transactionId = msg2.payload.transactionId\n    data.status = msg2.payload.idTagInfo.status\n    const ts = new Date(data.timestamp)\n    msg.timestamp = ts.getTime()\n    msg.cbId = msg2.ocpp.chargeBoxIdentity\n    msg.msgFrom = \"CS\"\n    msg.payload = [2,msg2.ocpp.MessageId,\"StartTransactionEnhanced\",data]\n} else {\n    msg = null\n} \n\nreturn [msg2,msg];\n\n\nfunction generateUniqueId() {\n    // Return a positive 32bit Int as a random TxId\n    const isoTimestamp = new Date().toISOString();\n    // Create a Date object from the ISO timestamp string\n    const date = new Date(isoTimestamp);\n\n    // Get the timestamp in seconds since the Unix epoch\n    const timestampInSeconds = Math.floor(date.getTime() / 1000);\n\n    // Calculate offset to ensure positive value within 32-bit signed range\n    const offset = timestampInSeconds < 0 ? 2147483648 : 0;\n\n    // Convert to 32-bit signed integer and apply offset\n    const int32Timestamp = (timestampInSeconds + offset) | 0;\n\n    return int32Timestamp;\n}\n",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 900,
        "wires": [
            [
                "6aa282ae0b36247d",
                "23ade09a61f9015c"
            ],
            [
                "cb1919cea557885d"
            ]
        ]
    },
    {
        "id": "cc759bb71f06debd",
        "type": "link in",
        "z": "be6953c0e3c70845",
        "g": "ceb6cf36b4dceec8",
        "name": "CL_Auth_StartTx",
        "links": [],
        "x": 525,
        "y": 900,
        "wires": [
            [
                "d87d1230d7f4c458"
            ]
        ]
    },
    {
        "id": "6aa282ae0b36247d",
        "type": "switch",
        "z": "be6953c0e3c70845",
        "g": "ceb6cf36b4dceec8",
        "name": "StartTx Accepted",
        "property": "payload.idTagInfo.status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Accepted",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 830,
        "y": 900,
        "wires": [
            [
                "7010f322a6ca6ae5"
            ]
        ]
    },
    {
        "id": "23ade09a61f9015c",
        "type": "link out",
        "z": "be6953c0e3c70845",
        "g": "ceb6cf36b4dceec8",
        "name": "link out 47",
        "mode": "return",
        "links": [],
        "x": 735,
        "y": 860,
        "wires": []
    },
    {
        "id": "cb1919cea557885d",
        "type": "link out",
        "z": "be6953c0e3c70845",
        "g": "ceb6cf36b4dceec8",
        "name": "link out 48",
        "mode": "link",
        "links": [],
        "x": 745,
        "y": 940,
        "wires": []
    },
    {
        "id": "12b8bd9cfdff38db",
        "type": "function",
        "z": "be6953c0e3c70845",
        "g": "ceb6cf36b4dceec8",
        "name": "Save sessions context",
        "func": "if (msg.ocpp.command === \"StartTransaction\"){\n    let session = {}\n    session.cbId = msg.ocpp.chargeBoxIdentity\n    session.connectorId = msg.ocpp.connectorId\n    session.transactionId = msg.payload.transactionId\n    session.amps = msg.evse.amps\n    let sessions = global.get(\"CSMS:SESSIONS\") || []\n    sessions.push(session)\n    global.set(\"CSMS:SESSIONS\",sessions)\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 940,
        "wires": [
            [
                "fa6e94f405122a1c"
            ]
        ]
    },
    {
        "id": "fa6e94f405122a1c",
        "type": "function",
        "z": "be6953c0e3c70845",
        "g": "ceb6cf36b4dceec8",
        "name": "function 3",
        "func": "const command = \"SCM\"\nconst reqMap = global.get(\"CSMS:Req_Map\");\n\n//default target\nmsg.target = \"CL_SCM\"\n\n// Override target\nif (reqMap.has(command)){\n    msg.target = reqMap.get(command)\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1260,
        "y": 940,
        "wires": [
            [
                "42125ce42a18f3dc"
            ]
        ]
    },
    {
        "id": "42125ce42a18f3dc",
        "type": "link call",
        "z": "be6953c0e3c70845",
        "g": "ceb6cf36b4dceec8",
        "name": "SCM",
        "links": [],
        "linkType": "dynamic",
        "timeout": "30",
        "x": 1390,
        "y": 940,
        "wires": [
            []
        ]
    },
    {
        "id": "d293d37b2e3f30f5",
        "type": "link in",
        "z": "be6953c0e3c70845",
        "g": "ceb6cf36b4dceec8",
        "name": "link in 4",
        "links": [
            "0bb0a06fe83260c3"
        ],
        "x": 955,
        "y": 940,
        "wires": [
            [
                "12b8bd9cfdff38db"
            ]
        ]
    },
    {
        "id": "7010f322a6ca6ae5",
        "type": "change",
        "z": "be6953c0e3c70845",
        "g": "ceb6cf36b4dceec8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload2",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$join([\"evse:\",ocpp.chargeBoxIdentity])",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1040,
        "y": 900,
        "wires": [
            [
                "38b195bac085b028"
            ]
        ]
    },
    {
        "id": "38b195bac085b028",
        "type": "redis-command",
        "z": "be6953c0e3c70845",
        "g": "ceb6cf36b4dceec8",
        "server": "0430675ed6c7cd83",
        "command": "GET",
        "name": "",
        "topic": "",
        "params": "[]",
        "paramsType": "json",
        "payloadType": "json",
        "block": false,
        "x": 1200,
        "y": 900,
        "wires": [
            [
                "939509d1bcb662e4"
            ]
        ]
    },
    {
        "id": "939509d1bcb662e4",
        "type": "json",
        "z": "be6953c0e3c70845",
        "g": "ceb6cf36b4dceec8",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1330,
        "y": 900,
        "wires": [
            [
                "c8f1b5fdb61f41a7"
            ]
        ]
    },
    {
        "id": "c8f1b5fdb61f41a7",
        "type": "change",
        "z": "be6953c0e3c70845",
        "g": "ceb6cf36b4dceec8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "evse",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "evse.amps",
                "pt": "msg",
                "to": "$number(payload.amps)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload2",
                "tot": "msg"
            },
            {
                "t": "delete",
                "p": "payload2",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1480,
        "y": 900,
        "wires": [
            [
                "0bb0a06fe83260c3"
            ]
        ]
    },
    {
        "id": "0bb0a06fe83260c3",
        "type": "link out",
        "z": "be6953c0e3c70845",
        "g": "ceb6cf36b4dceec8",
        "name": "link out 49",
        "mode": "link",
        "links": [
            "d293d37b2e3f30f5"
        ],
        "x": 1605,
        "y": 920,
        "wires": []
    }
]